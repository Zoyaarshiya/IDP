var pgs_scheme = ("https:" == document.location.protocol) ? "https://" : "http://";
var pgs_domain = pgs_scheme + document.domain;
var bitUrlForsharing = "";
var unsavedMail = false;
var ButtonClicked = 'NO';

function go(loc) {
    window.location.href = loc;
}

function hideSubmitButton(id) {
    $$D(id).style.display = 'none';
}
//cookie , delete, get value and create
function getCookieVal(offset) {
    var endstr = document.cookie.indexOf(";", offset);
    if (endstr == -1) {
        endstr = document.cookie.length;
    }
    return unescape(document.cookie.substring(offset, endstr));
}

function getCookie(name) {
    var arg = name + "="; 
    var alen = arg.length;
    var clen = document.cookie.length; 
    var i = 0;
    while (i < clen) {	
        var j = i + alen;
        if (document.cookie.substring(i, j) == arg) {			
            return getCookieVal(j);
			
        }
		i = document.cookie.indexOf(" ", i) + 1;
        if (i == 0) break;
    }

   if(name == 'pgs_track_id'){
     var cookie_val = $$D("track_id_cookie").value;
    return cookie_val;
   }
   else{
   return null;
   } 
}

function deleteCookie(name, path, domain) {
console.log(name + "name");
    if (getCookie(name)) {
        document.cookie = name + "=" +
            ((path) ? "; path=" + path : "") +
            ((domain) ? "; domain=" + domain : "") +
            "; expires=Thu, 01-Jan-70 00:00:01 GMT";
	 }
	 
}

/*function setCookie(name, value, expires, path, domain, secure) {
    document.cookie = name + "=" + escape(value) +
        ((expires) ? "; expires=" + expires.toGMTString() : "") +
        ((path) ? "; path=" + path : "") +
        ((domain) ? "; domain=" + domain : "") +
        ((secure) ? "; secure" : "");
}*/

function setCookie (name,value,expires,path,domain,secure) 
{  
     var secure = "secure";
     var httponly = "Httponly";
	 var strDateTime = expires;
	   
  /*  document.cookie = name + "=" + escape (value) +
	((expires) ? "; expires=" + expires.toUTCString() : "") +
	((path) ? "; path=" + "/" : "") +
	((domain) ? "; domain=" + domain : "") +
   ((secure) ? "; secure=" + secure : "");
  ((httponly) ? "; httponly=" + httponly : "");*/
	 var url = CommonObjects.pgs_context_path + '/add_cookie_prc';
	 url = url+"?p_cookie_name="+name+"&p_cookie_value="+value+"&p_cookie_date="+expires+"&p_path="+path+"&p_secure="+secure;
	 var cookie_ajax = new sack();
    cookie_ajax.requestFile = url;
    cookie_ajax.onCompletion = function () {
      //  UserpdfComplete(cookie_ajax);
    };
    cookie_ajax.runAJAX();
  
  //var ajax = new sack();
    //ajax.requestFile = url;
	//ajax.runAJAX();
  
}
//end of cookie

/*customize tool tip*/
function showDiv(elem) {
    elem.getElementsByClassName("inner-block")[0].style.display = "block";
}

function hideDiv(elem) {
    elem.getElementsByClassName("inner-block")[0].style.display = "none";
}
//PGS_20170613
//function showDiv(elem) {elem.getElementsByClassName("adtosh")[0].style.display="block";}
//function hideDiv(elem) {elem.getElementsByClassName("adtosh")[0].style.display = "none";}
//
function showover(id) {
    $$D(id).style.display = "block";
}

function showout(id) {
    $$D(id).style.display = "none";
}

function toggleMenu(id1, id2, spanId, divId, flag) {
    if ($$D(id1).style.display == 'none') {
        $$D(id1).style.display = 'block'
        if (flag != 'Y' || flag == '') {
            $$D(id2).className = 'show';
        }
    } else {
        $$D(id1).style.display = 'none'
        if (flag != 'Y' || flag == '') {
            $$D(id2).className = 'hide'
        }
    }
}
/* more universities search result page */
function showhide(firstId, id) {
    $$D(firstId).style.display = 'none';
    $$D(id).style.display = 'block';
}

function showmore(firstId, id) {
    if (id == 'more' || id == 'more1') {
        $$D(firstId).style.display = 'block';
    } else if (id == 'less' || id == 'less1') {
        $$D(firstId).style.display = 'none';
    }
}
/* Add to shortlist */
function addto(id1, id2) {
    if ($$D(id1).style.display == 'none') {
        $$D(id1).style.display = 'block'
        $$D(id2).className = 'adsh active'
    } else {
        $$D(id1).style.display = 'none'
        $$D(id2).className = 'adsh'
    }
    if (display != null || display != 'undefined') {
        $$D(id1).style.display = display
    }
}

/***** start ticker tab*****/
var tickerIndex = 0;
var tickerWidth = 0;
var timer;
var timerS;
var speedReveal;
var steps = 1;
var userAgent = navigator.userAgent;

if (userAgent.indexOf("Chrome") != -1) {
    speedReveal = 15;
} else {
    speedReveal = 1;
}

if (userAgent.indexOf("Firefox") != -1) {
    steps = 4;
}

function showTicker() {
    tickerWidth = 0;
    if (tickerIndex == totalTickers) {
        tickerIndex = 0;
    }
    //$$D('tapetext').innerHTML=tickers[tickerIndex].innerHTML;
    hideLinks(tickerIndex);
    sameTickerTime();
    tickerIndex++;
}

function sameTickerTime() {
    var tempWidth = tickerWidth - 3;
    tempWidth = tempWidth <= 0 ? 0 : tempWidth;
    if (tempWidth >= $$D('tapetext').offsetWidth) {
        clearTimeout(timer);
        timerS = setTimeout('showTicker()', 1500); //Time between one ticker to another
        return;
    }
    $$D('revealtext').style.marginLeft = tickerWidth + 'px';
    $$D('revealtext').style.width = ($$D('tapetext').offsetWidth - tempWidth) + 'px';
    tickerWidth += steps;
    timer = setTimeout('sameTickerTime()', speedReveal); //Time to reveal ticker characters
}

function revealTickerAtATime() {
    clearTimeout(timer);
    clearTimeout(timerS);
    $$D('revealtext').style.marginLeft = $$D('tapetext').offsetWidth + "px";
    $$D('revealtext').style.width = 0 + "px";
}

function hideLinks(index) {
    for (var i = 0; i < totalTickers; i++) {
        $$D("tickerLink" + i).style.display = "none";
    }
    $$D("tickerLink" + index).style.display = "block";
}
/***** end ticker tab*****/
/*search auto complete*/
function keywordAutoComplete(obj, paramToExternalFile, e) {
    var urlPrc = 'pgs_ajax_pkg.get_search_keyword_ajax_prc'; // Procedure name
    var param1 = "";
    var param2 = $$D("qual_hidden").value;
	
	//alert (paramToExternalFile);
	
    if (paramToExternalFile == "getQlCategoriesByLetters") {
        param1 = 'p_ajax_type=QL'; // Ajax type Qualification landing page
    } 
	else if (paramToExternalFile == "getCollegesByLetters") {
        if (($$D("searchcollege_hidden").value != "" || $$D("searchcollege_hidden").value != null) && e.keyCode != 13) {
            $$D("searchcollege_hidden").value = "";
            $("#puni_errdiv1").css("display", "none");
        }
        param1 = 'p_ajax_type=UP';
    }
	else if (paramToExternalFile == "getFCollegesByLetters") {
             param1 = 'p_ajax_type=FA';
    } 
	else {
        param1 = 'p_ajax_type=C'; // Ajax type 
    }
    param1 = param1 + '&p_qual_text=' + param2;

    if ($$D("search_keyword_hidden")) {
        $$D("search_keyword_hidden").value = obj.value;
    } else if ($$D("searchcollege_hidden")) {
        $$D("searchcollege_hidden").value = obj.value;
    }

    if (!searchTextValidate(obj.value)) {
        return false;
    }
    ajax_showOptions(obj, paramToExternalFile, e, urlPrc, param1);
}

function KeywordOnkeypress(e, whichPage) {
    if ($("#keyword").val() != null && $("#keyword").val() != "") {
        Showhidediv('qualpop', 'none');
    }
    if (e.keyCode == 13) {
        return validateHomeSearch("N", whichPage);
    } else {
        $$D("location_hidden").value = "";
    }
}

function locationAutoComplete(obj, paramToExternalFile, e) {
    //$$D("location_hidden").value = "";
    var pKeyword = $$D("keyword_hidden").value
    var urlPrc = 'pgs_ajax_pkg.get_search_loc_ajax_prc'; // Procedure name
    var param1 = 'p_ajax_type=U&p_keyword_input=' + pKeyword;
    $$D("search_location_hidden").value = obj.value;
    ajax_showOptions(obj, paramToExternalFile, e, urlPrc, param1);
}

function pgstvAutoComplete(obj, paramToExternalFile, e) {
    var pgstvAjaxType = $$D("pgstv_ajax_type");
    var urlPrc = "";
    var param1 = "";
    if (pgstvAjaxType.value == 'S') {
        urlPrc = 'pgs_ajax_pkg.get_pgstv_ajax_prc'; // Procedure name
        param1 = 'p_ajax_type=S'; // for getting subjects
    } else if (pgstvAjaxType.value == 'C') {
        urlPrc = 'pgs_ajax_pkg.get_pgstv_ajax_prc'; // Procedure name  
        param1 = 'p_ajax_type=C'; // for getting universities
    }
    //console.log =urlPrc;
    ajax_showOptions(obj, paramToExternalFile, e, urlPrc, param1);
}
/*validation home search*/
function validatePgstvSearch(obj) {
    var pgstvAjaxType = $$D("pgstv_ajax_type");
    var pgsTvKeyword = trimString($$D("pgstvkeyword").value);
    var pgsTvKeyword_hidden = trimString($$D("pgstvkeyword_hidden").value);
    var pgsTvUrlValue = pgsTvKeyword_hidden.split("$$");
    var pgsTvUrlkey = pgsTvUrlValue[0];
    var pgsTvUrlId = pgsTvUrlValue[1];
    var pgsTvUrlCat = pgsTvUrlValue[2];
    var pgsTVUrlType = ""
    var pgsTVurl = "";

    if (pgsTvKeyword == "" || pgsTvKeyword == "Enter university" || pgsTvKeyword == "Enter subject" || pgsTvKeyword_hidden == "") {
        $("#ajax_listOfOptions").css("display", "none");
        if ($('#fav_btn1').hasClass('act')) {
            $("#favourite").css("display", "none");
            $("#snippet").hide();
            $("#snippet_txt").show();
            $("#fav_btn1").removeClass("act");
            $("#fav_btn1").attr("id", "fav_btn");
        }
        $("#puni_errdiv1").css("display", "block");
        return false;
    }
    if (pgsTvUrlCat == 'C') {
        pgsTVUrlType = 'bt'
    } else if (pgsTvUrlCat == 'U') {
        pgsTVUrlType = 'ut'
    }
    pgsTVurl = "/" + pgsTvUrlkey + "-videos/" + pgsTVUrlType + "-" + pgsTvUrlId;
    // console.log(pgsTVurl);
    window.location.href = pgsTVurl;
    return false;
}

function uniNameValidate(name) {
    var specialChar = "\\,#%;?/_*!@$^()+={}[]|':<>.~`";
    if (name.indexOf('"') != -1) {
        return false;
    }
    for (var i = 0; i < specialChar.length; i++) {
        var str = (name).indexOf(specialChar.charAt(i));
        if (str != -1) {
            return false;
        }
    }
    return true;
}

function captialStr(string) 
{
    return string.charAt(0).toUpperCase() + string.slice(1);
}

function validateHomeSearch(obj, whichPage, gaqual) {
    var chkC = "";
    var chkQ = "";
    var chkU = "";
    var chkA = "";
    var keyword_rstring = "";
    var queryString = "";
    var colId;
    var gakeyword = "";
    var galocation = "";
    var gakey = 0;
    var keyword = "",
        keyword_hidden = "",
        search_keyword_hidden = "",
        search_location_hidden = "",
        location = "",
        location_hidden = "",
        qual_page_hidden = "",
        qual_hidden = "",
        keyword_hidden_text = "";
	if (whichPage == 'funding') {
        keyword = trimString($$D("keyword").value);
        keyword_hidden = trimString($$D("keyword_hidden").value);
        search_keyword_hidden = trimString($$D("search_keyword_hidden").value);
        //search_location_hidden = trimString($$D("search_location_hidden").value);
        //qual_hidden = trimString($$D("qual_hidden").value);
        //location = trimString($$D("location").value);
        //location_hidden = trimString($$D("location_hidden").value);
        //qual_page_hidden = trimString($$D("qual_page_hidden").value);
        keyword_hidden_text = trimString($$D("keyword_hidden_text").value);
    }
    else if (whichPage != "topNav") {
        keyword = trimString($$D("keyword").value);
        keyword_hidden = trimString($$D("keyword_hidden").value);
        search_keyword_hidden = trimString($$D("search_keyword_hidden").value);
        search_location_hidden = trimString($$D("search_location_hidden") ? $$D("search_location_hidden").value:"");
        qual_hidden = trimString($$D("qual_hidden").value);
        location = trimString($$D("location") ? $$D("location").value :"");
        location_hidden = trimString($$D("location_hidden") ? $$D("location_hidden").value:"");
        qual_page_hidden = trimString($$D("qual_page_hidden").value);
        keyword_hidden_text = trimString($$D("keyword_hidden_text").value);
    }
    var topkeyword = trimString($$D("topkeyword").value);
    var keyword_hidden_top = trimString($$D("keyword_hidden_top").value);
    var search_keyword_hidden_top = trimString($$D("search_keyword_hidden_top").value);
    var search_location_hidden_top = trimString($$D("search_location_hidden_top").value);
    var location_top = trimString($$D("location_top").value);
    var location_hidden_top = trimString($$D("location_hidden_top").value);
    var hyphenated_keyword = "";
    var hyphenated_location = "";
    
    if (qual_page_hidden != "hidden_home_page") {
        if ((qual_page_hidden != "" || qual_page_hidden != null) && (keyword == "" || keyword == null)) {
            qual_hidden = "";
        }
    }
    if (whichPage == "homesearch") {
        keyword = trimString($$D("keyword1").value);
        keyword_hidden = trimString($$D("keyword1_hidden").value);
        search_keyword_hidden = trimString($$D("search_keyword1_hidden").value);
        search_location_hidden = trimString($$D("search_location1_hidden").value);
        location = trimString($$D("location1").value);
        location_hidden = trimString($$D("location1_hidden").value);
    } else if (whichPage == "topNav") {
        keyword = trimString($$D("topkeyword").value);
        keyword_hidden = trimString($$D("keyword_hidden_top").value);
        search_keyword_hidden = trimString($$D("search_keyword_hidden_top").value);
        search_location_hidden = trimString($$D("search_location_hidden_top").value);
        location = trimString($$D("location_top").value);
        location_hidden = trimString($$D("location_hidden_top").value);
        keyword_hidden_text = $$D("keyword_hidden_text_top").value
    }

    if (whichPage == "channel_home") {
        var channel_qual_hidden = trimString($$D("channel_qual_hidden") ? $$D("channel_qual_hidden").value: "");
    }

    if ((keyword == "" || keyword == keyword_hidden_text) && (qual_hidden == "")) {
        if (whichPage == "home" || whichPage == "topNav" || whichPage == "funding" ) { //only for home page
            if (qual_page_hidden != "hidden_home_page") {
                alert("Enter subject or university");
                return false;
            } else {
                alert("Enter subject, qualification or university");
                return false;
            }
        }
    }
    chkC = keyword_hidden.indexOf("$$C");
    if (qual_hidden != "") {
        chkQ = qual_hidden.indexOf("$$Q");
    } else {
        chkQ = keyword_hidden.indexOf("$$Q");
    }
    chkU = keyword_hidden.indexOf("$$U");
    chkOl = location_hidden.indexOf("$$OL");
    chkA = keyword_hidden.indexOf("$$A");


    if (chkC != -1 || chkQ != -1 || chkU != -1 || chkA != -1) {
	    if (chkC != -1 && whichPage == 'funding' ) {
            var bcat = keyword_hidden.split("$$C");
            keyword_rstring = bcat[0];
            queryString = keyword_rstring;
            gakeyword =  keyword.replace(/[\. ,:-]+/g, "-");
            gakey = 1;
        }
        if (chkC != -1) {
            var bcat = keyword_hidden.split("$$C");
            keyword_rstring = bcat[0];
            queryString = "course=" + keyword_rstring;
            gakeyword = keyword;
            gakey = 1;
        }
        if (chkA != -1) {
            var bcat = keyword_hidden.split("$$A");
            keyword_rstring = bcat[1];
            queryString = keyword_rstring;
            gakeyword = keyword;
            gakey = 1;
        } else
        if (chkQ > -1 && chkU == -1) {
            var bqual = "";
            if (keyword_hidden != "" && keyword_hidden.indexOf("$$Q") > -1) {
                bqual = keyword_hidden.split("$$Q");
                if (keyword == 'Masters' || keyword == 'PhD' || keyword == 'PGDip' || keyword == 'MBA' || keyword == 'PGCE' || keyword == 'PGCert') {
                    queryString = "/" + bqual[0];
                } else {
                    queryString = "qualification=" + bqual[0];
                }
            } else if (qual_hidden != "" && qual_hidden.indexOf("$$Q") > -1) {
                bqual = qual_hidden.split("$$Q");
                if (keyword_hidden == null || keyword_hidden == "") {
                    if (search_keyword_hidden != null && search_keyword_hidden != "") {
                        if (!searchTextValidate(keyword)) {
                            alert("Enter valid subject, qualification or university");
                            $$D("keyword").value = "";
                            return false;
                        } else
                            queryString = "keyword=" + search_keyword_hidden;
                    }
                    gakeyword = keyword.replace(/[^\w\s]/gi, '');
                    gakey = 1;
                }				
                queryString = queryString != "" ? queryString + "&qualification=" + bqual[0] : "/" + bqual[0];
            }
        } else if (chkU > -1 && whichPage == 'funding'  ) {
            // univerprofileurl();
            uniProfileFlag = "Y";
            var colId = document.getElementById(ajax_list_activeInput.name + '_hidden').value;
            //alert(colId);
            var unicount = colId.indexOf("$$U");
            if (unicount > 0) {
                var a = colId.split("$$U");
                var ajaxURL = CommonObjects.pgs_context_path + "/pgs_browse.sch_provider_url_prc?p_college_id=" + a[1];
                var unipro = new sack();
                unipro.requestFile = ajaxURL;
                unipro.onCompletion = function () {
                    univprofileurlComplete(unipro)
                };
                unipro.runAJAX();
			 //GAInteractionEventTracking('','Scholarship search', 'Search', a[0], '');
            }
            return false;
        }
		else if (chkU > -1) {
            // univerprofileurl();
            uniProfileFlag = "Y";
            var colId = document.getElementById(ajax_list_activeInput.name + '_hidden').value;
            //alert(colId);
            var unicount = colId.indexOf("$$U");
            if (unicount > 0) {
                var a = colId.split("$$U");
                var ajaxURL = CommonObjects.pgs_context_path + "/pgs_browse.provider_url_prc?p_college_id=" + a[1];
                var unipro = new sack();
                unipro.requestFile = ajaxURL;
                unipro.onCompletion = function () {
                    univprofileurlComplete(unipro)
                };
                unipro.runAJAX();
            }
            return false;
        }
    } else {
        if (obj == "Y") {
            keyword = search_keyword_hidden;
		   if (!searchTextValidate(keyword)) {
                  alert("Enter valid subject or university ");
			      $$D("keyword").value = "";
                  return false;
		}
        } 
		else {
            if (keyword.length < 3 || keyword == 'Subjects matching your search' || keyword == 'Universities matching your search' || !searchTextValidate(keyword)) {

                if (!searchTextValidate(keyword)) {
                    alert("Enter valid subject, qualification or university");
                } else {
                    alert("Enter subject, qualification or university");
                }
                if (whichPage != "homesearch") {
                   // $$D("keyword").value = "";
					$("#keyword").val("");
                } else {
                    //$$D("keyword1").value = "";
					$("#keyword1").val("");
                }
                return false;
            }
        }
        hyphenated_keyword = keyword.replace(/\ +/g, "-"); //PGS_20161115	
        if (whichPage == "home" || whichPage == "homesearch" || whichPage == "funding") {
            queryString = "keyword=" + hyphenated_keyword; //PGS_20161115
            gakeyword = keyword.replace(/[^\w\s]/gi, '');
            gakey = 1;
        } else {
            if (keyword == 'Enter subject or university') {
                queryString = "keyword=";
            } else {
                queryString = "keyword=" + hyphenated_keyword; //PGS_20161115
                gakeyword = keyword.replace(/[^\w\s]/gi, '');
                gakey = 1;
            }
        }
    }	
    if (chkC != -1 || chkU != -1 || obj == "Y" || whichPage == "channel_home") {		
        if (whichPage == "channel_home") {						
		    if (queryString.indexOf("&qualification=") == -1){
               if (keyword_hidden.indexOf("$$A")) {
			    queryString = queryString;}
               else {
			   queryString = queryString + "&qualification=" + channel_qual_hidden;
			   }}
			var actualdiv = document.getElementsByClassName("optionDivSelected");
			var divid = (document.getElementsByClassName("optionDivSelected") && actualdiv.length>0) ? actualdiv[0].id : "";
			 if ($("body *").is('#qual_page_hidden_ga')){
                var qual = $$D("qual_page_hidden_ga").value +' search';  		   
				}
			 if ($("body *").is('#home_page_ga')){
		       var qual = $$D("home_page_ga").value;
		       }
			if(divid.indexOf("$$C") >= 0){
				GAInteractionEventTracking('topsearch', 'Search', qual + ' | subject',  search_keyword_hidden.toLowerCase(), "");
				}
			else if(divid.indexOf("$$U") >= 0){
				GAInteractionEventTracking('topsearch', 'Search', qual + ' | institution',  search_keyword_hidden.toLowerCase(), "");
				}
			else{
				GAInteractionEventTracking('topsearch', 'Search', qual, search_keyword_hidden.toLowerCase(), "");
				}				
		}
    }

    if (chkOl > -1) {
        queryString = queryString + "&study_mode=" + CommonObjects.pgs_default_online;

    } else {
        //queryString = queryString+"&p_stdy="+CommonObjects.pgs_default_stdy;
        if (location_hidden != "" && location_hidden != 'uk') {
            hyphenated_location = location_hidden.replace(/\ +/g, "-"); //PGS_20161115
            queryString = queryString + "&location=" + hyphenated_location;
            galocation = location_hidden;
        } else if (search_location_hidden != "") {
            hyphenated_location = search_location_hidden.replace(/\ /g, "-");
            queryString = queryString + "&location=" + hyphenated_location;
            galocation = search_location_hidden;
        }
    }
    setCookie('Nav_search_GA', 'Y', '', '/', '', '');
    if (chkQ > -1 && chkC == -1 && chkA == -1) {
        if ((keyword_hidden != "" && keyword_hidden.indexOf("$$Q") > -1) || (qual_hidden != "" && qual_hidden.indexOf("$$Q") > -1 && keyword != null && keyword != "")) {
            if (keyword == 'Masters' && search_keyword_hidden == 'masters' || keyword == 'PhD' && search_keyword_hidden == 'phd' || keyword == 'PGDip' && search_keyword_hidden == 'pgdip' || keyword == 'MBA' && search_keyword_hidden == 'mba' || keyword == 'PGCE' && search_keyword_hidden == 'pgce' || keyword == 'PGCert' && search_keyword_hidden == 'pgcert') {
                queryString = queryString;
            } else if (keyword_hidden != "" && keyword_hidden.indexOf("$$Q") > -1 || keyword_hidden != null && qual_hidden == "" || qual_hidden == null) {
                if (keyword == 'Masters' || keyword == 'PhD' || keyword == 'PGDip' || keyword == 'MBA' || keyword == 'PGCE' || keyword == 'PGCert') {
                    queryString = queryString;
                } else
                    queryString = CommonObjects.pgs_context_path + "/search?" + queryString;
            } else {
                queryString = CommonObjects.pgs_context_path + "/search?" + queryString;
            }
        } else if (qual_hidden != "" && qual_hidden.indexOf("$$Q") > -1) {
		   /*if ($("body *").is('#home_page_ga')){
		    var Ssearch = $$D("home_page_ga").value;
		    GAInteractionEventTracking('topsearch',  'Search' , Ssearch,search_keyword_hidden.toLowerCase(),"");
		   }*/
            queryString = queryString;
        }
        //queryString = CommonObjects.pgs_context_path+"/pgs_search.show_all_qual_landing_prc?"+queryString;
  //alert (whichPage || 'Sound');		
    } 
	else if (chkA == -1 && whichPage == 'funding' ) {	   
	   var Ssearch = $$D("ga_event").value;
	   var actualdiv = document.getElementsByClassName("optionDivSelected");
	   var divid = (document.getElementsByClassName("optionDivSelected") && actualdiv.length>0) ? actualdiv[0].id : "";
	   if ( search_keyword_hidden !== '' && keyword_hidden == '' ){
	    queryString = "/postgraduate-funding/?keyword=" + search_keyword_hidden.toLowerCase();}
	   else{queryString = "/postgraduate-funding/" + (gakeyword.toLowerCase()).replace(/[\. ,:-]+/g, "-");}
	    if(divid.indexOf("$$C") >= 0){
			GAInteractionEventTracking('topsearch',  'Search' , Ssearch + ' | subject', search_keyword_hidden.toLowerCase(), "");}	
	    else if(divid.indexOf("$$U") >= 0){
			GAInteractionEventTracking('topsearch',  'Search' , Ssearch + ' | institution', search_keyword_hidden.toLowerCase(), "");}
		else{
			GAInteractionEventTracking('topsearch',  'Search' , Ssearch,search_keyword_hidden.toLowerCase(),"");}		
    }
	else if (chkA == -1) {
    queryString = CommonObjects.pgs_context_path + "/search?" + queryString;
    }
    //alert($$D("homesearchform").action)
    if (galocation == 'uk') {
        galocation = '';
    }
    if (gakey == 1 || gakey == 0) {
   if (gaqual != "" && gaqual != null && gaqual != 'home') {
            var eventcat = gaqual + ' search';
        } else if ((whichPage != 'funding') && (whichPage != "channel_home")){
		   if ( whichPage == 'home') {
		   if ($("body *").is('#home_page_ga')){
		    var Ssearch = $$D("home_page_ga").value;
		   }
		   var actualdiv = document.getElementsByClassName("optionDivSelected");
	       var divid = (document.getElementsByClassName("optionDivSelected") && actualdiv.length>0) ? actualdiv[0].id : "";
		   if(divid.indexOf("$$C") >= 0 && qual_hidden != "" && qual_hidden != null ){
		        bqual = qual_hidden.split("$$Q");
				GAInteractionEventTracking('topsearch',  'Search' , captialStr(bqual[0]) + ' search | subject', gakeyword.toLowerCase(), "");}	
			else if(divid.indexOf("$$C") >= 0 ){
				GAInteractionEventTracking('topsearch',  'Search' , Ssearch + ' | subject', gakeyword.toLowerCase(), "");}	
			else if(divid.indexOf("$$U") >= 0){
				GAInteractionEventTracking('topsearch',  'Search' , Ssearch + ' | institution', gakeyword.toLowerCase(), "");}
			else if(divid.indexOf("$$Q") >= 0){
				GAInteractionEventTracking('topsearch',  'Search' , Ssearch , bqual[0].toLowerCase(), "");}
		    else if(divid.indexOf("$$A") >= 0 && qual_hidden != "" && qual_hidden != null ){
		        bqual = qual_hidden.split("$$A");
				GAInteractionEventTracking('topsearch',  'Search' , captialStr(bqual[0]) + ' search | Article', gakeyword.toLowerCase(), "");}	
			else if(divid.indexOf("$$A") >= 0 ){
		        bqual = qual_hidden.split("$$A");
				GAInteractionEventTracking('topsearch',  'Search' , Ssearch + ' | Article', gakeyword.toLowerCase(), "");}	
		    else if (search_keyword_hidden != "" && search_keyword_hidden != null && qual_hidden != "" && qual_hidden != null ){
				GAInteractionEventTracking('topsearch',  'Search' , captialStr(bqual[0]) + ' search',search_keyword_hidden.toLowerCase(),"");}
			else if (search_keyword_hidden != "" && search_keyword_hidden != null){
				GAInteractionEventTracking('topsearch',  'Search' , Ssearch,search_keyword_hidden.toLowerCase(),"");}
		   }
		   else {
		   GAInteractionEventTracking('topsearch', 'Search', gakeyword.toLowerCase(), galocation);
           }
        }
    }
    
    if (whichPage == "topNav") {
        $$D("homesearchtop").action = queryString;
    } else {
        $$D("homesearchform").action = queryString;
    }
  window.location.href = queryString;
    //alert($$D("homesearchform").action)
    //$$D("homesearchform").submit();
}
/*End home search*/

function setQual(o, inId, id) {
    var val = (o.innerHTML);
    val = val.replace("&amp;", "&");
    $$D(inId).value = val;
    $$D(id).style.display = 'none'
    //toggleQualList();
    if ((o.innerHTML) != null && (o.innerHTML) == 'Northern Ireland' || (o.innerHTML) == 'England' || (o.innerHTML) == 'Scotland' || (o.innerHTML) == 'Wales') {
        if ($$D('addFinder') != null) {
            $$D('addFinder').style.display = 'block';
        }
        //$$D('postaddid').style.display = 'block';

    } else {
        if ($$D('addFinder') != null) {
            $$D('addFinder').style.display = 'none';
        }
        if ($$D('postaddid') != null) {
            $$D('postaddid').style.display = 'none';
        }
    }
}

function toggleQualList(id) {
    if ($("#favourite").is(':visible')) {
        call_unfavourite();
    }
    if ($$D(id).style.display == 'none') {
        //$$D(id).style.display = 'block';
        if ($("#" + id).parents('.srlist').length) {
            $(".srlist").find("#" + id).slideDown("slow");
        } else {
            $$D(id).style.display = 'block';
        }
    } else {
        if ($("#" + id).parents('.srlist').length) {
            $(".srlist").find("#" + id).slideUp("slow");
        } else {
            $$D(id).style.display = 'none';
        }

    }
}

function submitLogin(obj) {
    var errorfound = "FALSE";
    var redirect_url;
    var personal_note = "";
    var w = $$D('w').value;
    var z = $$D('z').value;
    var clgName = $$D('clgName').value;
    var fromType = $$D('p_from_type').value;
    var lbxType = $$D('p_lbx_type').value;
	
    if ($$D("redirect_url")) {
        redirect_url = encodeURIComponent(trimString($$D("redirect_url").value));
    }
    if ($$D("p_from_page")) {
        var page = $$D("p_from_page").value;
    }
    if ($$D("p_bur_subject")) {
        var p_subject = $$D("p_bur_subject").value;
    }
    if ($$D("p_from")) {
        var page1 = $$D("p_from").value;
    } else {
        page = '';
    }
    if ($$D("p_personal_note")) {
        personal_note = encodeURIComponent($$D("p_personal_note").value);
    }
    var pemail = $$D("pm_email");
    var pemail_hidden = $$D("pm_email_hidden");
    blockNone("pmemail_errdiv", "none");
    pemail.className = "";
    var prem = $$D("p_rem");
    if (isEmpty(pemail.value) || pemail.value == pemail_hidden.value) {
        pemail.className = setErrborder;
        errorfound = "TRUE";
        $$D("pmemail_errmsg").innerHTML = ErrorMessage.error_empty_email;
        blockNone("pmemail_errdiv", "block");
    }
    var ppassw = $$D("pm_passw");
    var ppassw_hidden = $$D("pm_passw_hidden");
    blockNone("pmpassw_errdiv", "none");
    ppassw.className = "";
    if (isEmpty(ppassw.value) || ppassw.value == ppassw_hidden.value) {
        ppassw.className = setErrborder;
        errorfound = "TRUE";
        $$D("pmpassw_errmsg").innerHTML = ErrorMessage.error_empty_passw;
        blockNone("pmpassw_errdiv", "block");
    }
    if (errorfound == "FALSE") {
        var strSend = "pm_email=" + pemail.value + "&pm_passw=" + encodeURIComponent(ppassw.value) + "&z=" + $$D("z").value + "&w=" + $$D("w").value + "&p_order_item=" + $$D("p_order_item_id").value + "&p_from=" + $$D("p_from").value + "&p_from_page=" + page + "&p_url=" + redirect_url + "&p_personal_note=" + personal_note + "&p_bur_subject=" + p_subject + "&p_lbx_type=" + lbxType;

        if (prem.checked) {
            strSend = strSend + "&p_rem=Y";
        } else {
            strSend = strSend + "&p_rem=N";
        }
        //alert('p_rem');
        var ajaxURL = CommonObjects.pgs_context_path + "/pgs_user.do_login_lbx?" + strSend;
        //alert(ajaxURL);
        var ajax = new sack();
        ajax.requestFile = ajaxURL;
        ajax.onCompletion = function () {
            if (fromType == 'pdf') {
                if (loginResponse(ajax, 'pdf')) {
                    pdfRedirect(z, w, clgName, 'loginlbx');
                    GAInsightEventTracking(z, w, 'PDF');
                }
            } else if (page == 'CD') {
                call_ga_reload(ajax);
            } else if (page1 == 'CP') {
                loginResponse(ajax, page1);
            } else if (page1 == 'compare_page' || page1 == 'webclick-comparison') {
                loginResponse(ajax, page1);
            } else {
                loginResponse(ajax, '');
            }
        };
        ajax.runAJAX();
        return false;
        showPGSLightBox('login-submit', '650', '350', strSend);
    }
    return false;
}

function call_ga_reload(ajax) {
    var response = trimString(ajax.response);
    if (response == 'SUCCESS') {
        document.location.reload(true)
    } else {
        $$D("lightbx").innerHTML = response;
        $$D("ajax-div").style.display = "none";
        $$D("lightbx").style.display = "block";
        $$D("newvenueform").style.display = "block";
    }
}

function personalresp(personal, cnt) {
    var response = trimString(personal.response);
    if (response == 'SUCCESS') {
        blockNone("save_" + cnt, "block");
        blockNone("loader_" + cnt, "none");
        blockNone("note_" + cnt, "block");
        $("#note_" + cnt).delay(2000).fadeOut();
    } else if (response = 'ERROR') {
        blockNone("save_" + cnt, "block");
        blockNone("loader_" + cnt, "none");
    }
}

function addpersonalnote_s(basket_id, cnt) {
    var p_text = trimString($$D("pn_" + basket_id).value);
    if (p_text == 'Enter any comments here' || p_text == '') {
        alert('Enter any comments here');
    } else {
        blockNone("save_" + cnt, "none");
        blockNone("loader_" + cnt, "block");
        var url = '/pgs/mypgs_compare_pkg.personal_note_prc?p_basket_id=' + basket_id + '&p_personal_notes=' + p_text;
        var personal = new sack();
        personal.requestFile = url; // Specifying which file to get
        personal.onCompletion = function () {
            personalresp(personal, cnt);
        }; // Specify function that will be executed after file has been found
        personal.runAJAX();
    }
}

function loginResponse(ajax, page) {
    var response = ajax.response.split(CommonObjects.split_char);
    var redirect_url;
    var screenWidth = jqueryWidth();
    if (trimString(response[0]) == 'SUCCESS') {
        //alert('if');		
        if (page == 'pdf') {
            return true;
        }
        if (response[1] != null && response[1] != ' ') {
            eval(response[1]);
        }
        if ((screenWidth > 992 || ($("#ol").is(':visible'))) && page != "" && page == "CP") {
            window.location.assign(pgs_domain);
        } else if (page == 'compare_page' || page == 'webclick-comparison') {
            window.location.assign("/pgs/mypgs_compare_pkg.compare_course_prc");
        } else if (screenWidth > 992 || ($("#ol").is(':visible'))) {
            closeLightbxContinue();
        } else {
            if ($$D("redirect_url")) {
                redirect_url = encodeURIComponent(trimString($$D("redirect_url").value));
                if (page == "CP") {
                    window.location.assign(pgs_domain);
                } else {
                    window.location.href = decodeURIComponent(redirect_url);
                }
            }
        }
    } else {
        $$D("lightbx").innerHTML = response;
        $$D("ajax-div").style.display = "none";
        $$D("lightbx").style.display = "block";
        $$D("newvenueform").style.display = "block";
        var elements = $("script[id^='iterate']");
        if (elements.length > 0) {
            for (var i = 1; i <= elements.length; i++) {
                eval($$D('iterate' + i).innerHTML);
            }
        }
    }
		if($$D('domnScptId')){ 		
   eval($$D("domnScptId").innerHTML);   
   }
}

function submitpwdReminder() {
    var errorfound = "FALSE";
    var pemail = $$D("pm_email");
    var pemail_hidden = $$D("pm_email_hidden");
    blockNone("pmemail_errdiv", "none");
    pemail.className = "";
    if (isEmpty(pemail.value) || pemail.value == pemail_hidden.value) {
        pemail.className = setErrborder;
        errorfound = "TRUE";
        $$D("pmemail_errmsg").innerHTML = ErrorMessage.error_empty_email;
        blockNone("pmemail_errdiv", "block");
    }
    if (errorfound == "FALSE") {
        var strSend = "pm_email=" + pemail.value;
        showPGSLightBox('pwdreminder-submit', '650', '350', strSend);
    }
    return false;
}
/*End of Login register*/
function isValidUKpostcode(postcode) {
    var newPostCode = checkPostCode(postcode);
    if (newPostCode) {
        return true;
    } else {
        // alert('Please enter valid postcode');
        return false;
    }
}
/*continue to searcbox*/
function closeLightbxContinue() {
    if ($$D("redirect_url")) {
        var redirect_url = trimString($$D("redirect_url").value);
        if (redirect_url != null || redirect_url != "") {
            redirect_url = encodeURIComponent(redirect_url);
            window.location.href = decodeURIComponent(redirect_url);
            return;
        }
    }
    hm();
    document.location.reload(true);
}
/*Logout*/
function userLogout(cName) {

    if (unsavedMail == false) {
	
		var url = CommonObjects.pgs_context_path + '/delete_cookie_val_prc';
		 url = url+"?p_name="+cName;
		 var cookie_ajax = new sack();
		cookie_ajax.requestFile = url;
		//var rurl = window.location.protocol + "//" + window.location.hostname;
		cookie_ajax.onCompletion = function ( ) {
		document.location.href =window.location.protocol + "//" + window.location.hostname;
		  //  UserpdfComplete(cookie_ajax);
		};
		cookie_ajax.runAJAX();
        /*var url = window.location.protocol + "//" + window.location.hostname;
        deleteCookie(cName, '/');
        deleteCookie('pgsuid', '/');
        deleteCookie('pgs_track_id', '/');
        window.location.assign(url);*/
		
    } else {
        if ($$D("mail_a_href")) {
            $$D("mail_a_href").value = 'LOGOUT';
            showPGSLightBox('my_profile_alert', '665', '520', '');
        }
    }

}

/*video roll over scripts*/
function getTopPosition(inputObj) {
    var returnValue = inputObj.offsetTop;
    while ((inputObj = inputObj.offsetParent) != null) {
        returnValue += inputObj.offsetTop;
    }
    return returnValue;
}

function getLeftPosition(inputObj) {
    var returnValue = inputObj.offsetLeft;
    while ((inputObj = inputObj.offsetParent) != null) returnValue += inputObj.offsetLeft;
    return returnValue;
}

function getLeftPosition1(inputObj) {
    var returnValue = inputObj.offsetLeft;
    return returnValue;
}

function videoRollhover1(objId, id) {
    var browserWidth = $(window).width();
    var left = getLeftPosition1($$D(objId));
    var top = getTopPosition($$D(objId));
    $$D(id).style.display = "block";
    $$D(id).style.position = "absolute";
    $$D(id).style.left = (parseInt(left) + 127) + (browserWidth <= 1024 ? -136 : (browserWidth <= 1280 ? -43 : 0)) + "px";
    $$D(id).style.top = (parseInt(top) - 74) + "px";
    $$D(id).style.zIndex = "990";
}

function videoRollhover(objId, id) {
    var left = getLeftPosition($$D(objId));
    var top = getTopPosition($$D(objId));
    $$D(id).style.display = "block";
    $$D(id).style.position = "absolute";
    $$D(id).style.left = (left - 37) + "px";
    $$D(id).style.top = (top - 74) + "px";
    $$D(id).style.zIndex = "990";
}
/*Video light box*/
function videoLightbox(collegeId, courseId, videoId, videoWebsiteId, subOrderItemId, profileId, pgstv_flag) {
    // console.log(CommonObjects.pgsjws_flag);
    var pgs_jsdomain = pgs_scheme + $$D("p_js").value;
    if (CommonObjects.pgsjws_flag == 'Y') {
        CommonObjects.pgsjws_flag = 'N';
        var src = pgs_jsdomain + "/pgs-cont/scripts/player/jwplayer.js";
    }
    var vdStrSend = "";
    vdStrSend = "p_college_id=" + collegeId + "&p_profile_id=" + profileId + "&p_suborder_item_id=" + subOrderItemId + "&p_video_id=" + videoId +
        "&p_website_video_id=" + videoWebsiteId + "&p_pgstv_flag=" + pgstv_flag;
    if ($$D("mypgs_videos")) {
        vdStrSend = vdStrSend + "&p_mypgs_flag=Y";
    }
    //console.log(vdStrSend);
    //setTimeout(function(){showPGSLightBox('video-light-box','980','900', vdStrSend)},1000); 
    loadJSFile(src, vdStrSend);
    //showPGSLightBox('video-light-box','980','900', vdStrSend);   
}

function loadJSFile(src, vdStrSend) {
    var scriptElement = document.createElement("script");
    scriptElement.setAttribute("type", "text/javascript");
    scriptElement.setAttribute("src", src);
    // Handled for IE 6 & 7
    if (navigator.userAgent.indexOf('MSIE') >= 0) {
        scriptElement.onreadystatechange = function () {
            if (this.readyState == 'loaded' || this.readyState == 'complete') {
                showPGSLightBox('video-light-box', '980', '900', vdStrSend);
                //callBack();
            }
        }
    } else { //For other browsers
        scriptElement.onload = showPGSLightBox('video-light-box', '980', '900', vdStrSend);
    }
    if (typeof scriptElement != "undefined") {
        document.getElementsByTagName("head")[0].appendChild(scriptElement);
    }
}

function bit_url(url, title, flag) {
    var url = url;
    var title = encodeURIComponent(title);
    var turl = 'https://twitter.com/share?url=';
    var bit_url_res;
    var username = "o_1al2folk75"; // bit.ly username
    var key = "R_1aaa2f1986269e187fce5bab96e3953a";
    $.ajax({
        url: "https://api-ssl.bitly.com/v3/shorten",
        data: {
            longUrl: url,
            apiKey: key,
            login: username
        },
        dataType: "jsonp",
        success: function (v) {
            bit_url_res = v.data.url;
            bitUrlForsharing = v.data.url;
            //alert(bitUrlForsharing);
            turl = turl + bit_url_res + '&text=' + title + ' @pgsearch';
            if (flag == 'Y') {
                return false;
            } else {
                window.open(turl);
            }
        }
    });
}

function searchTextValidate(name) {
    if (trimString(name).length == 0) {
        return false;
    }
    var specialChar = "\\,#%;?/_-&*!@$^()+={}[]|':<>.~`";
    if (name.indexOf('"') != -1) {
        return false;
    }
    for (var i = 0; i < specialChar.length; i++) {
        var str = (name).indexOf(specialChar.charAt(i));
        if (str != -1) {
            return false;
        }
    }
    return true;
}

function findAddress(pid, flag, divId) {
    var p_enqpc_hidden = $$D(pid);
    //alert(faPostcode.value);
    //alert(p_enqpc_hidden.value);
    var newPostCode = checkPostCode(p_enqpc_hidden.value);
    if (newPostCode) {
        //if (divId="p_enqpc_cd") {  }
        if ($$D(divId)) {
            blockNone(divId, "none");
            $$D(pid).className = "";
        }
        if (flag == 'J') {
            $$D('p_postcode_find').className = "err_rte";
            blockNone("p_postcode_find_err", 'none');
            blockNone("p_postcode_find_suc", 'block');

        }
        if ($$D("p_postcode_errmsg") && $$D("p_postcode_sucmsg")) { //PGS_20160621
            blockNone("p_postcode_errmsg", 'none');
            blockNone("p_postcode_sucmsg", 'block');
            $('#' + 'post_code').removeClass("err_wrg");
            $('#' + 'post_code').addClass("err_rte");

        }
        p_enqpc_hidden.value = newPostCode;
    } else {
        if (flag != 'J' && !$$D("p_postcode_errmsg")) {
            alert('Please enter valid postcode');
        } else if ($$D("p_postcode_errmsg") && $$D("p_postcode_sucmsg")) { //PGS_230160621 
            blockNone("p_postcode_sucmsg", 'none');
            blockNone("p_postcode_errmsg", 'block');
            blockNone("addressDrop", 'none');
            $('#' + 'post_code').removeClass("err_rte");
            $('#' + 'post_code').addClass("err_wrg");

        } else {
            $$D('p_postcode_find').className = "err_wrg";
            $$D("p_postcode_find_err").innerHTML = "Please enter valid postcode";
            blockNone($$D('p_postcode_find').id + "_err", 'block');
            blockNone($$D('p_postcode_find').id + "_suc", 'none');
        }

        return false;
    }
    var ajaxURL = CommonObjects.pgs_context_path + "/obj_pls_get_address?p_postcode=" + p_enqpc_hidden.value + "&p_flag=" + flag;
    //alert(ajaxURL);
    var ajax = new sack();
    ajax.requestFile = ajaxURL;
    ajax.onCompletion = function () {
        findAddressResponse(ajax, flag);
    };
    ajax.runAJAX();
    return false;
}


function findAddressResponse(ajax, flag) {
    var response = ajax.response;
    //alert(ajax.response);
    //alert(postaddid);
    if (response == "" || response == null) {
        //$$D("uk postcode/zip code_errmsg").innerHTML="Postcode cannot be found. Please check the postcode, or enter your address manually ";	
        //$$D("uk postcode/zip code_errdiv").style.display="block";
        if (flag == "DP") {
            $$D("penqpc_errmsg_dp").innerHTML = "Postcode cannot be found. Please check the postcode, or enter your address manually ";
            $$D("penqpc_errdiv_dp").style.display = "block";
        } else if (flag == "J") {
            $$D('p_postcode_find').className = "err_wrg";
            $$D($$D('p_postcode_find').id + "err").innerHTML = "Postcode cannot be found. Please check the postcode, or enter your address manually ";
            blockNone($$D('p_postcode_find').id + "_err", 'block');
            blockNone($$D('p_postcode_find').id + "_suc", 'none');
        } else {
            $$D("penqpc_errmsg").innerHTML = "Postcode cannot be found. Please check the postcode, or enter your address manually";
            $$D("penqpc_errdiv").style.display = "block";
        }
        if ($$D("postaddid_dp")) {
            $$D("postaddid_dp").style.display = "none";
        } else {
            $$D("postaddid").style.display = "none";
            if ($$D('signup_add_dd')) {
                $$D("signup_add_dd").style.display = "none";
            }
        }

        if ($$D("addressDrop")) {
            blockNone("addressDrop", 'none'); //PGS_20160621 
        }
    } else {
        if ($$D("postaddid_dp") && flag == "DP") {
            $$D("postaddid_dp").innerHTML = response;
            $$D("postaddid_dp").style.display = "block";
        } else if ($$D("postaddid_cd")) {
            $$D("postaddid_cd").innerHTML = response;
            $$D("postaddid_cd").style.display = "block";
        } else if ($$D("addressDrop")) { //PGS_20160621 
            $$D("addressDrop").innerHTML = response;
            blockNone("addressDrop", 'block');
        } else {
            $$D("postaddid").innerHTML = response;
            $$D("postaddid").style.display = "block";
            if ($$D('signup_add_dd')) {
                $$D("signup_add_dd").style.display = "block";
            }
        }

    }

}


function fillAddresess(obj, flag) {
    var selectionId = obj.id
    var el = document.getElementById(selectionId);
    var AddressString = el.options[el.selectedIndex].value;
    var AddressArray = new Array();
    //alert(AddressString);

    if ((AddressString == "Please Select") && flag != "CD" && flag != "J" && flag != "N") {
        AddressArray[0] = "Address line 1*";
        AddressArray[1] = "Address line 2";
        AddressArray[2] = "Town/City*";
        AddressArray[3] = "Postcode*";
    } else if ((AddressString == "Please Select") && (flag == "CD" || flag == "J" || flag == "N")) {
        AddressArray[0] = "";
        AddressArray[1] = "";
        AddressArray[2] = "";
        AddressArray[3] = "";
    } else {
        AddressArray = AddressString.split("###");
    }
    if (flag == 'N') {
        $$D("p_addr_1").value = AddressArray[0];
        $$D("p_addr_2").value = AddressArray[1];
        $$D("p_town").value = AddressArray[2];
        $$D("p_enqpc").value = AddressArray[3];
        //PGS_20160621
        if (AddressArray[0] == "" || AddressArray[0] == null) {
            $($$D("p_addr_1")).next('label').removeClass("top_lb");
            $($$D("p_addr_2")).next('label').removeClass("top_lb");
            $($$D("p_town")).next('label').removeClass("top_lb");
            $($$D("p_enqpc")).next('label').removeClass("top_lb");
        } else {
            $($$D("p_addr_1")).next('label').addClass("top_lb");
            $($$D("p_addr_2")).next('label').addClass("top_lb");
            $($$D("p_town")).next('label').addClass("top_lb");
            $($$D("p_enqpc")).next('label').addClass("top_lb");
        }
    } else if (flag == 'DP') {
        $$D("p_addr_1_dp").value = AddressArray[0];
        $$D("p_addr_2_dp").value = AddressArray[1];
        $$D("p_town_dp").value = AddressArray[2];
    } else if (flag == 'M') {
        $$D("p_addr1").value = AddressArray[0];
        $$D("p_addr2").value = AddressArray[1];
        $$D("p_townc").value = AddressArray[2];
        $$D("postcoder").value = AddressArray[3];
    } else if (flag == 'K') {
        $$D("p_addr1").value = AddressArray[0];
        $$D("p_addr2").value = AddressArray[1];
        $$D("p_town").value = AddressArray[2];
        $$D("p_enqpc2").value = AddressArray[3];
    } else if (flag == 'J') {
        $$D("p_addr1").value = AddressArray[0];
        $$D("p_addr2").value = AddressArray[1];
        $$D("p_town").value = AddressArray[2];
        $$D("p_postcode").value = AddressArray[3];
    } else if (flag == 'CD') {
        $$D("p_addr_1_cd").value = AddressArray[0];
        $$D("p_addr_2_cd").value = AddressArray[1];
        $$D("p_town_cd").value = AddressArray[2];
    } else {
        $$D("av186").value = AddressArray[0];
        $$D("av187").value = AddressArray[1];
        $$D("av188").value = AddressArray[2];
        $$D("postcoder").value = AddressArray[3];
    }
}

function collegeQLAutoComplete(obj, paramToExternalFile, e) {
    var urlPrc = 'pgs_ajax_pkg.ajax_search_college';
    var param1 = 'p_ajax_type=A'; // Ajax type 
    ajax_showOptions(obj, paramToExternalFile, e, urlPrc, param1);
}

/*
function validateScholarshipSearch(obj) {
    var psubject_id = trimString($$D("ps_subject_id").value);
    var pcountry_id = trimString($$D("ps_country_id").value);
    var pawardtyp_id = trimString($$D("ps_award_typ_id").value);
    var pawardcov_id = trimString($$D("ps_award_cov_id").value);
    var ppagename = trimString($$D("p_page_name").value);
    var pcollegename = trimString($$D("p_college_name").value);
	
	var psubject_name = trimString($$D("ps_subject_name").value);
    var pcountry_name = trimString($$D("ps_country_name").value);
    var pawardtyp_name = trimString($$D("ps_award_typ_name").value);
    var pawardcov_name = trimString($$D("ps_award_cov_name").value)
	
    //alert (trimString($$D("ps_college_id_hidden").value));
    if (ppagename == "scholarship_homepage") {

        if (trimString($$D("ps_college_id_hidden").value) == 0) {
            var pgsSCHurl = "/postgraduate-funding/fr-" + psubject_id + "-" + pcountry_id + "-0-" + pawardtyp_id + "-" + pawardcov_id + "-1";
        } {
            //pgsSCHurl = pgsSCHurl;
            window.location.href = pgsSCHurl;
        }
		var pcol = trimString($$D("ps_college_id_hidden").value) ? trimString($$D("ps_college_id_hidden").value) : "";
		
		if ((psubject_id == null || psubject_id == 0) &&
		   (pcountry_id == null || pcountry_id == 0) &&
		   (pawardtyp_id == null || pawardtyp_id == 0) && 
		   (pawardcov_id == null || pawardcov_id == 0) &&
		   (pcol == null || pcol == 0)){
			   alert("Enter university");
                return false;
		   }
		
		if (pcol != null && pcol !="" && pcol !=0){
        if (trimString($$D("ps_college_id_hidden").value) != null && trimString($$D("ps_college_id_hidden").value) != 0 && psubject_id == 0 && pcountry_id == 0 && pawardtyp_id == 0 && pawardcov_id == 0) {
            var pscollege_id = trimString($$D("ps_college_id").value);
        }
        var pgsSCHurl = "";
        var pcollege_id = trimString($$D("ps_college_id_hidden").value);
        if (pscollege_id == 'University') {
            pcollege_id = 0;
        }			
		}		
		
        var colId = $$D(ajax_list_activeInput.name + '_hidden') ? $$D(ajax_list_activeInput.name + '_hidden').value : "";
		//$$D(ajax_list_activeInput.name + '_hidden').value;
		if (colId != null && colId !=""){
        var a = colId.split("$$U");		
        var pgsSCHurl = pgs_domain + "/postgraduate-funding-" + a[0] + "/";					
		}
    } else if (ppagename == "scholarship_university_page") {

        var pcollid = $$D("p_coll_id");
        pgsSCHurl = "/postgraduate-funding-" + pcollegename + "/fu-" + psubject_id + "-" + pcountry_id + "-" + pcollid.value + "-" + pawardtyp_id + "-" + pawardcov_id + "-1";
    }
    if ((psubject_id == 0 || psubject_id == "") && (pcountry_id == 0 || pcountry_id == "") && (pcollege_id == 0 || pcollege_id == "") && (pawardtyp_id == 0 || pawardtyp_id == "") && (pawardcov_id == 0 || pawardcov_id == "")) {
        pgsSCHurl = "/funding";
        window.location.href = pgsSCHurl;
    } else {
        //return;
        window.location.href = pgsSCHurl;
    }
}
*/
function setSelectedtoSchSpan(obj, spanid) {
    var selectionId = obj.id;
    var el = $$D(selectionId);
    var text = el.options[el.selectedIndex].text;
    $$D(spanid).innerHTML = text;
}

function collegeAutoComplete(obj, paramToExternalFile, e) {
    var urlPrc = 'pgs_ajax_pkg.ajax_search_college';
    var param1 = 'p_ajax_type=U'; // Ajax type 
    ajax_showOptions(obj, paramToExternalFile, e, urlPrc, param1);
}

/*basket function*/
function showSrt(assoc_id, page) {
    var clName;
    if (page == "search") {
        clName = "cmp_cnr";
    } else {
        clName = "adsh";
    }
    if ($$D("bskt" + assoc_id).className == clName) {
        $$D("addremId" + assoc_id).innerHTML = "Add to Shortlist";
        $$D("show" + assoc_id).style.display = "block";
    } else if (page != 'search') {
        $$D("addremId" + assoc_id).innerHTML = "Remove from Shortlist";
        $$D("show" + assoc_id).style.display = "block";
    }
}

function hideSrt(assoc_id) {
    $$D("show" + assoc_id).style.display = "none";
}

function addRemoveBasket(basket_id, userId, assoc_id, assoc_type, assoc_text, page) {
    if ($$D('chkbsk' + assoc_id)) {
        if ($("#mbox").is(':hidden') || $('.cm_mbox').is(':visible'))
            if ($$D('chkbsk' + assoc_id).value == "ADD") {
                addToBasket(basket_id, userId, assoc_id, assoc_type, assoc_text, page);
            }
        else {
            removeBasket(basket_id, assoc_id, assoc_text, page);
        }
    } else if ($$D('lbbskt' + assoc_id)) {
        if ($$D('lbbskt' + assoc_id).value == "REMOVE") {
            addToBasket(basket_id, userId, assoc_id, assoc_type, assoc_text, page);
        } else {
            removeBasket(basket_id, assoc_id, assoc_text, page);
        }
    } else {
        return 'N';
    }
}

function addToBasket(basket_id, userId, assoc_id, assoc_type, assoc_text, page) {
    var url = '/pgs/mypgs_compare_pkg.add_basket_prc?p_basket_id=' + basket_id + '&p_user_id=' + userId + '&p_assoc_id=' + assoc_id + '&p_assoc_type=' + assoc_type;
    var wish = new sack();
    wish.requestFile = url; // Specifying which file to get
    wish.onCompletion = function () {
        addBasketComplete(wish, assoc_id, assoc_text, userId, page);
        if ($$D("show" + assoc_id)) {
            hideSrt(assoc_id);
        }
        if ($$D("lbshow" + assoc_id)) {
            hideSrtlb(assoc_id);
        }
    }; // Specify function that will be executed after file has been found
    wish.runAJAX();
}

function addBasketComplete(wish, assoc_id, assoc_text, userId, page) {
    var abresp = wish.response.split(CommonObjects.split_char);
    var clName = 'active';
    /*if (page == "search"){clName="cmp_cnr active";}
    else{clName="adsh active";}*/
    //alert($$D('bskt'+assoc_id).className);			//PGS_20150811
    if ($$D('bskt' + assoc_id)) {
        // if($$D('vcmp'+assoc_id)){ $$D('vcmp'+assoc_id).style.display ="block"; }
        // if($$D('bskt'+assoc_id).className == "adsh")
        // { clName="adsh active"; }
        // else if($$D('bskt'+assoc_id).className == "cmp_cnr")
        // { clName="cmp_cnr active"; }
        if (trimString(abresp[1]) == 'ERROR') {
            alert('some error occured');
        }
        if (trimString(abresp[1]) == 'SUCCESS') {
            var slst_cnt = trimString(abresp[2]);
            //$$D('bskt'+assoc_id).className = clName;		//PGS_20150811
            $('#bskt' + assoc_id).addClass(clName); //PGS_20160419 fix
            if ($$D('vcmp' + assoc_id)) {
                $$D('vcmp' + assoc_id).style.display = "block";
            }; //PGS_20160726 fix
            $$D('chkbsk' + assoc_id).value = "REMOVE";
            if ($$D("outer") != null) {
                if (slst_cnt >= 1) {
                    $$D("inner").style.display = "none";
                    $$D("outer").style.display = "block";
                }
            }
            if ($$D("slstcnt") != null) {
                $$D("slstcnt").innerHTML = '( ' + slst_cnt + ' ) Courses shortlisted';
            }
            var Currentdate = new Date();
            var numberOfDaysToAdd = 365 / 2;
            Currentdate.setDate(Currentdate.getDate() + numberOfDaysToAdd);
            setCookie('pgs_bsktid', abresp[0].replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g, '').replace(/\s+/g, ' '), Currentdate, '/', '', '');
            if (userId == null || userId == "") {
                setCookie('wcache', 'unlogged', '', '/');
            }
            if (page != "inner") {
                GAInteractionEventTracking('view comparison', 'view comparison', 'clicked', assoc_text);
                var substrLimit = assoc_text.indexOf(':') + 1;
                var collName;
                if (substrLimit > 0) {
                    collName = trimString(assoc_text.substring(substrLimit));
                } else {
                    collName = trimString(assoc_text);
                };
                ga('newTracker.send', 'event', 'view comparison', 'clicked', collName);
            } /*GA Logging devika*/
        } else {
            if ((trimString(abresp[1]) == 'TOO_MANY_COMPARISON') && (page != "inner")) {
                showPGSLightBox('too_many_comp', '650', '350', '');
            }
        }
    }
    return abresp[1];
}

function removeBasket(basket_id, assoc_id, assoc_text, page) {
    var url = '/pgs/mypgs_compare_pkg.remove_basket_contents_prc?p_basket_id=' + basket_id + '&p_assoc_id=' + assoc_id;
    var wish = new sack();
    wish.requestFile = url; // Specifying which file to get
    wish.onCompletion = function () {
        removebasketComplete(wish, assoc_id, assoc_text, page);
    }; // Specify function that will be executed after file has been found
    wish.runAJAX();
}

function removebasketComplete(wish, assoc_id, assoc_text, page) {
    var arresp = wish.response.split(CommonObjects.split_char);
    var clName = 'active';
    if ($$D('bskt' + assoc_id)) {
        // if($$D('vcmp'+assoc_id)){ $$D('vcmp'+assoc_id).style.display ="none"; }
        // if($$D('bskt'+assoc_id).className == "adsh active")
        // { clName="adsh"; }
        // else if($$D('bskt'+assoc_id).className == "cmp_cnr active")
        // { clName="cmp_cnr"; }  
        if (trimString(arresp[0]) == 'ERROR') {
            alert('some error occured');
        }
        if (trimString(arresp[0]) == 'SUCCESS') {
            //$$D('bskt'+assoc_id).className = clName;
            $('#bskt' + assoc_id).removeClass(clName); //PGS_20160419 fix
            if ($$D('vcmp' + assoc_id)) {
                $$D('vcmp' + assoc_id).style.display = "none";
            }; //PGS_20160726 
            $$D('chkbsk' + assoc_id).value = "ADD";
            if ($$D("slstcnt") != null) {
                var msg = $$D("slstcnt").innerHTML;
                var n = msg.indexOf(" )");
                n = n - 1;
                var res = msg.substr(2, n);
                res = res - 1;
                if (res <= 0) {
                    $$D("inner").style.display = "block";
                    $$D("outer").style.display = "none";
                    res = 0;
                }
                $$D("slstcnt").innerHTML = '( ' + res + ' ) Courses shortlisted';
            }
        }
        if (page != "inner") {
            GAInteractionEventTracking('view comparison', 'view comparison', 'removed', assoc_text);
        } /*GA Logging devika*/
    }
}

function addTopersonalList(user_id, college_id, course_id, i, p_type, event_id) {
    var p_text = trimString($$D('p_personal_id' + i).value);
    //$$D('note_'+i).style.display ="block";
    if (college_id == '' || college_id == null) {
        college_id = 0;
    }
    if (course_id == '' || course_id == null) {
        course_id = 0;
    }
    if (p_text == 'Enter any comments here' || p_text == '') {
        alert('Please enter any comments here');
    } else {
        var url = '/pgs/mypgs_pkg.store_personal_notes_prc?p_user_id=' + user_id + '&p_college_id=' + college_id + '&p_course_id=' + course_id + '&p_type=' + p_type + '&p_event_id=' + event_id + '&p_note_text=' + p_text;
        var wish = new sack();
        wish.requestFile = url;
        wish.onCompletion = function () {
            $$D('note_' + i).style.display = "block";
        };
        wish.runAJAX();
    }
}

function removecontent(id, bsktid, divid) {
    var url = '/pgs/mypgs_compare_pkg.remove_basket_contents_prc?p_basket_id=' + bsktid + '&p_assoc_id=' + id;
    var delwish = new sack();
    delwish.requestFile = url; // Specifying which file to get
    delwish.onCompletion = function () {
        onremovecontentComplete(delwish, divid)
    }; // Specify function that will be executed after file has been found
    delwish.runAJAX();
}

function onremovecontentComplete(delwish, divid) {
    var resp = trimString(delwish.response);
    if (resp == 'SUCCESS') {
        var randnum = Math.floor((Math.random() * 10000000) + 1);
        var comp = '/pgs/mypgs_compare_pkg.compare_course_prc?p_div_id=' + divid;
        window.location.href = comp;
    }
}

function orderBy(elem, first_page, attr) {
    var order_by = $$D('locStudy_AMW24').value;
    if (order_by == 'Date') {
        go(first_page + '&p_attr=1');
    } else {
        go(first_page + '&p_order_by=college_name');
    }
}

function pageLoad(id, elem) {
    $$D(elem).getElementsByClassName("actt")[0].className = "";
    $$D(id).className = "actt";
}

function addpersonalnote(basket_id) {
    var p_text = trimString($$D(basket_id).value);
    if (p_text == 'Enter any comments here' || p_text == '') {
        alert('Enter any comments here');
    } else {
        blockNone("save", "none");
        blockNone("loader_x", "block");
        var url = '/pgs/mypgs_compare_pkg.personal_note_prc?p_basket_id=' + basket_id + '&p_personal_notes=' + p_text;
        var personal = new sack();
        personal.requestFile = url; // Specifying which file to get
        personal.onCompletion = function () {
            personal_resp(personal);
        }; // Specify function that will be executed after file has been found
        personal.runAJAX();
    }
}

function personal_resp(personal) {
    var response = trimString(personal.response);
    if (response == 'SUCCESS') {
        blockNone("save", "block");
        blockNone("loader_x", "none");
        blockNone("note", "block");
        $("#note").delay(2000).fadeOut();
    } else if (response = 'ERROR') {
        blockNone("save", "block");
        blockNone("loader_x", "none");
    }
}

function changetexttopassword(thisobj, defvalue, pswd_id) {
    if (thisobj.value == defvalue) {
        thisobj.value = '';
    }
    if (thisobj.type == "text") {
        if (thisobj.id == "p_password") {
            $$D(thisobj.id).style.display = "none";
            $$D('p_textpassword').style.display = "block";
            $$D('p_textpassword').focus();
        } else {
            $$D(thisobj.id).style.display = "none";
            $$D('p_textconfirm_password').style.display = "block";
            $$D('p_textconfirm_password').focus();
        }
    }
}

function radiochk() {
    var p_id = '';
    var p_comp_name = '';
    if ($$D("svcmp").checked) {
        $$D("pcomp_errdiv").style.display = "none";
        p_comp_name = trimString($$D("textcomp").value);
        if (p_comp_name == '') {
            $$D("textcomp").value = 'Enter comparison name';
        }
        $$D("textcomp").style.display = "block";
        $$D("hide1").style.display = "none";
    } else if ($$D("adcmp").checked) {
        $$D("pcompnew_errdiv").style.display = "none"
        $$D("textcomp").style.display = "none";
        $$D("hide1").style.display = "block";
    }
}

function submitLogin1(obj, x, p_chk, basktid) {
    var p_id = '';
    var p_comp_name = '';
    var personalnote = decodeURIComponent($$D("pn_" + basktid).value);
    if (personalnote == 'Enter any comments here') {
        personalnote = '';
    }
    if (p_chk == 'N') {
        if ($$D("svcmp").checked) {
            p_comp_name = trimString($$D("textcomp").value);
            if (p_comp_name == 'Enter comparison name') {
                p_comp_name = '';
            }
            if (p_comp_name == '') {
                var p_error_msg = "Please enter comparison name";
                $$D("pcompnew_errdiv").style.display = "block";
                $$D("pcompnew_errmsg").innerHTML = p_error_msg;
            }
        }
    } else if (p_chk == 'Y') {
        if ($$D("adcmp").checked) {
            $$D("textcomp").value = '';
            p_id = $$D("locStudy_AMW24").value;
            if (p_id == 0) {
                p_id = '';
            }
            if (p_id == '') {
                var p_error_msg = "Please select comparison name";
                $$D("pcomp_errdiv").style.display = "block";
                $$D("pcomp_errmsg").innerHTML = p_error_msg;
            }
        } else if ($$D("svcmp").checked) {
            $$D("locStudy_AMW24").value = '';
            p_comp_name = trimString($$D("textcomp").value);
            if (p_comp_name == 'Enter comparison name') {
                p_comp_name = '';
            }
            if (p_comp_name == '') {
                var p_error_msg = "Please enter comparison name";
                $$D("pcompnew_errdiv").style.display = "block";
                $$D("pcompnew_errmsg").innerHTML = p_error_msg;
            }
        }
    }
    if (x != '' && (p_id != '' || p_comp_name != '')) {
        var url = '/pgs/mypgs_compare_pkg.add_existbasket_prc?p_sel_basket_id=' + p_id + '&p_comparison_name=' + escape(p_comp_name) + '&p_personal_note=' + escape(personalnote);
        var compare = new sack();
        compare.requestFile = url; // Specifying which file to get
        compare.onCompletion = function () {
            response_complete(compare, p_id, personalnote);
        }; // Specify function that will be executed after file has been found
        compare.runAJAX();
    }
}

function response_complete(compare, p_id, personalnote) {
    var response = trimString(compare.response);
    if (response == 'success' || response == 'success_new' || response == 'success_1') {
        //deleteCookie('pgs_bsktid','/'); 
        var url = '/pgs/mypgs_compare_pkg.basket_success_lghtbx_prc?p_response=' + response + '&p_id=' + p_id;
        var resp = new sack();
        resp.requestFile = url; // Specifying which file to get
        resp.onCompletion = function () {
            ajaxoncomplete(resp);
        }; // Specify function that will be executed after file has been found
        resp.runAJAX();
        deleteCookie('pgs_bsktid', '/');
    } else if (response == 'factors_lightbox') {
        var url = '/pgs/mypgs_compare_pkg.merge_lightbox_prc?p_sel_basket_id=' + p_id + '&p_personal_note=' + personalnote;
        var resp = new sack();
        resp.requestFile = url;
        resp.onCompletion = function () {
            ajaxoncomplete(resp);
        };
        resp.runAJAX();
    } else {
        var url = '/pgs/mypgs_compare_pkg.error_lghtbx_prc';
        var err = new sack();
        err.requestFile = url; // Specifying which file to get
        err.onCompletion = function () {
            ajaxoncomplete(err);
        }; // Specify function that will be executed after file has been found
        err.runAJAX();
    }
}

function showdel(id) {
    $$D("dtip" + id).innerHTML = "Delete Comparison";
    $$D("clos" + id).style.display = "block";
}

function hidedel(id) {
    $$D("clos" + id).style.display = "none";
}

function del_save_comp(basket_id) {
    var url = '/pgs/mypgs_compare_pkg.delete_basket_prc?p_basket_id=' + basket_id;
    var compare = new sack();
    compare.requestFile = url;
    compare.onCompletion = function () {
        var screenWidth = jqueryWidth();
        if (screenWidth > 992) {
            document.location.reload(true);
        } else {
            if ($$D("redirect_url")) {
                redirect_url = encodeURIComponent(trimString($$D("redirect_url").value));
                window.location.href = decodeURIComponent(redirect_url);
            }
        }
    };
    compare.runAJAX();
}

function showeventdel(id) {
    $$D("dtip" + id).innerHTML = "Unsave Openday";
    $$D("clos" + id).style.display = "block";
}

function hideeventdel(id) {
    $$D("clos" + id).style.display = "none";
}

//devika
function delete_openday(x, p_date, event_id) {
    var url = '/pgs/pgs_open_days_pkg.delete_openday_prc?p_event_id=' + event_id;
    var openday = new sack();
    openday.requestFile = url; // Specifying which file to get
    openday.onCompletion = function () {
        opendayresp(openday, x, p_date);
    }; // Specify function that will be executed after file has been found
    openday.runAJAX();
}

function opendayresp(openday, x, p_date) {
    var response = trimString(openday.response);
    if (response == 'SUCCESS') {
        var pageno = trimString($$D("mypgs_openday_page").value);
        var pagecount = trimString($$D("mypgs_openday_count").value) * 1;
        //alert(pagecount);
        if (pagecount == 1 && pageno != 1) {
            pageno = pageno - 1;
        }
        var url = '/pgs/mypgs_pkg.mypgs_openday_pod_prc?x=' + x + '&p_date=' + p_date + '&p_page_no=' + pageno;
        var wish = new sack();
        wish.requestFile = url;
        wish.onCompletion = function () {
            monthopendayoncomplete(wish, '')
        };
        wish.runAJAX();
    }
}

function ajaxoncomplete(err) {
    $$D("lightbx").innerHTML = err.response;
    $$D("ajax-div").style.display = "none";
    $$D("lightbx").style.display = "block";
    $$D("newvenueform").style.display = "block";
    var elements = $("script[id^='iterate']");
    for (var i = 1; i <= elements.length; i++) {
        // alert($$D('iterate'+i).innerHTML);
        eval($$D('iterate' + i).innerHTML);
    }
}

function changePwdtoText1(thisobj, defvalue) {
    if (thisobj.value == '' || thisobj.value == defvalue) {
        if (thisobj.type == "password") {
            thisobj.type = 'text';
        }
        thisobj.value = defvalue;
    }
}

function changetexttopassword1(thisobj, defvalue) {
    if (thisobj.value == defvalue) {
        thisobj.value = '';
    }
    if (thisobj.type == "text") {
        thisobj.type = 'password';
    }
}

function changePwdtoText(thisobj, defvalue) {
    if (thisobj.value == '' || thisobj.value == defvalue) {
        if (thisobj.type == "password") {
            if (thisobj.id == 'p_textpassword') {
                $$D(thisobj.id).style.display = "none";
                $$D('p_password').style.display = "block";
            } else {
                $$D(thisobj.id).style.display = "none";
                $$D('p_confirm_password').style.display = "block";
            }
        }
        //thisobj.value = defvalue;
    }
}

function empstudystatus(m) {
    //alert(m);
    //var pempstatus = $$D('ddsl_273');  
    if (m == 3) {
        $$D("p_indus_status").style.display = "block";
        $$D("p_senior_status").style.display = "block";
    } else {
        $$D("p_indus_status").style.display = "none";
        $$D("p_senior_status").style.display = "none";
        $$D("ddsl_274").value = "";
        $$D("ddsl_275").value = "";
    }
}

function addpersonalnote_s(basket_id, cnt) {
    var p_text = trimString($$D("pn_" + basket_id).value);
    if (p_text == 'Enter any comments here' || p_text == '') {
        alert('Enter any comments here');
    } else {
        blockNone("save_" + cnt, "none");
        blockNone("loader_" + cnt, "block");
        var url = '/pgs/mypgs_compare_pkg.personal_note_prc?p_basket_id=' + basket_id + '&p_personal_notes=' + p_text;
        var personal = new sack();
        personal.requestFile = url; // Specifying which file to get
        personal.onCompletion = function () {
            personalresp(personal, cnt);
        }; // Specify function that will be executed after file has been found
        personal.runAJAX();
    }
}

function personalresp(personal, cnt) {
    var response = trimString(personal.response);
    if (response == 'SUCCESS') {
        blockNone("save_" + cnt, "block");
        blockNone("loader_" + cnt, "none");
        blockNone("note_" + cnt, "block");
        $("#note_" + cnt).delay(2000).fadeOut();
    } else if (response = 'ERROR') {
        blockNone("save_" + cnt, "block");
        blockNone("loader_" + cnt, "none");
    }
}

function increaseRows(obj) {
    var id = obj.id;
    //alert(id);
    if ($$D(id).value.length % 68 == 0) {
        $$D(id).rows = $$D(id).rows + 1;
    }
}

function textincrease(obj) {
    var id = obj.id;
    $$D(id).style.height = "";
    $$D(id).style.height = Math.min($$D(id).scrollHeight, 1000) + "px";
}


function submitApply(aForm) {
    //console.log('submitRegisteration');
    var errorfound = "FALSE";
    var pname = $$D("p_name");
    var pname_hidden = $$D("p_name_hidden");
    blockNone("pname_errdiv", "none");
    pname.className = "";
    var psurname = $$D("p_surname");
    var psurname_hidden = $$D("p_surname_hidden");
    blockNone("psurname_errdiv", "none");
    psurname.className = "";
    var pemail = $$D("p_email");
    var pemail_hidden = $$D("p_email_hidden");
    blockNone("pemail_errdiv", "none");
    pemail.className = "";
    if ($$D("p_user_id").value == '') {
        var pconfirmemail = $$D("p_confirm_email");
        var pconfirmemail_hidden = $$D("p_confirmemail_hidden");
        blockNone("pconfirmemail_errdiv", "none");
        pconfirmemail.className = "";
    }
    var pregister = $$D("p_policy_enquiry");
    var ppolicy = "";
    var pregister = "";
    var ppolicyChecked = "";
    var pregisterChecked = "";
    var puserid = $$D("p_user_id").value;
    var p_error_div = "";
    var bursaryflag = false;
    var pclass_name = " reg_inpt ";
    var radios = document.getElementsByName("p_bursary_name");
    for (i = 0; i < radios.length; i++) {
        if (radios[i].checked) {
            bursaryflag = true;
        }
    }
    if (!bursaryflag) {
        $$D("errorRadio").style.display = 'block';
        errorfound = "TRUE";
    } else {
        $$D("errorRadio").style.display = 'none';
    }
    var appflag = false;
    if (isEmpty(pname.value) || pname.value == 'First name' || pname.value == pname_hidden.value) {
        pname.className = setErrborder;
        errorfound = "TRUE";
        $$D("pname_errmsg").innerHTML = ErrorMessage.error_empty_firstname;
        blockNone("pname_errdiv", "block");
        if (p_error_div == "") {
            p_error_div = "p_name";
        }
    }
    if (isEmpty(psurname.value) || psurname.value == psurname_hidden.value) {
        psurname.className = setErrborder;
        errorfound = "TRUE";
        $$D("psurname_errmsg").innerHTML = ErrorMessage.error_empty_lastname;
        blockNone("psurname_errdiv", "block");
        if (p_error_div == "") {
            p_error_div = "p_surname";
        }
    }

    if (isEmpty(pemail.value) || pemail.value == pemail_hidden.value) {
        pemail.className = pclass_name + setErrborder;
        errorfound = "TRUE";
        $$D("pemail_errmsg").innerHTML = ErrorMessage.error_empty_email;
        blockNone("pemail_errdiv", "block");
        if (p_error_div == "") {
            p_error_div = "p_email";
        }
    }
    if (!isValidEmail(trimString(pemail.value))) {
        pemail.className = pclass_name + setErrborder;
        errorfound = "TRUE";
        $$D("pemail_errmsg").innerHTML = ErrorMessage.error_invalid_email;
        blockNone("pemail_errdiv", "block");
        if (p_error_div == "") {
            p_error_div = "p_email";
        }
    }
    if ($$D("p_user_id").value == '') {
        if (isEmpty(pconfirmemail.value) || pconfirmemail.value == pconfirmemail_hidden.value) {
            pconfirmemail.className = pclass_name + setErrborder;
            errorfound = "TRUE";
            $$D("pconfirmemail_errmsg").innerHTML = ErrorMessage.error_empty_email;
            blockNone("pconfirmemail_errdiv", "block");
            if (p_error_div == "") {
                p_error_div = "p_confirm_email";
            }
        } else {
            if (!isValidEmail(trimString(pconfirmemail.value))) {
                pconfirmemail.className = pclass_name + setErrborder;
                errorfound = "TRUE";
                $$D("pconfirmemail_errmsg").innerHTML = ErrorMessage.error_invalid_email;
                blockNone("pconfirmemail_errdiv", "block");
                if (p_error_div == "") {
                    p_error_div = "p_confirm_email";
                }
            } else {
                if (trimString(pemail.value) != trimString(pconfirmemail.value)) {
                    pconfirmemail.className = pclass_name + setErrborder;
                    errorfound = "TRUE";
                    $$D("pconfirmemail_errmsg").innerHTML = ErrorMessage.error_confirm_email;
                    blockNone("pconfirmemail_errdiv", "block");
                    if (p_error_div == "") {
                        p_error_div = "p_confirm_email";
                    }
                }
            }
        }
    }
    if ($$D("p_policy_enquiry")) {
        ppolicy = $$D("p_policy_enquiry");
        blockNone("ppolicy_errdiv", "none");
        ppolicy.className = "";
        ppolicyChecked = ppolicy.checked;
        if (ppolicy.checked == false) {
            ppolicy.className = setErrborder;
            errorfound = "TRUE";
            $$D("ppolicy_errmsg").innerHTML = ErrorMessage.error_policy;
            blockNone("ppolicy_errdiv", "block");
            if (p_error_div == "") {
                p_error_div = "p_policy_enquiry";
            }
        }
    }

    if ($$D("p_register")) {
        pregister = $$D("p_register");
        pregisterChecked = pregister.checked;
    }
    if (errorfound == "FALSE") {

        if ($$D("p_rem")) {
            prem = $$D("p_rem");
            premChecked = prem.checked;
        }
        // console.log("sucessfully validated");
        //  console.log(aForm.elements.length);
        // for(i=0; i < aForm.elements.length; i++)
        // {
        //  console.log(aForm.elements[i].name);
        //	console.log(aForm.elements[i].value);
        //  }
        //alert(aForm.elements[i].value);
        //alert(aForm.elements[i].name);
        aForm.submit();
    } else {
        if (p_error_div != "") {
            $$D(p_error_div).focus();
        }
    }

    //$$D("errorApplysubmit").style.display='block';
    return false;
}

function passwordcheck(err) {
    $("div[id$='_errdiv']").css("display", "none");
    blockNone("new_errdiv", "none");
    blockNone("confirm_errdiv", "none");
    blockNone("main_err", "none");
    blockNone("hash_errdiv", "none");
    var user_id = $$D("p_user_id_hidden").value;
    var p_new_err_msg = 'New password field cannot be left blank';
    var p_confirm_err_msg = 'Re-enter Password field cannot be left blank';
    var p_new_length_err = 'Your password should be 6 characters or more.';
    var p_confirm_length_err = 'Your confirm password should be 6 characters or more.';
    var p_new_password = trimString($$D("new_pass").value);
    var p_confirm_pass = trimString($$D("confirm_pass").value);
    var hashval = trimString($$D("hashval_1").value);
    var userval = trimString($$D("Realval").value);
    var errorfound = "FALSE";
    var msg = 'Y';
    //alert(p_new_password);
    if (p_new_password == 'New password*') {
        p_new_password = '';
    }
    if (p_confirm_pass == 'Confirm password*') {
        p_confirm_pass = '';
    }
    if (p_new_password == '') {
        msg = 'N';
        errorfound = "TRUE";
        $$D("new_errdiv").style.display = "block";
        $$D("new_errmsg").innerHTML = p_new_err_msg;
        $(".realperson-regen").trigger("click");
    }
    if (!isEmpty(p_new_password) && p_new_password.length < 6) {
        msg = 'N';
        errorfound = "TRUE";
        $$D("new_errdiv").style.display = "block";
        $$D("new_errmsg").innerHTML = p_new_length_err;
        $(".realperson-regen").trigger("click");
    }
    if (p_confirm_pass == '') {
        msg = 'N';
        errorfound = "TRUE";
        $$D("confirm_errdiv").style.display = "block";
        $$D("confirm_errmsg").innerHTML = p_confirm_err_msg;
        $("#Realval_1").trigger("click");
    }
    if (!isEmpty(p_confirm_pass) && p_confirm_pass.length < 6) {
        msg = 'N';
        errorfound = "TRUE";
        $$D("confirm_errdiv").style.display = "block";
        $$D("confirm_errmsg").innerHTML = p_confirm_length_err;
        $("#Realval_1").trigger("click");
    }
    if (p_new_password != p_confirm_pass) {
        errorfound = "TRUE";
        p_new_err_msg = "The New password fields do not match, please try again";
        $$D("new_errdiv").style.display = "block";
        $$D("new_errmsg").innerHTML = p_new_err_msg;
        $("#Realval_1").trigger("click");
    }
    if (userval == "" || userval == null || userval == "Please type the characters you see") {
        errorfound = "TRUE";
        $("#hash_errmsg").html("The characters field cannot be left blank");
        $("#hash_errdiv").css("display", "block");
        //$("#Realval_1").trigger("click");
    }
	else if (userval != hashval) {
        errorfound = "TRUE";
        $("#hash_errmsg").html("Sorry, your response is incorrect. Please try again.");
        $("#hash_errdiv").css("display", "block");
        $("#Realval_1").trigger("click");
    }
    //alert(encodeURIComponent(user_id));
    //alert(user_id);
    if (errorfound == "TRUE") {
        return false;
    } else {
        //var encryptedNewPwd = encryptValues(p_new_password);
        //var encryptedOldPwd = encryptValues(p_current_password);
        var url = '/pgs/pgs_user.change_password_prc?p_token=' + encodeURIComponent(user_id) + '&p_confirm_password=' + encodeURIComponent(p_confirm_pass) + '&p_new_password=' + encodeURIComponent(p_new_password);
        var password = new sack();
        password.requestFile = url; // Specifying which file to get
        password.onCompletion = function () {
            passwordoncomplete(password, user_id);
        }; // Specify function that will be executed after file has been found
        password.runAJAX();
    }
    return false;
}

function passwordoncomplete(password, user_id) {
    var response = trimString(password.response);
    $$D("reset_pwd").innerHTML = response;
    /*$$D("lightbx").innerHTML=response; 
    $$D("ajax-div").style.display="none";  
    $$D("lightbx").style.display="block";
    $$D("newvenueform").style.display="block";  */
}

function encryptValues(value) {
    var xorKey = 129;
    var encryptedValue = "";
    for (var i = 0; i < value.length; ++i) {
        encryptedValue += String.fromCharCode(xorKey ^ value.charCodeAt(i));
    }
    return encryptedValue;
}

function dispTextbox(thisobj) {
    if (thisobj.value == 'Written Application') {
        $$D("abc").style.display = 'block'
        $$D("xyz").style.display = 'none'
        $$D("xyz1").style.display = 'none'
        $$D("xyz").value = $$D("phidapp1").value
        $$D("xyz1").value = $$D("phidapp2").value
        //$$D("xyz").innerHTML ='Enter youtube url'
        //$$D("xyz1").innerHTML ='Enter any comments here'
        $$D("p_extra_text").style.display = 'block'
    } else if (thisobj.value == 'Video Application') {
        $$D("xyz").style.display = 'block'
        $$D("abc").style.display = 'none'
        $$D("xyz1").style.display = 'none'
        $$D("abc").value = $$D("phidapp").value
        $$D("xyz1").value = $$D("phidapp2").value
        $$D("p_extra_text").style.display = 'block'
    } else if (thisobj.value == 'Other Applications') {
        $$D("xyz1").style.display = 'block'
        $$D("p_extra_text").style.display = 'none'
        $$D("xyz").style.display = 'none'
        $$D("abc").style.display = 'none'
        $$D("abc").value = $$D("phidapp").value
        $$D("xyz").value = $$D("phidapp1").value
    }
}

function hideandshowAddFinder(obj) {
    var countryOfRes = obj.value;
    if (countryOfRes != null && (countryOfRes == '55' || countryOfRes == '139' || countryOfRes == '256' || countryOfRes == '257')) {
        document.getElementById('p_findadd').style.display = 'block';
        //document.getElementById('postaddid').style.display= 'block';
    } else {
        document.getElementById('p_findadd').style.display = 'none';
        document.getElementById('postaddid').style.display = 'none';
    }
}

function showmoduledescription(module_group_id, module_id, id) {
    var module_desc;
    module_desc = trimString($$D(id).innerHTML);
    //alert(module_desc);
    if (module_desc == null || module_desc == '') {
        var url = '/pgs/pgs_course_pkg.get_course_module_desc_prc?p_module_group_id=' + module_group_id + '&p_module_id=' + module_id;
        var wish = new sack();
        wish.requestFile = url;
        wish.onCompletion = function () {
            moduledesconcomplete(wish, id)
        };
        wish.runAJAX();
    }
}

function moduledesconcomplete(wish, id) {
    var response = trimString(wish.response);
    $$D(id).innerHTML = response;
}
/* open day start */
function next_mon(x, mypgs_flg) {
    var month = trimString($$D("month").value) * 1;
    var year = trimString($$D("year").value) * 1;
    month = month + 1;
    if (month > 12) {
        month = 1;
        year = year + 1;
    }
    var date = '01/' + month + '/' + year;
    var url;
    if (mypgs_flg == 'Y') {
        url = '/pgs/mypgs_pkg.mypgs_openday_pod_prc?x=' + x + '&p_date=' + date;
    } else {
        var college = trimString($$D("ps_college_id_hidden").value);
        var subject = trimString($$D("ps_subject_id_hidden").value);
        var location = trimString($$D("location1_hidden").value);
        var url = trimString($$D("url").value);
        if (location == 'Location') {
            location = "";
        }
        url = '/pgs/pgs_open_days_pkg.open_days_prc?x=' + x + '&p_date=' + date + '&college=' + college + '&location=' + location + '&subject=' + subject + '&p_url=' + url + '&p_ajax_flag=Y';
    }
    var wish = new sack();
    wish.requestFile = url;
    wish.onCompletion = function () {
        if (mypgs_flg == 'Y') {
            monthopendayoncomplete(wish, '');
        } else {
            monthconcomplete(wish, '');
        }
    };
    wish.runAJAX();
}

function prev_mon(x, mypgs_flg) {
    var month = trimString($$D("month").value) * 1;
    var year = trimString($$D("year").value) * 1;
    month = month - 1;
    if (month == 0) {
        month = 12;
        year = year - 1;
    }
    var date = '01/' + month + '/' + year;
    var url;
    if (mypgs_flg == 'Y') {
        url = '/pgs/mypgs_pkg.mypgs_openday_pod_prc?x=' + x + '&p_date=' + date;
    } else {
        var college = trimString($$D("ps_college_id_hidden").value);
        var subject = trimString($$D("ps_subject_id_hidden").value);
        var location = trimString($$D("location1_hidden").value);
        var url = trimString($$D("url").value);
        if (location == 'Location') {
            location = "";
        }
        url = '/pgs/pgs_open_days_pkg.open_days_prc?x=' + x + '&p_date=' + date + '&location=' + location + '&college=' + college + '&subject=' + subject + '&p_url=' + url + '&p_ajax_flag=Y';
    }
    var wish = new sack();
    wish.requestFile = url;
    wish.onCompletion = function () {
        if (mypgs_flg == 'Y') {
            monthopendayoncomplete(wish, '');
        } else {
            monthconcomplete(wish, '');
        }
    };
    wish.runAJAX();
}

function monthconcomplete(wish, obj) {
    var response = trimString(wish.response);
    $$D('open_days').innerHTML = response;
    eval($$D("pagescript").innerHTML);
    if (obj != '') {
        $$D(obj.id).className = 'act';
    }
    if ($$D("dayfltrScript")) {
        eval($$D("dayfltrScript").innerHTML);
    }
}

function goto_page(pageno, date, x, filter_flg) {
    var college = trimString($$D("ps_college_id_hidden").value);
    var subject = trimString($$D("ps_subject_id_hidden").value);
    var location = trimString($$D("location1_hidden").value);
    var url = trimString($$D("url").value);
    if (location == 'Location') {
        location = "";
    }
    var url = '/pgs/pgs_open_days_pkg.open_days_prc?x=' + x + '&p_date=' + date + '&p_page_no=' + pageno + '&college=' + college + '&location=' + location + '&subject=' + subject + '&p_day_filter_flag=' + filter_flg + '&p_url=' + url + '&p_ajax_flag=Y';
    var wish = new sack();
    wish.requestFile = url;
    wish.onCompletion = function () {
        monthconcomplete(wish, '');
        $("html, body").animate({
            scrollTop: $('.op_lft').position().top
        });
    };
    wish.runAJAX();
}

function addto_calender(eventid, userid, college_id, date, p_url) {
    if (userid == '' || userid == null) {
        var screenWidth = jqueryWidth();
        if (screenWidth > 992) {
            var l_url = encodeURIComponent(p_url);
        } else {
            var l_url = p_url;
        }
        newPgsLbx('signin', 'p_url=' + l_url);
    } else {
        var url = '/pgs/pgs_open_days_pkg.addtoCalender_prc?p_event_id=' + eventid + '&p_user_id=' + userid + '&p_college_id=' + college_id + '&p_date=' + date;
        var wish = new sack();
        wish.requestFile = url;
        wish.onCompletion = function () {
            calendercomplete(wish, eventid)
        };
        wish.runAJAX();
    }
}

function goto_date(obj, date, x, mypgs_flg) {
    var url;
    if (mypgs_flg == 'Y') {
        url = '/pgs/mypgs_pkg.mypgs_openday_pod_prc?x=' + x + '&p_date=' + date + '&p_day_filter_flag=Y';
    } else {
        var college = trimString($$D("ps_college_id_hidden").value);
        var subject = trimString($$D("ps_subject_id_hidden").value);
        var location = trimString($$D("location1_hidden").value);
        var url = trimString($$D("url").value);
        if (location == 'Location') {
            location = "";
        }
        url = '/pgs/pgs_open_days_pkg.open_days_prc?x=' + x + '&p_date=' + date + '&p_day_filter_flag=Y&college=' + college + '&location=' + location + '&subject=' + subject + '&p_url=' + url + '&p_ajax_flag=Y';
    }
    var wish = new sack();
    wish.requestFile = url;
    wish.onCompletion = function () {
        if (mypgs_flg == 'Y') {
            monthopendayoncomplete(wish, obj);
        } else {
            monthconcomplete(wish, obj);
        }
    };
    wish.runAJAX();
}

function collegeOpendayComplete(obj, paramToExternalFile, e) {
    if (($$D("ps_college_id_hidden").value != "" || $$D("ps_college_id_hidden").value != null) && e.keyCode != 13) {
        $$D("ps_college_id_hidden").value = "";
    }
    var urlPrc = 'pgs_ajax_pkg.ajax_search_college';
    var param1 = 'p_ajax_type=O'; // Ajax type 
    ajax_showOptions(obj, paramToExternalFile, e, urlPrc, param1);
}

function subjectOpendayComplete(obj, paramToExternalFile, e) {
    if (($$D("ps_subject_id_hidden").value != "" || $$D("ps_subject_id_hidden").value != null) && e.keyCode != 13) {
        $$D("ps_subject_id_hidden").value = "";
    }
    var pKeyword = $$D("ps_college_id_hidden").value;
    var urlPrc = 'pgs_ajax_pkg.ajax_search_subject';
    //var param1 = 'p_ajax_type=S';// Ajax type 
    var param1 = 'p_ajax_type=S&p_coll_id=' + pKeyword; // Ajax type 
    ajax_showOptions(obj, paramToExternalFile, e, urlPrc, param1);
}

function locationOpendayComplete(obj, paramToExternalFile, e) {
    if (($$D("location1_hidden").value != "" || $$D("location1_hidden").value != null) && e.keyCode != 13) {
        $$D("location1_hidden").value = "";
    }
    var pKeyword = $$D("ps_college_id_hidden").value;
    var urlPrc = 'pgs_ajax_pkg.ajax_search_location';
    var param1 = 'p_ajax_type=L&p_coll_id=' + pKeyword; // Ajax type 
    $$D("search_location_hidden").value = obj.value;
    ajax_showOptions(obj, paramToExternalFile, e, urlPrc, param1);
}

function calendercomplete(wish, eventid) {
    var response = trimString(wish.response);
    var getvalue = $$D('inner_' + eventid).getAttribute("onclick");
    if (response == 'SUCCESS') {
        $$D('inevent_' + eventid).style.display = "none";
        $$D('inaddevent_' + eventid).style.display = "block";
        if (getvalue != null) {
            $$D('inner_' + eventid).setAttribute("onclick", "");
            $$D('inner_' + eventid).className = "op_dt";
        }
        showPGSLightBox('calendar', '665', '520', 'p_event_id=' + eventid + '');
    }
}

function validateopenday(obj) {
    //var pcollegename = trimString($$D("ps_college_id").value); 
    var subject = trimString($$D("ps_subject_id").value);
    var college = trimString($$D("ps_college_id").value);
    var location = trimString($$D("location1").value);
    var pcollegename = trimString($$D("ps_college_id_hidden").value);
    var psubjectname = trimString($$D("ps_subject_id_hidden").value);
    var plocationname = trimString($$D("location1_hidden").value);
    var pgsSCHurl = "";
	//alert ('soundariya');
	//alert (pcollegename);
    if (pcollegename == 'University' || college == 'University' || pcollegename == '0') {
        pcollegename = "";
        college = "";
    }
    if (subject == 'Subject') {
        psubjectname = "";
        subject = "";
    }
    if (location == 'Location') {
        plocationname = "";
        location = "";
    }
    var errorfound = 'N';
    var unierror = 'N';
    var suberror = 'N';
    var locerror = 'N';
    if (pcollegename == ""  ) {
		if (college == "" || college == null ) {
            errorfound = 'Y';
            unierror = 'Y';
            $$D("uni_error").innerHTML = "Please enter any university name";
            $$D("puni_errdiv1").style.display = "block";
           }
		else if (college != "" || college != null) {
            keyword = college;
		   if (!searchTextValidate(keyword)) {
                  errorfound = 'Y';
				  unierror = 'Y';
				  $$D("uni_error").innerHTML = "Please enter valid university";
				  $$D("puni_errdiv1").style.display = "block";
	         }
           } 
	    else if (pcollegename == "" ) {
            errorfound = 'Y';
            unierror = 'Y';
            $$D("uni_error").innerHTML = "Please choose a university from the list";
            $$D("puni_errdiv1").style.display = "block";
           }
    }
    if (unierror == 'N') {
        $$D("uni_error").innerHTML = "";
        $$D("puni_errdiv1").style.display = "none";
    }
    if (psubjectname == "") {
	  if (subject == "" || subject == null ) {
            errorfound = 'Y';
            suberror = 'Y';
            $$D("sub_error").innerHTML = "Please enter any subject name";
            $$D("psub_errdiv1").style.display = "block";
        }
	
	 else if (subject != "" || subject != null) {
            keyword = subject;
		   if (!searchTextValidate(keyword)) {
                  errorfound = 'Y';
				  suberror = 'Y';
				  $$D("sub_error").innerHTML = "Please enter valid subject";
				  $$D("psub_errdiv1").style.display = "block";
	         }
           } 
     else if (subject != "") {
            errorfound = 'Y';
            suberror = 'Y';
            $$D("sub_error").innerHTML = "Please choose a subject from the list";
            $$D("psub_errdiv1").style.display = "block";
        }
    }
    if (suberror == 'N') {
        $$D("sub_error").innerHTML = "";
        $$D("psub_errdiv1").style.display = "none";
    }
    if (plocationname == "") {
        if (location == "" || location == null ) {
            errorfound = 'Y';
            locerror = 'Y';
            $$D("loc_error").innerHTML = "Please enter any location name";
            $$D("ploc_errdiv1").style.display = "block";
        }
	 else if (location != "" || location != null) {
            keyword = location;
		   if (!searchTextValidate(keyword)) {
                  errorfound = 'Y';
				  locerror = 'Y';
				  $$D("loc_error").innerHTML = "Please enter valid location";
				  $$D("ploc_errdiv1").style.display = "block";
	         }
           } 
		else if (location != "") {
            errorfound = 'Y';
            locerror = 'Y';
            $$D("loc_error").innerHTML = "Please choose a location from the list";
            $$D("ploc_errdiv1").style.display = "block";
        }
    }
    if (locerror == 'N') {
        $$D("loc_error").innerHTML = "";
        $$D("ploc_errdiv1").style.display = "none";
    }

    if (errorfound == 'Y') {
        return false;
    }

    if (pcollegename != "" && psubjectname != "" && (plocationname != "uk" && plocationname != "")) {
        pgsSCHurl = "/opendays?college=" + pcollegename + "&subject=" + psubjectname + "&location=" + plocationname;
    } else if (pcollegename != "" && psubjectname != "") {
        pgsSCHurl = "/opendays?college=" + pcollegename + "&subject=" + psubjectname;
    } else if (psubjectname != "" && (plocationname != "uk" && plocationname != "")) {
        pgsSCHurl = "/opendays?subject=" + psubjectname + "&location=" + plocationname;
    } else if (pcollegename != "" && (plocationname != "uk" && plocationname != "")) {
        pgsSCHurl = "/opendays?college=" + pcollegename + "&location=" + plocationname;
    } else if (pcollegename != "") {
        pgsSCHurl = "/opendays?college=" + pcollegename;
    } else if (psubjectname != "") {
        pgsSCHurl = "/opendays?subject=" + psubjectname;
    } else if ((plocationname != "uk" && plocationname != "")) {
        pgsSCHurl = "/opendays?location=" + plocationname;
    }

    if ((pcollegename == 0 || pcollegename == "") && (psubjectname == 0 || psubjectname == "") && (plocationname == 0 || plocationname == 'uk')) {
        $$D("uni_error").innerHTML = "Please choose a university from the list";
        $$D("sub_error").innerHTML = "Please choose a subject from the list";
        $$D("loc_error").innerHTML = "Please choose a location from the list";
	    $$D("psub_errdiv1").style.display = "block";
        $$D("puni_errdiv1").style.display = "block";
        $$D("ploc_errdiv1").style.display = "block";
        return false;
    } else {
        //return;
        window.location.href = pgsSCHurl;
    }
    return false;
}

function gotouniv_page(pageno, x) {
    var college = trimString($$D("college_name").value);
    var subject = trimString($$D("subject").value);
    var url = '/pgs/pgs_open_days_pkg.open_days_univ?x=' + x + '&p_page_no=' + pageno + '&college=' + college + '&subject=' + subject;
    var wish = new sack();
    wish.requestFile = url;
    wish.onCompletion = function () {
        univpageoncomplete(wish);
        $("html, body").animate({
            scrollTop: $('.op_lft').position().top
        });
    };
    wish.runAJAX();
}

function goto_mypgs_page(pageno, date, x, filter_flg, past_open_flag) {
    var url = '/pgs/mypgs_pkg.mypgs_openday_pod_prc?x=' + x + '&p_date=' + date + '&p_page_no=' + pageno + '&p_day_filter_flag=' + filter_flg + '&p_view_past_flag=' + past_open_flag;
    var wish = new sack();
    wish.requestFile = url;
    wish.onCompletion = function () {
        monthopendayoncomplete(wish, '')
    };
    wish.runAJAX();
}

function monthopendayoncomplete(wish, obj) {
    var response = trimString(wish.response);
    $$D('rt_pod').innerHTML = response;
    if (obj != '') {
        $$D(obj.id).className = 'act';
    }
    if ($$D("dayfltrScript")) {
        eval($$D("dayfltrScript").innerHTML);
    }
}

function univpageoncomplete(wish) {
    var response = trimString(wish.response);
    $$D('sky3').innerHTML = response;
    eval($$D("pagescript").innerHTML);
    if ($$D("dayfltrScript")) {
        eval($$D("dayfltrScript").innerHTML);
    }
}

function openday_press(e) {
    if (e.keyCode == 13) {
        return validateopenday("N");
    }
}

function goto_spam_user() {
    var errorfound = "FALSE";
    var firstname = trimString($$D("p_name").value);
    var lastname = trimString($$D("p_surname").value);
    var email = trimString($$D("pemail").value);
	var terms_privacy_flag = $$D("nesck").value;
	var perror_id = "";
	
    if (firstname == 'First name*' || firstname == "") {
        $$D('pname_errdiv').style.display = "block";
        $("#pname_errmsg").html("Please enter your first name");
        errorfound = "TRUE";
    } else {
        $$D('pname_errdiv').style.display = "none";
    }
    if (lastname == 'Last name*' || lastname == "") {
        $$D('pemail_errdiv').style.display = "block";
        $("#pemail_errmsg").html("Please enter your last name");
        errorfound = "TRUE";
    } else {
        $$D('pemail_errdiv').style.display = "none";
    }
    if (email == 'Enter email address*' || email == "" || !isValidEmail(email)) {
        $$D('erremail').style.display = "block";
        if (!isValidEmail(email)) {
            $("#psurname_errmsg").html("Please enter a valid email");
            errorfound = "TRUE";
        }
    } else {
        $$D('erremail').style.display = "none";
    }
	if ($$D("nesck")) {
        ppolicy = $$D("nesck");
        blockNone("nesck_errmsg", "none");
        ppolicyChecked = ppolicy.checked;
        if (ppolicy.checked == false) {
            blockNone("nesck_errmsg", "block");
            errorfound = "TRUE";
            if (perror_id == "") {
                perror_id = "nesck";
            }
        }
    }
	
    if (errorfound == "FALSE") {
        $$D('pname_errdiv').style.display = "none";
        $$D('pemail_errdiv').style.display = "none";
        $$D('erremail').style.display = "none";
        var url = CommonObjects.pgs_context_path+"/get_spamreg_prc?";
        var ajax = new sack();
		ajax.setVar("p_first_name", trimString(firstname));
		ajax.setVar("p_last_name", trimString(lastname));
		ajax.setVar("p_email_address", trimString(email) );
        ajax.requestFile = url;
        ajax.onCompletion = function () {
            spamusercomplete(ajax)
        };
        ajax.runAJAX();
    }
}

function goto_spam_user_right() {
    var errorfound = "FALSE";
    var firstname = trimString($$D("r_first").value);
    var lastname = trimString($$D("r_last").value);
    var email = trimString($$D("r_email").value);
    if (firstname == 'First name*' || firstname == "") {
        $$D('errfirst').style.display = "block";
        $("#rfirst_errmsg").html("Please enter your first name");
        errorfound = "TRUE";
    } else {
        $$D('errfirst').style.display = "none";
    }
    if (lastname == 'Last name*' || lastname == "") {
        $$D('errlast').style.display = "block";
        $("#rlast_errmsg").html("Please enter your last name");
        errorfound = "TRUE";
    } else {
        $$D('errlast').style.display = "none";
    }
    if (email == 'Enter email address*' || email == "") {
        $$D('err_email').style.display = "block";
        $("#remail_errmsg").html("Please enter your email");
        errorfound = "TRUE";
    } else if (!isValidEmail(email)) {
        $$D('err_email').style.display = "block"
        $("#remail_errmsg").html("Please enter a valid email");
        errorfound = "TRUE";
    } else {
        $$D('err_email').style.display = "none";
    }
    if (errorfound == "FALSE") {
        $$D('errfirst').style.display = "none";
        $$D('errlast').style.display = "none";
        $$D('err_email').style.display = "none";
        var url = '/pgs/get_spamreg_prc?p_first_name=' + firstname + '&p_last_name=' + lastname + '&p_email_address=' + email;
        var wish = new sack();
        wish.requestFile = url;
        wish.onCompletion = function () {
            spamusercomplete_right(wish)
        };
        wish.runAJAX();

    }
}

function spamusercomplete(wish) {
    var response = trimString(wish.response);
    if (response == '<p class="suc"> Thanks, you have subscribed successfully!</p>') {
        GAInteractionEventTracking('register', 'register', 'spambox', '', '');
    }
    $$D('spam').innerHTML = response;
}

function spamusercomplete_right(wish) {
    var response = trimString(wish.response);
    if (response == '<p class="suc"> Thanks, you have subscribed successfully!</p>') {
        GAInteractionEventTracking('register', 'register', 'spambox', '', '');
    }
    $$D('r_spam').innerHTML = response;
}

function profile_tab_option(elem, profile_id) {
    var url = "";
    var last_prof = trimString($$D("last_prof_id").value);
    var prof = $$D(elem).getElementsByClassName("scimg active")[0].value.toString();
	var l_width = screen.width;
    //alert(prof);
    $$D(elem).getElementsByClassName("scimg active")[0].className = "scimg sp";
    $$D('content_' + prof).style.display = "none";
    $$D('prof_' + prof).style.display = "none";
    if (prof == last_prof) {}
    if (profile_id != "last") {
        if (prof == last_prof) {
            $$D("inner_prof_" + prof).setAttribute("onclick", "profile_tab_option('horiz','last')");
        } else {
            $$D("inner_prof_" + prof).setAttribute("onclick", "profile_tab_option('horiz'," + prof + ")");
        }
        $$D("inner_prof_" + profile_id).setAttribute("onclick", "");
        $$D('content_' + profile_id).style.display = "block";
        $$D('prof_' + profile_id).style.display = "block";
        $$D(profile_id).className = "scimg active";
        if ($$D("img_" + profile_id)) {
            $$D("img_" + profile_id).className = "lazy";
        }
        url = '/pgs/pgs_profile_pkg.add_log_prc?p_profile_id=' + profile_id+"&p_screen_width="+l_width;
    } else {
        $$D("inner_prof_" + prof).setAttribute("onclick", "profile_tab_option('horiz'," + prof + ")");
        $$D("inner_prof_" + last_prof).setAttribute("onclick", "");
        $$D('content_' + last_prof).style.display = "block";
        $$D('prof_' + last_prof).style.display = "block";
        if ($$D("img_" + last_prof)) {
            $$D("img_" + last_prof).className = "lazy";
        }
        $$D("last").className = "scimg active";
        url = '/pgs/pgs_profile_pkg.add_log_prc?p_profile_id=' + last_prof+"&p_screen_width="+l_width;
    }
    $(function () {
        $("img.lazy").lazyload({
            event: "sporty"
        });
    });
    $(window).ready(function () {
        var timeout = setTimeout(function () {
            $("img.lazy").trigger("sporty")
        }, 300);
    });
    var wish = new sack();
    wish.requestFile = url;
    wish.onCompletion = function () {};
    wish.runAJAX();
}

/*function request_form_submit()
{
 var errorfound = "FALSE";
 var pname = $$D("p_name1"); 
 var psurname = $$D("p_surname1"); 
 var pemail = $$D("p_email1"); 
 if(isEmpty(pname.value)){ 
 errorfound = "TRUE";}
 if(isEmpty(psurname.value)){  
 errorfound = "TRUE";}
 if(isEmpty(pemail.value)){
 errorfound = "TRUE";}else{	
 if(!isValidEmail(trimString(pemail.value))){errorfound = "TRUE";}}

 if($$D("p_policy_enquiry1")){ 
 ppolicy = $$D("p_policy_enquiry1");blockNone("ppolicy_errdiv1","none");
 ppolicyChecked = ppolicy.checked;
    var dobDate  = $$D("p_date_cd");blockNone("pdob_errdiv","none");		//PGS_20150811
   var dMonth   = $$D("p_month_cd");   
   var dobMonth = $$D("p_month_cd").value;
   var dobYear  = $$D("p_year_cd");
   var pc;blockNone("penqpc_errdiv_cd","none");
   var countryId=$$D("p_enqcountry_cd").value;blockNone("pcountry_errdivcd","none");
   var monthStr = dMonth.options[dMonth.selectedIndex].innerHTML;
   $$D("reg_dd_cd").className="reg_dd date";			
   $$D("reg_mm_cd").className="reg_dd month";														
   $$D("reg_yy_cd").className="reg_dd year";	
	if(dobDate.value == "" || dobMonth == "" || dobYear.value == ""){		
		errorfound = "TRUE";$$D("pdob_errmsg_cd").innerHTML="Please select your DOB";blockNone("pdob_errdiv_cd","block");	
	}
	else{
		dateValid = isValidDOBDate(dobDate.value,dobMonth,dobYear.value,monthStr);		
		if(dateValid != 'valid')
		{
			errorfound = "TRUE";$$D("pdob_errmsg_cd").innerHTML=dateValid;blockNone("pdob_errdiv_cd","block");		
		}
		else{ blockNone("pdob_errdiv_cd","none");}
		
	}   
	if((trimString(countryId) == "") || (trimString(countryId) == null)){		
		errorfound = "TRUE";
		blockNone("pcountry_errdivcd","block");		
	}   
	if($$D("p_enqpc_cd").style.display == "block"){	    
		if ($$D("p_enqpc_cd").value == "Postcode*"){
			//alert($$D("p_enqpc").value);
			errorfound = "TRUE";
			blockNone("penqpc_errdiv_cd","block");
		}	
		else{
			pc = $$D("p_enqpc_cd").value;
			cpc = isValidUKpostcode(pc);
			//alert(cpc);
			if(cpc){
				blockNone("penqpc_errdiv_cd","none");				
			}else {
				errorfound = "TRUE";
				blockNone("penqpc_errdiv_cd","block");
			}
		}
	}	
 if (ppolicy.checked==false){errorfound = "TRUE";
 $$D("ppolicy_errmsg1").innerHTML=ErrorMessage.error_policy;blockNone("ppolicy_errdiv1","block");}
 }
 if($$D("p_register1")){
 pregister = $$D("p_register1");
 pregisterChecked=pregister.checked;
 }
 if(errorfound == "FALSE"){	
 //hideSubmitButton('req');	
 var strSend = "p_name="+$$D("p_name1").value+"&p_surname="+$$D("p_surname1").value				   
                 +"&p_email="+$$D("p_email1").value
				 +"&p_date="+$$D("p_date_cd").value
				 +"&p_month="+$$D("p_month_cd").value
				 +"&p_year="+$$D("p_year_cd").value
				 +"&p_country_id="+$$D("p_enqcountry_cd").value					 
                 +"&x="+$$D("x1").value 
                 +"&a="+$$D("a").value 
                 +"&z="+$$D("z1").value 
                 +"&w="+$$D("w1").value 
                 +"&p_user_id="+$$D("p_user_id1").value
                 +"&p_order_item_id="+$$D("p_order_item_id1").value
				 +"&p_from_page=CD";       

strSend = strSend +"&p_register=" + pregisterChecked + "&p_policy="+ppolicyChecked+ "&p_msg="+escape($$D("p_msg1").value)+"&p_crsstarttyear="+crsStartyear;
if ($$D("p_enqpc_cd").style.display == "block"){
	strSend = strSend+"&p_postcode="+$$D("p_enqpc_cd").value;
}	
var url="/pgs/pgs_interactive.do_enquire_new?"+strSend;
var ajax=new sack();
ajax.requestFile = url;	// Specifying which file to get
ajax.onCompletion = function(){reqinfoformcomplete(ajax,strSend)};	// Specify function that will be executed after file has been found
ajax.runAJAX();
}
return false;
}

function reqinfoformcomplete(ajax,strSend)
{
var response = trimString(ajax.response);
var randnum = Math.floor((Math.random()*10000000)+1);
if(response==0)
{
 var GAemail_flag  = trimString($$D("GAemail_flag_hidden1").value);
 var ga_collegeName = $$D("ga_college_name1").value;
 var ga_cpeValue = $$D("ga_cpe_value1").value;
if (GAemail_flag == 'N')
{
GAInteractionEventTracking('email','interaction','Email-embed',ga_collegeName,ga_cpeValue);/*GA Logging
var college_id1	 = $$D("z1").value;
var course_id1   = $$D("w1").value ;
GAInsightEventTracking(college_id1,course_id1,'N') ;
}
$$D("req_info").style.display = "none";
$$D("req_info1").style.display = "block";
$$D("error_msg1").innerHTML ="Your request has been sent";
$$D("login").innerHTML ="<a onclick=\"userLogout('pgs_x')\">LOGOUT /</a><a href='/pgs/pgs_user_profile_pkg.get_mydetails_prc?p_random_val="+randnum+"'>&nbsp;MyPGS</a><a name='topnav'></a>";
}else
{
showPGSLightBox('email-submit','650','350', strSend); 
}
}*/
function getfactors(basket_id) {
    var listItem = $("#getlist li");
    var id;
    var val;
    var factor_id;
    var mutliple_id;
    var multiple_factors;
    for (var i = 0; i < listItem.length; i++) {
        id = $(listItem[i]).attr("id");
        val = $(listItem[i]).find("span").attr("value");
        factor_id = id.substr(9);
        if (i == 0) {
            mutliple_id = factor_id;
            multiple_factors = val;
        } else {
            mutliple_id = mutliple_id + ',' + factor_id;
            multiple_factors = multiple_factors + ' : ' + val;
        }
    }
    var url = "/pgs/mypgs_compare_pkg.save_factors_prc?factors=" + mutliple_id + '&p_basket_id=' + basket_id;
    var ajax = new sack();
    ajax.requestFile = url;
    ajax.onCompletion = function () {
        factorsonComplete(ajax, multiple_factors)
    };
    ajax.runAJAX();
}

function factorsonComplete(ajax, multiple_factors) {
    var response = trimString(ajax.response);
    if (response == 'Success') {
        var randnum = Math.floor((Math.random() * 10000000) + 1);
        //alert(multiple_factors);
        GAInteractionEventTracking('view comparison', 'view comparison', 'customizedfactors', multiple_factors); /*GA Logging*/
        window.location.href = '/pgs/mypgs_compare_pkg.compare_course_prc';
    } else {
        showPGSLightBox('bskt_empty_err', '665', '520', 'p_page=custom');
    }
}

function getPreview() {
    var listItem = $("#getlist li");
    var id;
    var factor_id;
    var mutliple_id;
    for (var i = 0; i < listItem.length; i++) {
        id = $(listItem[i]).attr("id");
        factor_id = id.substr(9);
        if (i == 0) {
            mutliple_id = factor_id;
        } else {
            mutliple_id = mutliple_id + ',' + factor_id;
        }
    }
    var url = "/pgs/mypgs_compare_pkg.preview_comparisons_prc?factors=" + mutliple_id;
    var ajax = new sack();
    ajax.requestFile = url;
    ajax.onCompletion = function () {
        previewonComplete(ajax)
    };
    ajax.runAJAX();
}

function previewonComplete(ajax) {
    var response = trimString(ajax.response);
    $$D('preview').innerHTML = response;
}

function bursary_form() {
    window.location.href = "/pgs/pgs_user.pg_bursary_register_new"
}

function merge_basket(p_selected_id, personal_note) {
    var get_basket = trimString(getradioValue('merge'));
    if (get_basket == null || get_basket == '') {
        $$D('pcomp_errdiv').style.display = "block";
        return;
    }
    var url;
    if (get_basket == 'Current basket') {
        url = '/pgs/mypgs_compare_pkg.add_existbasket_prc?p_sel_basket_id=' + p_selected_id + '&p_personal_note=' + escape(personal_note) + '&p_factors_flag=Y';
    } else {
        url = '/pgs/mypgs_compare_pkg.add_existbasket_prc?p_sel_basket_id=' + p_selected_id + '&p_personal_note=' + escape(personal_note) + '&p_do_control_flag=Y';
    }
    var compare = new sack();
    compare.requestFile = url;
    compare.onCompletion = function () {
        response_complete(compare, p_selected_id, personal_note);
    };
    compare.runAJAX();
}

function articlesearch() {
    var keyword = trimString($$D('search_key').value);
    if (keyword != '' && keyword != 'Search articles by keyword') {
        window.location.href = '/article-search/' + encodeURIComponent(keyword);
    }
}

function submitsearch(e) {
    var keyword = trimString($$D('search_key').value);
    if (e.keycode == 13 && keyword != '' && keyword.length > 1 && keyword != null && keyword != 'Search articles by keyword') {
        if (searchTextValidate(keyword)) {
            document.forms['clear_search'].submit();
        } else {
            alert("Enter valid keyword for search");
        }
    }
}

function submitform(pageno, prev, orderBy, author, postType, filterCnt) {
    var page_no;
    if ($$D("order")) {
        $$D("order").value = orderBy;
    }
    if ($$D("author")) {
        $$D("author").value = author;
    }
    if ($$D("ptype")) {
        $$D("ptype").value = postType;
    }
    if ($$D("fcnt")) {
        $$D("fcnt").value = filterCnt;
    }
    if (prev == 'Y') {
        page_no = $$D("pageno").value - 1;
        $$D("pageno").value = page_no;
    } else if (prev == 'N') {
        page_no = ($$D("pageno").value * 1) + 1;
        $$D("pageno").value = page_no;
    } else if ($$D("pageno")) {
        $$D("pageno").value = pageno;
    }
    document.forms["articlesearchform"].submit();
}

function articleform() {
    var keyword = trimString($$D('search_key').value);
    if (searchTextValidate(keyword)) {
        if (keyword != '' && keyword != null && keyword.length > 1 && keyword != 'Search articles by keyword') {
            document.forms['clear_search'].submit();
        } else {
            if ($$D("puni_errdiv2")) {
                $$D("puni_errdiv2").style.display = "none";
            }
            $$D("puni_errdiv1").style.display = "block";
        }
    } else {
        alert("Enter valid keyword for search");
        $$D('search_key').value = "";
        $$D('search_key').focus();
    }
}

function addremove_favourite(w_video_id, remove) {
    var url;
    if (remove == 'N') {
        url = "/pgs/pgs_video_content_pkg.addto_favourite_prc?p_website_video_id=" + w_video_id;
    } else if (remove == 'Y') {
        url = "/pgs/pgs_video_content_pkg.remove_favourite_prc?p_website_video_id=" + w_video_id;
    }
    var ajax = new sack();
    ajax.requestFile = url;
    ajax.onCompletion = function () {
        favouriteonComplete(ajax, w_video_id, remove)
    };
    ajax.runAJAX();
}

function favouriteonComplete(ajax, w_video_id, remove) {
    var response = trimString(ajax.response);
    if (response == 'LOGIN') {
        newPgsLbx('signin', 'p_from=add_video&p_video_url=' + document.URL);
    } else if (response == 'SUCCESS') {
        if (remove == 'N') {
            $('.fav').attr("onclick", "addremove_favourite('" + w_video_id + "','Y')");
            $('.fav').addClass('act');
            $('#fav_text').text('Added to my favourites');
        } else if (remove == 'Y') {
            $('.fav').attr("onclick", "addremove_favourite('" + w_video_id + "','N')");
            $('.fav').removeClass('act');
            $('#fav_text').text('Add to my favourites');
        }
    }
}

function goto_videos_page(pageno) {
    var url = '/pgs/mypgs_pkg.myvideos_pod_prc?p_page_no=' + pageno;
    var wish = new sack();
    wish.requestFile = url;
    wish.onCompletion = function () {
        videosoncomplete(wish, '')
    };
    wish.runAJAX();
}

function videosoncomplete(wish, obj) {
    var response = trimString(wish.response);
    $$D('rt_pod').innerHTML = response;
}

function recommend_video(post_id) {
    var url = "/pgs/pgs_content.add_recommend_video_prc?p_post_id=" + post_id;
    var ajax = new sack();
    ajax.requestFile = url;
    ajax.onCompletion = function () {
        recommendonComplete(ajax, post_id)
    };
    ajax.runAJAX();
}

function recommendonComplete(ajax, post_id) {
    var response = trimString(ajax.response);
    var cnt = $('#recommend_cnt1').text() * 1;
    if (response == 'SUCCESS') {
        cnt = cnt + 1;
        $('#recommend_cnt1').text(cnt);
        $('#recommend_cnt2').text(cnt);
        $('#recommend_text11').text('Recommended');
        $('#recommend_text12').text('Recommended');
    } else {
        $('#recommend_text11').text('Recommended').attr("id", "recommend_text");
        $('#recommend_text12').text('Recommended').attr("id", "recommend_text");
    }
}

function sleep(milliseconds) {
    var start = new Date().getTime();
    for (var i = 0; i < 1e7; i++) {
        if ((new Date().getTime() - start) > milliseconds) {
            break;
        }
    }
}

function call_favourite() {
    $("div[id$='_errdiv1']").css("display", "none");
    if ($$D("fav_btn") != null) {
        $("#snippet_txt").css("display", "none");
        $("#fav_btn").addClass("act");
        $("#snippet").css("display", "block");
        $("#favourite").slideDown("slow");
        $("#fav_btn").attr("id", "fav_btn1");
    } else if ($$D("fav_btn1") != null) {
        call_unfavourite();
    }
}

function call_unfavourite() {
    $("#favourite").slideUp("slow");
    setTimeout(function () {
        $("#snippet").hide();
        $("#snippet_txt").show();
        $("#fav_btn1").removeClass("act");
        $("#fav_btn1").attr("id", "fav_btn");
    }, 610);
}

function mypgslightbxcontinue() {
    hm();
    if ($$D("mypgs_videos_page")) {
        var pageno = trimString($$D("mypgs_videos_page").value);
        var pagecount = trimString($$D("mypgs_videos_count").value) * 1;
        if (pagecount == 1 && pageno != 1) {
            pageno = pageno - 1;
        }
        var url = '/pgs/mypgs_pkg.myvideos_pod_prc?p_page_no=' + pageno;
        var wish = new sack();
        wish.requestFile = url;
        wish.onCompletion = function () {
            videosoncomplete(wish, '')
        };
        wish.runAJAX();
    }
}

function remove_favorite(w_video_id) {
    var url = "/pgs/pgs_video_content_pkg.remove_favourite_prc?p_website_video_id=" + w_video_id;
    var ajax = new sack();
    ajax.requestFile = url;
    ajax.onCompletion = function () {
        RemovefavouriteComplete(ajax, w_video_id)
    };
    ajax.runAJAX();
}

function RemovefavouriteComplete(ajax, w_video_id) {
    var response = trimString(ajax.response);
    var pageno = trimString($$D("mypgs_videos_page").value);
    var pagecount = trimString($$D("mypgs_videos_count").value) * 1;
    if (response == 'SUCCESS') {
        if (pagecount == 1 && pageno != 1) {
            pageno = pageno - 1;
        }
        var url = '/pgs/mypgs_pkg.myvideos_pod_prc?p_page_no=' + pageno;
        var wish = new sack();
        wish.requestFile = url;
        wish.onCompletion = function () {
            videosoncomplete(wish, '')
        };
        wish.runAJAX();
    }
}

function pgstv_remove_favorite(w_video_id) {
    var url = "/pgs/pgs_video_content_pkg.remove_favourite_prc?p_website_video_id=" + w_video_id;
    var ajax = new sack();
    ajax.requestFile = url;
    ajax.onCompletion = function () {
        pgstvonComplete(ajax, w_video_id)
    };
    ajax.runAJAX();
}

function pgstvonComplete(ajax, w_video_id) {
    var response = trimString(ajax.response);
    var url = '/pgs/pgstv_pkg.top_favourite_videos_prc?p_pgstv_flag=Y';
    var wish = new sack();
    wish.requestFile = url;
    wish.onCompletion = function () {
        pgstvresponComplete(wish)
    };
    wish.runAJAX();
}

function pgstvresponComplete(wish) {
    var response = trimString(wish.response);
    $$D('favourited').innerHTML = response;
}

function getGridSize() {
    var gridSize = ($(window).width() < 321) ? 1 : ($(window).width() < 481) ? 1 : ($(window).width() < 767) ? 2 : ($(window).width() < 900) ? 3 : 3;
    return gridSize;
}

function jqueryWidth() {
    return $(this).width();
}

function removeactv() {
    $(".prnt").removeClass('actv');
    $('#navi').find('.actv').removeClass('actv');
}

function resolutionCall(flag, id) {
    var screenWidth = jqueryWidth();
    if (screenWidth > 992) {
        $(".nv_subhr").find('ul').css("display", "block");
        $(".dummy").css("display", "block");
        if (flag == 'Y') {
            $("#navi").css("display", "block");
            $("#login").css("display", "block");
            $("#top_srch").css("display", "block");
        }
    } else {
        $(".nv_subhr").find('ul').css("display", "none");
        $(".nav_pop").not("#nav_lft2").css("display", "none");
        $(".dummy").css("display", "none");
        if (flag == 'Y') {
            $("#navi").css("display", "none");
            $("#login").css("display", "none");
            $("#top_srch").css("display", "none");
        }
    }
    if (typeof id !== "undefined") {
        if (id != null && id != '') {
            if ($('#' + id).is(':visible')) {
                $('#' + id).css("display", "block");
            } else {
                $('#' + id).css("display", "none");
            }
            $("#navi,#login,#top_srch").not('#' + id).css("display", "none")
        }
    }
}

function hide_nav() {
    var screenWidth = jqueryWidth();
    if (screenWidth > 992) {
        $("#navi,#login,#top_srch,#nav_lft1,#nav_lft2,#subnav1,#subnav2,#subnav3,#left").removeAttr("style");
        $(".prnt").removeClass('actv');
        $(".rtfl").removeClass("rtfl");
        var descr = $(".cm_fl");
        if (descr.length > 0) {
            for (var i = 1; i <= 3; i++) {
                $(".removed").removeClass('removed');
                $(".dsoc").removeClass('dsoc');
                $("#cm" + i).addClass('ms');
                $("#a" + i).css("display", "block");
                if ($("#cm" + i).hasClass('fa-minus-circle') || $("#cm" + i).hasClass('fa-plus-circle')) {
                    //alert("y");
                    $("#cm" + i).removeClass('fa-plus-circle');
                    $("#cm" + i).addClass('fa-minus-circle');
                }
            }
        }
    } else {
        var descr = $(".cm_fl");
        if (descr.length > 0) {
            for (var i = 1; i <= 3; i++) {
                var ihtml = trimString($("#a" + i).html());
                if (ihtml != "" && ihtml != null && ($("#a" + i).is(':hidden') || !$("#a" + i).hasClass('dsoc'))) {
                    $("#cm" + i).addClass('removed').removeClass('ms');
                    $("#a" + i).not('.dsoc').addClass('dsoc').css("display", "none");

                    if ($("#cm" + i).hasClass('fa-minus-circle') || $("#cm" + i).hasClass('fa-plus-circle')) {
                        //alert("x");
                        $("#cm" + i).removeClass('fa-minus-circle');
                        $("#cm" + i).addClass('fa-plus-circle');
                    }

                }
            }
        }
    }
}

function showhidenavbar(obj, id, parent) {
    var screenWidth = jqueryWidth();
    if (screenWidth < 993) {
        if (parent == 'Y') {
            $('#navi').find('.actv').removeClass('actv');
            resolutionCall('N', id);
        }
        if ($(obj).hasClass('sub_ln')) {
            $('.sub_ln.actv').not(obj).removeClass('actv');
            $("ul[id^='subnav']").not("#" + id).slideUp("400");
        } else if ($(obj).hasClass('lt_nv ln_lf')) {
            $('.lt_nv.ln_lf.actv').not(obj).removeClass('actv');
            $('.sub_ln').removeClass('actv');
            $("ul[id^='subnav']").slideUp("400");
            $("div[id^='nav_lft']:not(#nav_lft2)").not("#" + id).slideUp("400");
        } else if ($(obj).hasClass('prnt')) {
            $('.prnt.actv').not(obj).removeClass('actv');
        }
        if ($(obj).hasClass('actv')) {
            $(obj).removeClass('actv');
        } else {
            $(obj).addClass('actv');
        }
        if ($('#' + id).is(':visible')) {
            $('#' + id).slideUp("400");
        } else {
            $('#' + id).slideDown("400");
        }
    }
}

function pagectrl() {
    var screenWidth = jqueryWidth();
    if (screenWidth > 992) {
        $(".arwlft").css("display", "block");
        $(".arwrgt").css("display", "block");
        $(".next1").removeClass("next1").addClass("arwlft").css("display", "block").find("a").html("");
        $(".previous1").removeClass("next1").addClass("arwrgt").css("display", "block").find("a").html("");
        $(".dummy").css("display", "block");
    } else {
        $(".dummy").css("display", "none");
        $(".arwlft").removeClass("arwlft").addClass("next1").css("display", "block").find("a").html("Next");
        $(".arwrgt").removeClass("arwrgt").addClass("previous1").css("display", "block").find("a").html("Previous");
    }
}

function toggleFilter() {
    $('#wraper').toggleClass("rtfl");
    $('#foot').toggleClass("rtfl");
    var screenWidth = jqueryWidth();

    var contentId = $("#left");
    if (contentId.is(':visible')) {
        contentId.hide();
        if ((screenWidth >= 480) && (screenWidth <= 992)) {
            $("#sky3").removeAttr("style");
        }
    } else {
        contentId.show();
        if ((screenWidth >= 480) && (screenWidth <= 992)) {
            //$("#sky3").css("min-height","0");
        }
    }
}

function getPgstvGridSize() {
    var gridSize = ($(window).width() < 321) ? 1 : ($(window).width() < 481) ? 1 : ($(window).width() < 850) ? 2 : 3;
    return gridSize;
}

function getPgstvburGridSize() {
    var gridSize = ($(window).width() < 321) ? 1 : ($(window).width() < 481) ? 1 : ($(window).width() < 850) ? 2 : 2;
    return gridSize;
}

function validateprospectus(obj) {
    var pcollegename = trimString($$D("searchcollege_hidden").value).split("$$U");
    var psearch = trimString($$D("searchcollege").value);
    var pgsSCHurl = "";
    if (psearch != "" && pcollegename[0] == "") {
        $("#ajax_listOfOptions").css("display", "none");
        $("#puni_errdiv1").css("display", "block");
        $("#uni_error").html('Please choose a university from the list');
        return false;
    }
    if (pcollegename[0] != "" && psearch == "") {
        $("#ajax_listOfOptions").css("display", "none");
        $("#puni_errdiv1").css("display", "block");
        $("#uni_error").html('Please choose a university from the list');
        return false;
    }
    if (pcollegename[0] != "" && psearch != "") {
        pgsSCHurl = "/university-prospectus?college=" + pcollegename[0];
        window.location.href = pgsSCHurl;
    }
    return false;
}

function clear_uni_srch() {
    if ($('#puni_errdiv1').is(':visible')) {
        $('#searchcollege_hidden').val('');
        $('#puni_errdiv1').hide();
    }
}

function hideshow_ttape() {
    if (!$.trim($("#tickerTape").find("#sky6").html()).length) {
        $("#tickerTape").css("display", "none");
    } else {
        $("#tickerTape").css("display", "block");
    }
}

function show_hide_module(id, course_id) {
    var module_desc;
    module_desc = trimString($$D("mdl_" + id).innerHTML);
    if (module_desc == null || module_desc == '') {
        var url = "/pgs/get_module_prc?p_course_id=" + course_id;
        var ajax = new sack();
        ajax.requestFile = url;
        ajax.onCompletion = function () {
            show_module_sr(id, ajax);
        };
        ajax.runAJAX();
    } else {
        show_module_sr(id, ' ');
    }
}

function show_module_sr(id, ajax) {
    if (ajax != " ") {
        var response = trimString(ajax.response);
        if (response != null && response != "") {
            $('#mdl_' + id).html(response);
        }
    }
    if ($('#mdl_' + id).is(':visible')) {
        $('#comd_' + id).find("a").removeClass("ms");
        $('#mdl_' + id).hide();
    } else {
        $('#comd_' + id).find("a").addClass("ms");
        $('#mdl_' + id).show();
    }
}

function clear_error_divs() {
    $("div[id$='_errdiv1']").css("display", "none");
    $('#pgstvkeyword_hidden').val('');
    $('#pgstvkeyword').val('');

}

function password_reset_chk() {
    $("div[id$='_errdiv2']").css("display", "none");
    var errorfound = "FALSE";
    var pemail = trimString($$D("pm_email").value);
    var hashval = trimString($$D("hashval").value);
    var userval = trimString($$D("defaultReal").value);
    if (pemail == "" || pemail == null || pemail == "Please enter your email") {
        errorfound = "TRUE";
        $("#pmemail_errmsg").html("Please enter your email");
        $("#pmemail_errdiv2").css("display", "block");
        $("#defaultReal_1").trigger("click");
    } else if (!isValidEmail(pemail)) {
        errorfound = "TRUE";
        $("#pmemail_errmsg").html("Please enter valid email");
        $("#pmemail_errdiv2").css("display", "block");
        $("#defaultReal_1").trigger("click");
    }
    if (userval == "" || userval == null || userval == " Please type the characters you see" || userval != hashval) {
        errorfound = "TRUE";
        $("#hash_errmsg").html("Sorry, your response is incorrect. Please try again.");
        $("#hash_errdiv2").css("display", "block");
        $("#defaultReal_1").trigger("click");
    }
    if (errorfound == "FALSE") {
        var strSend = "pm_email=" + pemail;
        showPGSLightBox('pwdreminder-submit', '650', '350', strSend);
    }
    return false;
}

function checkPostCode(toCheck) {
    var alpha1 = "[abcdefghijklmnoprstuwyz]"; // Character 1
    var alpha2 = "[abcdefghklmnopqrstuvwxy]"; // Character 2
    var alpha3 = "[abcdefghjkpmnrstuvwxy]"; // Character 3
    var alpha4 = "[abehmnprvwxy]"; // Character 4
    var alpha5 = "[abdefghjlnpqrstuwxyz]"; // Character 5
    var BFPOa5 = "[abdefghjlnpqrst]"; // BFPO alpha5
    var BFPOa6 = "[abdefghjlnpqrstuwzyz]"; // BFPO alpha6
    var pcexp = new Array();
    pcexp.push(new RegExp("^(bf1)(\\s*)([0-6]{1}" + BFPOa5 + "{1}" + BFPOa6 + "{1})$", "i"));
    pcexp.push(new RegExp("^(" + alpha1 + "{1}" + alpha2 + "?[0-9]{1,2})(\\s*)([0-9]{1}" + alpha5 + "{2})$", "i"));
    pcexp.push(new RegExp("^(" + alpha1 + "{1}[0-9]{1}" + alpha3 + "{1})(\\s*)([0-9]{1}" + alpha5 + "{2})$", "i"));
    pcexp.push(new RegExp("^(" + alpha1 + "{1}" + alpha2 + "{1}" + "?[0-9]{1}" + alpha4 + "{1})(\\s*)([0-9]{1}" + alpha5 + "{2})$", "i"));
    pcexp.push(/^(GIR)(\s*)(0AA)$/i);
    pcexp.push(/^(bfpo)(\s*)([0-9]{1,4})$/i);
    pcexp.push(/^(bfpo)(\s*)(c\/o\s*[0-9]{1,3})$/i);
    pcexp.push(/^([A-Z]{4})(\s*)(1ZZ)$/i);
    pcexp.push(/^(ai-2640)$/i);
    var postCode = toCheck;
    var valid = false;
    for (var i = 0; i < pcexp.length; i++) {
        if (pcexp[i].test(postCode)) {
            pcexp[i].exec(postCode);
            postCode = RegExp.$1.toUpperCase() + " " + RegExp.$3.toUpperCase();
            postCode = postCode.replace(/C\/O\s*/, "c/o ");
            if (toCheck.toUpperCase() == 'AI-2640') {
                postCode = 'AI-2640'
            };
            valid = true;
            break;
        }
    }
    if (valid) {
        return postCode;
    } else return false;
}

function submitBursaryReminder(obj, reg) {
    //console.log('submitRegisteration');
    var errorfound = "FALSE";
    var pname = $$D("p_name");
    var pname_hidden = $$D("p_name_hidden");
    blockNone("pname_errdiv", "none");
    pname.className = " ";
    var psurname = $$D("p_surname");
    var psurname_hidden = $$D("p_surname_hidden");
    blockNone("psurname_errdiv", "none");
    psurname.className = "";
    var pemail = $$D("p_email");
    var pemail_hidden = $$D("p_email_hidden");
    blockNone("pemail_errdiv", "none");
    pemail.className = "reg_inpt ";
    if (reg == '') {
        var psubject = $$D("p_subject");
        var psubject_hidden = $$D("p_subject_hidden");
        blockNone("psubject_errdiv", "none");
        psubject.className = "reg_inpt ";
    }
    var pregister = $$D("p_policy_enquiry");
    var ppolicy = "";
    var pregister = "";
    var ppolicyChecked = "";
    var pregisterChecked = "";
    var pclass_name = "reg_inpt ";
    var p_sub_val = '';
    var perror_id = "";
    if (isEmpty(pname.value) || pname.value == pname_hidden.value) {
        pname.className = setErrborder;
        errorfound = "TRUE";
        $$D("pname_errmsg").innerHTML = ErrorMessage.error_empty_firstname;
        blockNone("pname_errdiv", "block");
        if (perror_id == "") {
            perror_id = "p_name";
        }
    }

    if (isEmpty(psurname.value) || psurname.value == psurname_hidden.value) {
        psurname.className = setErrborder;
        errorfound = "TRUE";
        $$D("psurname_errmsg").innerHTML = ErrorMessage.error_empty_lastname;
        blockNone("psurname_errdiv", "block");
        if (perror_id == "") {
            perror_id = "p_surname";
        }
    }
    if (isEmpty(pemail.value) || pemail.value == pemail_hidden.value) {
        pemail.className = pclass_name + setErrborder;
        errorfound = "TRUE";
        $$D("pemail_errmsg").innerHTML = ErrorMessage.error_empty_email;
        blockNone("pemail_errdiv", "block");
        if (perror_id == "") {
            perror_id = "p_email";
        }
    } else {
        if (!isValidEmail(trimString(pemail.value))) {
            pemail.className = pclass_name + setErrborder;
            errorfound = "TRUE";
            $$D("pemail_errmsg").innerHTML = ErrorMessage.error_invalid_email;
            blockNone("pemail_errdiv", "block");
            if (perror_id == "") {
                perror_id = "p_email";
            }
        }
    }
    if (reg == '') {
        p_sub_val = trimString(psubject.value);
        if (isEmpty(psubject.value) || psubject.value == psubject_hidden.value) {
            psubject.className = setErrborder;
            errorfound = "TRUE";
            $$D("psubject_errmsg").innerHTML = ErrorMessage.error_empty_subject;
            blockNone("psubject_errdiv", "block");
            if (perror_id == "") {
                perror_id = "p_subject";
            }
        }
    }

    if ($$D("p_policy_enquiry")) {
        ppolicy = $$D("p_policy_enquiry");
        blockNone("ppolicy_errdiv", "none");
        ppolicy.className = "";
        ppolicyChecked = ppolicy.checked;
        if (ppolicy.checked == false) {
            ppolicy.className = setErrborder;
            errorfound = "TRUE";
            $$D("ppolicy_errmsg").innerHTML = ErrorMessage.error_policy;
            blockNone("ppolicy_errdiv", "block");
            if (perror_id == "") {
                perror_id = "p_policy_enquiry";
            }
        }
    }

    if (errorfound == "FALSE") {

        if ($$D("p_rem")) {
            prem = $$D("p_rem");
            premChecked = prem.checked;
        }
        var url = "/pgs/pgs_user.do_bursary_remainder?p_first_name=" + trimString(pname.value) + '&p_sur_name=' + trimString(psurname.value) + '&p_email=' + trimString(pemail.value) + '&p_subject=' + encodeURIComponent(p_sub_val);
        var ajax = new sack();
        ajax.requestFile = url;
        ajax.onCompletion = function () {
            burasryRemainderComplete(ajax)
        };
        ajax.runAJAX();
        //aForm.submit();
        //return true;
    } else {
        $$D(perror_id).focus();
    }
    return false;

}

function burasryRemainderComplete(wish) {
    var response = trimString(wish.response);
    //alert(response);
    var str = response.split('$$$');
    //alert(str[1]);
    if (response == "SUCCESS" || response.indexOf("SUCCESS") > 0) {
        //window.location.href = document.URL;
        showPGSLightBox('bur_success', '665', '520', 'p_msg=rs');
    } else if (response == "ALREADY REMAINDER" || response.indexOf("ALREADY REMAINDER") > 0) {
        showPGSLightBox('bur_success', '665', '520', 'p_msg=ra');
    } else if (response == "FAILURE APPLIED" || response.indexOf("FAILURE APPLIED") > 0) {
        showPGSLightBox('bur_success', '665', '520', 'p_msg=rf');
    } else if (response.indexOf("NEW_USER") > -1) {
        //alert('comg');
        var str = response.split('$$$');
        save_bursary(str[1]);
    } else {
        //showPGSLightBox('bur_success','665','520');
        $$D("lightbx").innerHTML = response;
        $$D("ajax-div").style.display = "none";
        $$D("lightbx").style.display = "block";
        $$D("newvenueform").style.display = "block";
    }
}

function save_bursary(p_user_id) {
    $("div[id$='_errdiv']").css("display", "none");
    var errfound = "false";
    var listItem = $(".unslt").find('.sltd').not('#sl');
    var id;
    var val;
    var mutliple_id;
    var multiple_factors;
    for (var i = 0; i < listItem.length; i++) {
        id = $(listItem[i]).attr("id");
        factor_id = id.substr(2);
        if (i == 0) {
            mutliple_id = factor_id;
        } else {
            mutliple_id = mutliple_id + ',' + factor_id;
        }
    }
    if (listItem.length == 0) {
        errfound = "True";
        $('#pcollege_errmsg').html('Please choose a university from the list');
        $('#pcollege_errdiv').show();
    }
    //var p_subject = $("#p_subject_val").val();
    var p_subject = $('#bur_sub_bx').find('#sl a').attr('name');
    //alert(p_subject);
    if (p_subject == 'Which subject do you want to study?') {
        p_subject = '';
    }
    //var sub_div = $('#bur_sub_bx').find('#s1');
    var elem = $('#bur_sub_bx').find('#sl');
    if (elem.length == 0)
    //alert(sub_div.length);
    //if(sub_div.length == 0)
    //if(p_subject == null || p_subject == '')
    {
        errfound = "True";
        $('#psubject_errmsg').html('Please enter a subject');
        $('#psubject_errdiv').show();
    }
    var penqcountry = $$D("p_enqcountry").value;
    if (errfound == 'false') {
        if (p_user_id == "") {
            var strsend = 'p_reg_flag=reg&p_bur_subject=' + encodeURIComponent(p_subject) + '&p_university_ids=' + mutliple_id + '&p_origin=' + penqcountry;
            //showPGSLightBox('bur_apply_login','665','520',strsend);
            sm('newvenueform', '665', '520', 'bur_apply_login');
            $$D("ajax-div").style.display = "block";
            $$D("lightbx").style.display = "block";
            var ajax = new sack();
            ajax.requestFile = "/pgs/pgs_bursary_winners_pkg.bursary_apply_lightbox_prc?" + strsend; // Specifying which file to get
            ajax.onCompletion = function () {
                displayFormData(ajax, 'bur_apply_login');
            }; // Specify function that will be executed after file has been found
            ajax.runAJAX();
            $(window).trigger('resize');
            return;
        }
        var url = "/pgs/pgs_bursary_winners_pkg.do_bursary_apply_prc?p_user_id=" + p_user_id + '&p_university_ids=' + mutliple_id + '&p_subject=' + encodeURIComponent(p_subject) + '&p_origin=' + penqcountry;
        var ajax = new sack();
        ajax.requestFile = url;
        ajax.onCompletion = function () {
            bursaryonComplete(ajax, multiple_factors)
        };
        ajax.runAJAX();
    }
}

function bursaryonComplete(ajax, multiple_factors) {
    var response = trimString(ajax.response);
    if (response == "SUCCESS" || response.indexOf("SUCCESS") > 0) {
        //alert('SUCCESS');
        //showPGSLightBox('bur_success','665','520','p_msg=as');
        $$D("note").style.display = "block";
        $$D("win1").style.display = "block";
        $$D("req").style.display = "none";
        $$D("next1").style.display = "none";
        $("#step1 *").attr("disabled", "disabled").off('click');
        hm();
    } else if (response == "FAILURE APPLIED" || response.indexOf("FAILURE APPLIED") > 0) {
        showPGSLightBox('bur_success', '665', '520', 'p_msg=rf');
    }
}

function delete_uni_bursary(id) {
    $('#cl' + id).remove();
}

function setusertype_cookie() {
    var Currentdate = new Date();
    var numberOfDaysToAdd = 365;
    Currentdate.setDate(Currentdate.getDate() + numberOfDaysToAdd);
    setCookie('pgs_usertype', 'returnuser', Currentdate, '/', '', '');
    $$D("cookie-lightbox").style.display = "none";
}

function add_bur_subject() {
    var sub_value = $('#p_subject_val').val();
    blockNone("psubject_errdiv", "none");
    sub_value.className = "reg_inpt "
    //alert(sub_value);			
    if (sub_value != null && sub_value != '') {
        //var sub_name = $('#p_subject_val').val();
        //$('#cl'+sub_value).remove();
        if (sub_value == 'Which subject do you want to study?') {
            sub_value.className = setErrborder;
            errorfound = "TRUE";
            $$D("psubject_errmsg").innerHTML = ErrorMessage.error_empty_subject;
            blockNone("psubject_errdiv", "block");
        } else {
            var elem = $('#bur_sub_bx').find('#sl');
            if (elem.length == 0) {
                $('#bur_sub_bx').append('<div id="sl" class="sltd"><a name="' + sub_value + '">' + sub_value + '</a><i onclick="delete_sub_bursary();" class="fa fa-times" ></i></div>');
                $('#p_subject_val').val('Which subject do you want to study?');
                document.getElementById("add_sub").disabled = "true";
            } else {
                //alert('already added');
                $$D("note1").style.display = "block";
            }
        }
    }
}

function delete_sub_bursary() {
    $('#sl').remove();
    $('#add_sub').disabled = "false";
    $$D("note1").style.display = "none";
}

function isValidDOBDate(day, month, year, monthStr) {
    var msg = "";
    if (day == 'Day' || day == 'DD' || day < 1 || day > 31) {
        msg = "Day must be between 1 and 31.";
        //msg = "Please select valid date";
        return msg;
    }
    if (month < 1 || month > 12) { // check month range
        msg = "Please select a month from the drop down";
        return msg;
    }
    if ((month == 4 || month == 6 || month == 9 || month == 11) && day == 31) {
        msg = "Month " + monthStr + " doesn't have 31 days!";
        //msg = "Please select valid date";
        return msg;
    }
    //alert(month);
    if (month == 2) { // check for february 29th
        var isleap = (year % 4 == 0 && (year % 100 != 0 || year % 400 == 0));
        if (year != "Year" && year != "YYYY" && (day > 29 || (day == 29 && !isleap))) {
            msg = "February " + year + " doesn't have " + day + " days!";
            //msg = "Please select valid date";
            //alert(msg);
            return msg;
        }
    }
    if (year == 'Year' || year == "") {
        msg = "Please select a year from the year drop down.";
        return msg;
    }
    return "valid"; // date is valid
}

function showSrtlb(assoc_id, page) {
    if ($$D("lbbskt" + assoc_id).className == "cmp_cnr") {
        $$D("lbaddremId" + assoc_id).innerHTML = "Add to Shortlist";
        $$D("lbshow" + assoc_id).style.display = "block";
    } else {
        $$D("lbaddremId" + assoc_id).innerHTML = "Remove from Shortlist";
        $$D("lbshow" + assoc_id).style.display = "block";
    }
}

function hideSrtlb(assoc_id) {
    $$D("lbshow" + assoc_id).style.display = "none";
}

function compareLb(bsktId, assocId, assocType, userId, courseId, collegeId) {
    if ($$D("bskt" + assocId) && $$D("bskt" + assocId).className != "squr active") {
        //addRemoveBasket(bsktId,userId,assocId,assocType,'','inner');
        var url = '/pgs/mypgs_compare_pkg.check_basket_content_prc?p_basket_id=' + bsktId + '&p_assoc_id=' + assocId + '&p_assoc_type=' + assocType;
        var wish = new sack();
        wish.requestFile = url;
        wish.onCompletion = function () {
            compareLbComplete(wish, bsktId, assocId, assocType, courseId, userId, collegeId);
        };
        wish.runAJAX();
    }
}

function compareLbComplete(obj, bsktId, assocId, assocType, courseId, userId, collegeId) {
    var a = addRemoveBasket(bsktId, userId, assocId, assocType, '', 'inner');
    if ((trimString(obj.response) == 'Y') && (a != 'N')) {
        setTimeout(function () {
            if ($("#mbox").is(':hidden')) {
                showPGSLightBox('webclick_compare', '665', '520', 'p_college_id=' + collegeId + '&p_course_id=' + courseId + '&p_basket_id=' + bsktId + '&p_user_id=' + userId + '&p_assoc_id=' + assocId + '&p_assoc_type=' + assocType)
            }
        }, 2000);
        //showPGSLightBox('webclick_compare','665','520','p_course_id='+courseId+'&p_basket_id='+bsktId+'&p_user_id='+userId+'&p_assoc_id='+assocId+'&p_assoc_type='+assocType)		 
    }
}

function redirectFn() {
    window.location.href = "/pgs/mypgs_compare_pkg.compare_course_prc";
}

function lbCmpChk(bsktId, userId, assocId, assocType, type) {
    addRemoveBasket(bsktId, userId, assocId, assocType, '', 'inner');
    /*if ($$D('chkbsk'+assocId).value == "ADD"){
    	document.getElementsByClassName("grntxt").innerHTML='<span class="fa fa-check"> </span>ADDED';
    }else if($$D('chkbsk'+assocId).value == "REMOVE"){
    	document.getElementsByClassName("grytxt").innerHTML='<span class="fa fa-times"> </span>REMOVED';
    }*/
    //if($$D('lbchkbsk'+assocId).value == "ADD"){		
    if (type == "ADD") {
        $$D('lbbskt' + assocId).setAttribute("onClick", 'lbCmpChk("' + bsktId + '","' + userId + '","' + assocId + '","' + assocType + '","REMOVE")');
        $$D("actionLB" + assocId).className = "grntxt";
        $$D("actionLB" + assocId).innerHTML = '<span class="fa fa-check"> </span>ADDED';
        if ($$D('lbbskt' + assocId).className == "adsh") {
            $$D('lbbskt' + assocId).className = "adsh active";
        } else if ($$D('lbbskt' + assocId).className == "cmp_cnr") {
            $$D('lbbskt' + assocId).className = "cmp_cnr active";
        }
    } else if (type == "REMOVE") {
        $$D('lbbskt' + assocId).setAttribute("onClick", 'lbCmpChk("' + bsktId + '","' + userId + '","' + assocId + '","' + assocType + '","ADD")');
        $$D("actionLB" + assocId).className = "grytxt";
        $$D("actionLB" + assocId).innerHTML = '<span class="fa fa-times"> </span>REMOVED';
        if ($$D('lbbskt' + assocId).className == "adsh active") {
            $$D('lbbskt' + assocId).className = "adsh";
        } else if ($$D('lbbskt' + assocId).className == "cmp_cnr active") {
            $$D('lbbskt' + assocId).className = "cmp_cnr";
        }
    }
}

function hideandshowAddFinderDP(obj) {
    var countryOfRes = obj.value;
    if (countryOfRes != null && (countryOfRes == '55' || countryOfRes == '139' || countryOfRes == '256' || countryOfRes == '257')) {
        document.getElementById('addFinderdp').style.display = 'block';
        //document.getElementById('postaddid_dp').style.display= 'block';
    } else {
        document.getElementById('addFinderdp').style.display = 'none';
        document.getElementById('postaddid_dp').style.display = 'none';
    }
}

function dontShow() {
    setCookie('compareLb_dont', 'Y', '', '/', '', '');
    hm();
}
$(document).ready(function () {
    //Drop down
    $('#dp1').click(function () {
        if ($('#dp2').next('ul').is(':visible')) {
            $('#dp2').next('ul').slideToggle().toggleClass('show-off');
        }
        $(this).next('ul').slideToggle().toggleClass('show-off');
        $('.drp_menu a').click(function () {
            var $dcat = $(this).html();
            $(this).parents('.drp_menu').closest('.sec_cnr').find('.slct_menu').html($dcat);
            $(this).parents('.drp_menu').slideUp();
        });
        if ($(window).width() <= 1024) {

            if ($(this).prev("#scroll").css("display") == "none") {
                $(this).prev("#scroll").delay(300).fadeIn('fast');
            } else {
                $("#scroll").hide();
            }
        }
    });
    $('#dp2').click(function () {
        if ($('#dp1').next('ul').is(':visible')) {
            $('#dp1').next('ul').slideToggle().toggleClass('show-off');
        }
        $(this).next('ul').slideToggle().toggleClass('show-off');
        $('.drp_menu a').click(function () {
            var $dcat = $(this).html();
            $(this).parents('.drp_menu').closest('.sec_cnr').find('.slct_menu').html($dcat);
            $(this).parents('.drp_menu').slideUp();
            //$(this).parents('.drp_menu').css({"overflow":"visible!important"});
        });
        if ($(window).width() <= 1024) {
            if ($(this).prev("#scroll").css("display") == "none") {
                $(this).prev("#scroll").delay(300).fadeIn('fast');
            } else {
                $(this).prev("#scroll").hide();
            }
        }
    });
    if ($('#subj').children('li').length < 5) {
        $('#subj').css({
            "overflow-y": "auto!important",
            "height": "auto"
        });
    }

    var screenWidth = jqueryWidth();
    if (screenWidth > 992) {
        // $('#course_box').slideUp();	
        $(window).scroll(function () {
            if ($(this).scrollTop() > 845) {
                if ($('#course_box').css("display") == "none" && !$('#course_box').hasClass('hide_article_btn')) {
                    $('#course_box').slideDown("slow");
                }
            }
            if ($(this).scrollTop() < 845) {
                if ($('#course_box').css("display") == "block" && !$('#course_box').hasClass('hide_article_btn')) {
                    $('#course_box').slideUp();
                }
            }
        })
    } else {
        $('#course_box').show();
    }
});

function videoArticle(obj, sid) {
    obj.style.display = 'none';
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "/pgs-cont/scripts/player/jwplayer.js";
    if (typeof script != "undefined") {
        document.getElementsByTagName("head")[0].appendChild(script);
    }
    script.onload = playVideo;
}

$(document).ready(function () {
    $('#tabs li a').click(function () {
        $("#tabs .current").removeClass();
        $(this).parent().addClass('current');
        if ($(this).attr("id") == 'watch') {
            $('#art').hide();
            $('#video').show();
        } else {
            $('#video').hide();
            $('#art').show();
        }
    });
});

function cpearticlesponsorurl(collegeId, externalUrl) {
    cpeDbStatsLogging(collegeId, '', '', externalUrl, "ARTICLE_SPONSORSHIP_WEBCLICK");
}

function cpeDbStatsLogging(collegeid, subOrderItemId, networkId, externalUrl, clickType, sectionName) {
    //alert('cpeDbStatsLogging("'+collegeid+'", "'+subOrderItemId+'", "'+networkId+'", "'+externalUrl+'", "'+clickType+'", "'+sectionName+'")'); /* remove SOP */
    var ajax = new sack();
    /* puts an entry in "wu_stats_log_pkg.add_log_fn" */
    var url = '/pgs/pgs_interactive.web_click_db_log?z=' + collegeid + "&p_external_link=" + encodeURIComponent(externalUrl) + "&p_type=" + clickType;
    //alert("url: "+url);  
    ajax.requestFile = url;
    /* Specify function that will be executed after file has been found */
    ajax.onCompletion = function () {
        responseData(ajax);
    };
    ajax.runAJAX();
}

function setBorder(obj) {
    var countryId = $$D("p_enqcountry_cd");
    var ipFlag = $$D("p_ip_flag");
    if (isEmpty(obj.value)) {
        //obj.className = "err_wrg";
		obj.classList.add("err_wrg");
		obj.classList.remove("err_rte");
    } else {
        if (obj.id == "p_email1") {
            if (!isValidEmail(trimString(obj.value))) {
                obj.classList.add("err_wrg");
				obj.classList.remove("err_rte");
            } else {
                //obj.className = "err_rte";
				obj.classList.add("err_rte");
				obj.classList.remove("err_wrg");
            }
        } else if (obj.id == "p_enqpc_cd" && ipFlag.value == 'Y') {
            if ((!isValidUKpostcode(trimString(obj.value))) || isEmpty(obj.value)) {
                obj.classList.add("err_wrg");
				obj.classList.remove("err_rte");
            } else {
                //obj.className = "err_rte";
				obj.classList.add("err_rte");
				obj.classList.remove("err_wrg");
            }
        } else {
            //obj.className = "err_rte";
			obj.classList.add("err_rte");
			obj.classList.remove("err_wrg");
			
        }
    }
}

function setBorderDrop(obj, divId) {
    //alert(obj.options[obj.selectedIndex].value);
    text = obj.options[obj.selectedIndex].value;
    if (isEmpty(text) || text == 'day' || text == 'month' || text == 'year' || text == 'Country of residence') {
        $$D(divId).className = "sbx";
        $('#' + divId).toggleClass('err_wrg');
        if ($$D("p_country_errmsg")) {
            blockNone("p_country_errmsg", "block");
        }
    } else {
        $$D(divId).className = "sbx";
        $('#' + divId).toggleClass('err_rte');
        if ($$D("p_country_errmsg")) {
            blockNone("p_country_errmsg", "none");
        }
    }
}

function dobValidation() {
    var val = "empty";
    var day = $$D("p_date_cd1");
    var month = $$D("p_month_cd");
    var year = $$D("p_year_cd");
    var d = day.options[day.selectedIndex].value;
    var m = month.options[month.selectedIndex].value;
    var y = year.options[year.selectedIndex].value;
    var str = month.options[month.selectedIndex].text;

    if (d != "" && d != null) {
        $$D('daychange').value = 2;
    }
    if (m != "" && m != null) {
        $$D('monthchange').value = 2;
    }
    if (y != "" && y != null) {
        $$D('yearchange').value = 2;
    }

    if ((d != '' && d != null) && (m != '' && m != null) && (y != '' && y != null)) {
        val = isValidDOBDate(d, m, y, str);
    } else {
        val = "empty";
    }

    if (val == 'empty' && ((d != '' && d != null) && (m != '' && m != null) && (y != '' && y != null))) {
        //alert('1');
        $$D('day_fld').className = "sbx err_wrg";
        $$D('mon_fld').className = "sbx err_wrg";
        $$D('year_fld').className = "sbx err_wrg";
    } else if (val == 'valid' && (d != '' && d != null) && (m != '' && m != null) && (y != '' && y != null)) {
        //alert('2');
        $$D('day_fld').className = "sbx err_rte";
        $$D('mon_fld').className = "sbx err_rte";
        $$D('year_fld').className = "sbx err_rte";
    } else if (((d != '' || d != null) || (m == '' || m == null) || (y == '' || y == null)) && ($$D('daychange').value != 1 && $$D('monthchange').value != 1 && $$D('yearchange').value != 1)) {
        //alert('2');
        $$D('day_fld').className = "sbx err_wrg";
        $$D('mon_fld').className = "sbx err_wrg";
        $$D('year_fld').className = "sbx err_wrg";
    }
}

function embedFormSubmit() {
   $$D('stg1b').className += " dis_clk";
    //alert('Coming');
    var errorfound = "FALSE";
    var pmsg = $$D("p_msg1");
    var pname = $$D("p_name1");
    var psurname = $$D("p_surname1");
    var pemail = $$D("p_email1");
    //var pname = $$D("p_name1");
    var psurname = $$D("p_surname1");
    var pemail = $$D("p_email1");
    var dobDate = $$D("p_date_cd1");
    blockNone("pdob_errdiv", "none"); //PGS_20150811
    var dMonth = $$D("p_month_cd");
    //var dobMonth = $$D("p_month_cd").value;
    var dobYear = $$D("p_year_cd");
    var postcode = $$D("p_enqpc_cd");
    var pc;
    blockNone("penqpc_errdiv_cd", "none");
    //var monthStr = dMonth.options[dMonth.selectedIndex].innerHTML;
    var yoe = getradioValue('p_crsstarttyear');
    var ipFlag = $$D("p_ip_flag");
    var pregisterChecked = "true";
    var msg = $$D("p_msg1").value;
    var flag = containsSpecialCharacter(msg);
	var perror_id = "";
	var marketing_flag = $$D("market").value;
	var souls_flag = $$D("solus").value;
	var survey_flag = $$D("survey").value;
    var ppassword = $$D("pass");
	var receive_no_flag = 'N';
	var wigth = screen.width;
	setCookie('PGS_YOE',trimString(yoe), '', '/', '', '');
	 
    if (trimString(flag) != "") {
        p_msg1.className = "adiptxt err_wrg";
        errorfound = "TRUE";
        $$D("p_msg1_errmsg").innerHTML = "There are some illegal characters in the text you supplied. Tut tut!";
        blockNone("p_msg1_errmsg", "block");
        //return false;     
    } else {
        blockNone("p_msg1_errmsg", "none");
    }
    if (isEmpty(pmsg.value)) {
        errorfound = "TRUE";
        setBorder(pmsg);
    }
    if (isEmpty(pname.value)) {
        errorfound = "TRUE";
        setBorder(pname);
    }
    if (isEmpty(psurname.value)) {
        errorfound = "TRUE";
        setBorder(psurname);
    }
    if (isEmpty(pemail.value)) {
        errorfound = "TRUE";
        setBorder(pemail);
    } else {
        if (!isValidEmail(trimString(pemail.value))) {
            errorfound = "TRUE";
            setBorder(pemail);
        }
    }
    if (yoe == "" || yoe == null || yoe == 'Year of entry*') {
        errorfound = "TRUE";
        //setBorderDrop($$D("p_crsstarttyear"), 'yoe_fld');
    }
	
	//alert(ppassword.value+' ppassword.value');
	if($$D("pass")!=null)
	 if (isEmpty(ppassword.value)) {
        errorfound = "TRUE";
        setBorder(ppassword);
    }
    if ($$D("pass")) {
        p_pass = $$D("pass");
        blockNone("p_pass_err", "none");
        if ( !isEmpty(trimString(ppassword.value)) && (ppassword.value).length < 6) {
		    pass.className = "adiptxt err_wrg";
            blockNone("p_pass_err", "block");
            errorfound = "TRUE";
            if (perror_id == "") {
                perror_id = "pass";
            }
		 else {
		      blockNone("p_pass_err", "none");
              errorfound = "FALSE";
			  }
        }
		
    }
	
	if (marketing_flag == 'true') {
         marketing_flag = 'Y';
    }
     if (souls_flag == 'true') {
         souls_flag = 'Y';
    }
     if (survey_flag == 'true') {
         survey_flag = 'Y';
    }

    if ($$D("p_policy_enquiry")) {
        ppolicy = $$D("p_policy_enquiry");
        blockNone("p_policy_enquiry_err", "none");
        ppolicyChecked = ppolicy.checked;
        if (ppolicy.checked == false) {
            blockNone("p_policy_enquiry_err", "block");
            errorfound = "TRUE";
            if (perror_id == "") {
                perror_id = "p_policy_enquiry";
            }
        }
    }
	
    if (errorfound == "FALSE") {
        //hideSubmitButton('req');	
        var strSend = "x=" + $$D("x1").value +
            "&a=" + $$D("a").value +
            "&z=" + $$D("z1").value +
            "&w=" + $$D("w1").value +
            "&p_user_id=" + $$D("p_user_id1").value +
            "&p_order_item_id=" + $$D("p_order_item_id1").value +
            "&p_from_page=CD" +
            "&p_postcode=" + trimString($$D("p_enqpc_cd").value) +
			"&p_marketing_flag=" + marketing_flag +
			"&p_souls_flag=" + souls_flag +
			"&p_survey_flag=" + survey_flag 
			+"&p_receive_flag=" + receive_no_flag
			+"&p_screen_width="+wigth;

        strSend = strSend + "&p_msg=" + escape($$D("p_msg1").value) + "&p_register=" + pregisterChecked + "&p_crsstarttyear=" + yoe;
		if($$D("pass")!=null)
        var em_password = trimString($$D("pass").value);
        var url = "/pgs/pgs_interactive.do_enquire_new?" + strSend;
        var ajax = new sack();
		ajax.setVar("p_name", trimString(pname.value));
		ajax.setVar("p_surname", trimString(psurname.value));
		ajax.setVar("p_email", trimString(pemail.value));
		ajax.setVar("p_password", encodeURIComponent(em_password));
        ajax.requestFile = url; // Specifying which file to get
		//ajax.setVar("p_password",em_password );
        ajax.onCompletion = function () {
            reqinfoformcomplete(ajax, strSend)
        }; // Specify function that will be executed after file has been found
        ajax.runAJAX();
    }
	else{
	 $$D('stg1b').className = "nwbtn nwgrn_btn";
	}
 return false;
}

function reqinfoformcomplete(ajax, strSend) {
    var response = trimString(ajax.response);
    var randnum = Math.floor((Math.random() * 10000000) + 1);
    if (response == 0) {
        var GAemail_flag = trimString($$D("GAemail_flag_hidden1").value);
        var ga_collegeName = $$D("ga_college_name1").value;
        var ga_cpeValue = $$D("ga_cpe_value1").value;
        if (GAemail_flag == 'N') {
            GAInteractionEventTracking('email', 'interaction', 'Email-embed', ga_collegeName, ga_cpeValue); /*GA Logging*/
			sponsoredGaLogging($$D("w1").value,$$D("z1").value);
            var college_id1 = $$D("z1").value;
            var course_id1 = $$D("w1").value;
            GAInsightEventTracking(college_id1, course_id1, 'N');
        }
        //$$D("req_info").style.display = "none";
        //$$D("req_info1").style.display = "block";
        //$$D("error_msg1").innerHTML ="Your request has been sent";

        $('.stg3').slideUp();
        $('.stg4').slideDown('slow');

        $$D("login").innerHTML = "<a href=\"javascript:void(0)\" onclick=\"userLogout('pgs_x');userLogout('PGS_YOE')\" rel=\"nofollow\">Logout</a><div class=\"hovln\"></div><span class=\"slsh\"> / </span><a href=\"/pgs/pgs_user_profile_pkg.get_mydetails_prc?p_random_val=" + randnum + "\">MyPGS</a><div class=\"hovln\"></div>";
    } else {
        //showPGSLightBox('email-submit', '650', '350', strSend);
		newPgsLbx('email-submit', strSend);
    }
}

function redirectionLbx() {
    var param;
    var val;
    var splitVar;
    var usource, umedium, ucampaign;
    var strHref = window.location.href;
    if (strHref.indexOf("?") > -1) {
        var strQueryString = strHref.split("?");
        var aQueryString = strQueryString[1].split("&");
        for (var iParam = 0; iParam < aQueryString.length; iParam++) {
            splitVar = aQueryString[iParam].split("=");
            if (splitVar[0].toLowerCase() == "utm_source") {
                usource = splitVar[1];
            } else if (splitVar[0].toLowerCase() == "utm_medium") {
                umedium = splitVar[1];
            } else if (splitVar[0].toLowerCase() == "utm_campaign") {
                ucampaign = splitVar[1];
            }
        }
    }
    if ((usource == "hotcourses") && (umedium == "redirect") && (ucampaign == "hcmigration")) {
        showPGSLightBox('redirection_lightbox', 665, 520, '');
        //showPGSLightBox('redirection_lightbox',665,520, '');
    }
}

function tutionFeesAjax(obj, colId, crsId) {
    var opId = obj.value;
    var ajaxURL = CommonObjects.pgs_context_path + "/pgs_course_pkg.tution_fees_prc?p_college_id=" + colId + "&p_course_id=" + crsId + "&p_opportunity_id=" + opId;
    var ajax = new sack();
    ajax.requestFile = ajaxURL;
    ajax.onCompletion = function () {
        tutionFeesAjaxResponse(ajax);
    };
    ajax.runAJAX();
}

function tutionFeesAjaxResponse(obj) {
    $$D("tutFees").innerHTML = obj.response;
}

function pcSrch(e) {
    if (e.keyCode == 13) {
        findAddress('p_enqpc_cd', 'CD', '');
    }
}

function playerCommon(a, fileLoc, coverimg, wd, ht, videoPath, embedUrl, pgstv_flag, logo_link, autoStart, shareUrl) {
    var playerKey = "8kARhLRuyZ5r/mSgwJtTl0Szp0XZU9ECpMs+SQ==";
    var flashPlayerLoc = "/pgs-cont/scripts/player/jwplayer.flash.swf";
    var iframe = "<iframe scrolling='no' allowfullscreen frameborder='0' border='0' width='520' height='320' src=" + embedUrl + ">";
    var logoLink;
    var logoPath;
    var surl;
    if (pgstv_flag == 'Y') {
        logoPath = pgs_domain + "/pgs-cont/img/pgs-tv-watermark.png";
        logoLink = logo_link;
    } else {
        logoPath = "";
        logoLink = "";
    }
    if (shareUrl != "" || shareUrl != null) {
        surl = shareUrl;
    } else {
        surl = "bitUrlForsharing";
    }
    jwplayer.key = playerKey;
    if (pgstv_flag == 'Y') {
        jwplayer(a).setup({
            file: fileLoc,
            flashplayer: flashPlayerLoc,
            logo: {
                file: logoPath,
                link: logoLink
            },
            image: coverimg,
            height: ht,
            width: wd,
            autostart: autoStart,
            ga: {},
            sharing: {
                code: encodeURI(iframe),
                link: surl
            }
        });
    } else {
        jwplayer(a).setup({
            file: fileLoc,
            flashplayer: flashPlayerLoc,
            image: coverimg,
            height: ht,
            width: wd,
            autostart: autoStart,
            ga: {},
            sharing: {
                code: encodeURI(iframe),
                link: surl
            }
        });
    }
    //videoGaLogging(a, videoPath);
}
/*function videoGaLogging(videoName, videoUrl){
  jwplayer(videoName).on("play", function(){ ga('send',  'event', 'video', 'Play' , 'galocation' , 1 , {nonInteraction: true}); });
}*/

function setBorderReg(obj) {
    var countryId = $$D("p_country");
    var suc_id = obj.id + "_suc";
    var err_id = obj.id + "_err";
	blockNone(err_id, 'none');
    blockNone(suc_id, 'none');
	 obj.className = "";
    if (isEmpty(trimString(obj.value))) {
		obj.className = "err_wrg";		
        if (obj.id == "p_email") {
            $$D(err_id).innerHTML = "We need this so we can send you..well emails obviously.";
        }
        blockNone(err_id, 'block');
        //blockNone(suc_id, 'none');
    } else {
        if (obj.id == "p_email") {
			                        setTimeout(function(){
            if (!isValidEmail(trimString(obj.value))) {
				obj.className = "err_wrg";
                $$D(err_id).innerHTML = "Something seems to be missing from your email. Awkward.";
                blockNone(err_id, 'block');
                //blockNone(suc_id, 'none');
            } else {
                obj.className = "err_rte";
                //blockNone(err_id, 'none');

                check_email_validation(obj, err_id);
                //blockNone(suc_id,'block');
            }
									 }, 500);
        } else if (obj.id == "p_postcode") {
            if ((!isValidUKpostcode(trimString(obj.value))) && (countryId.value == 55 || countryId.value == 139 || countryId.value == 256 || countryId.value == 257) || isEmpty(obj.value)) {
                obj.className = "err_wrg";
                blockNone(err_id, 'block');
                //blockNone(suc_id, 'none');
            } else {
                obj.className = "err_rte";
                //blockNone(err_id, 'none');
                blockNone(suc_id, 'block');
            }
        } else {
            obj.className = "err_rte";
            //blockNone(err_id, 'none');
            blockNone(suc_id, 'block');
        }
    }
}

function check_email_validation(obj, err_id) {
    var email = obj.value;
    var url = '/pgs/pgs_user.pgs_email_validation_prc?p_email=' + email;

    var newemail = new sack();
    newemail.requestFile = url;
    newemail.onCompletion = function () {
        email_validate(newemail, err_id, obj);
    };
    newemail.runAJAX();
};

function email_validate(email, divId, obj) {
    var response = trimString(email.response);
    var suc_id = obj.id + "_suc";
    var err_id = obj.id + "_err";

    if (response == 'EXISTS') {
        $$D(divId).innerHTML = response;
        obj.className = "err_wrg";
        $$D(err_id).innerHTML = "Email ID already exists, please try with other Email ID";
        blockNone(err_id, 'block');
        blockNone(suc_id, 'none');
        $$D("email_error_found").value = 'Y';
    } else {
        blockNone("p_email_suc", 'block');
        $$D("email_error_found").value = 'N';
    }
}

function setBorderDropReg(obj, divId) {
    //alert(obj.options[obj.selectedIndex].value);
    text = obj.options[obj.selectedIndex].value;
    err_id = obj.id + "_err";
    if (isEmpty(text)) {
        $$D(divId).className = "sbx";
        $('#' + divId).toggleClass('err_wrg');
        blockNone(err_id, 'block');
    } else {
        $$D(divId).className = "sbx";
        $('#' + divId).toggleClass('err_rte');
        blockNone(err_id, 'none');
    }
}

function dobValidationReg() {
    var val = "empty";
    var day = $$D("p_day");
    var month = $$D("p_month");
    var year = $$D("p_year");
    var d = day.options[day.selectedIndex].value;
    var m = month.options[month.selectedIndex].value;
    var y = year.options[year.selectedIndex].value;
    var str = month.options[month.selectedIndex].text;

    if (d != "Day" && d != null) {
        $$D('daychange_reg').value = 2;
    }
    if (m != "" && m != null) {
        $$D('monthchange_reg').value = 2;
    }
    if (y != "Year" && y != null) {
        $$D('yearchange_reg').value = 2;
    }

    val = isValidDOBDate(d, m, y, str);
    if (val == 'valid' && $$D('daychange_reg').value != 1 && $$D('monthchange_reg').value != 1 && $$D('yearchange_reg').value != 1) {
        $$D('day_field').className = "sbx err_rte";
        $$D('month_field').className = "sbx err_rte";
        $$D('year_field').className = "sbx err_rte";
        blockNone('p_dob_err', 'none');
        blockNone('p_dob_suc', 'block');
    } else if (val != 'valid' && $$D('daychange_reg').value != 1 && $$D('monthchange_reg').value != 1 && $$D('yearchange_reg').value != 1) {
        $$D('day_field').className = "sbx err_wrg";
        $$D('month_field').className = "sbx err_wrg";
        $$D('year_field').className = "sbx err_wrg";
        $$D('p_dob_err').innerHTML = val;
        blockNone('p_dob_suc', 'none');
        blockNone('p_dob_err', 'block');
    }
}

function passwordCheck(obj) {
    var suc_id = obj.id + "_suc";
    var err_id = obj.id + "_err";
    var password = trimString($$D("p_password").value);
    var confirmpassword = trimString($$D("p_confirm_password").value);
    if (isEmpty(obj.value)) {
        obj.className = "err_wrg";
        if (obj.id == 'p_confirm_password') {
            $$D(err_id).innerHTML = "Stop rotters going into your account";
        }
        blockNone(err_id, 'block');
        blockNone(suc_id, 'none');
    } else if (obj.id == 'p_password' && !isEmpty(password) && password.length < 6) {
        obj.className = "err_wrg";
        $$D(err_id).innerHTML = "Your password should be 6 characters or more";
        blockNone(err_id, 'block');
        blockNone(suc_id, 'none');
    } else if (obj.id == 'p_confirm_password' && !isEmpty(confirmpassword) && confirmpassword.length < 6) {
        obj.className = "err_wrg";
        $$D(err_id).innerHTML = "Your confirm password should be 6 characters or more";
        blockNone(err_id, 'block');
        blockNone(suc_id, 'none');
    } else if (obj.id == 'p_confirm_password' && obj.value != $$D("p_password").value) {
        obj.className = "err_wrg";
        $$D(err_id).innerHTML = "Your passwords do not match, please try again";
        blockNone(err_id, 'block');
        blockNone(suc_id, 'none');
    } else {
        $$D(err_id).innerHTML = "";
        obj.className = "err_rte";
        blockNone(err_id, 'none');
        blockNone(suc_id, 'block');
    }
    //else{
    //obj.className = "err_rte";			
    //blockNone(err_id,'none');
    //blockNone(suc_id,'block');
    //}

}

function signupValidation(url, from, fromType, colName, courseId, colId) {
    $$D('signup_button').className += " dis_clk";
    var errorfound = "FALSE";
    var crsStartyear = getradioValue('p_crsstarttyear');
    var pfirstname = $$D("p_first_name");
    var plastname = $$D("p_last_name");
    var pemail = $$D("p_email");
    var ppassword = $$D("p_password");
    var pconfirmpassword = $$D("p_confirm_password");
    var dobday = $$D("p_day");
    var dobMonth = $$D("p_month");
    var dobYear = $$D("p_year");
    //var pcountry = $$D("p_country");
    //var paddr1 =$$D("p_addr1");
    //var paddr2 =$$D("p_addr2");
    //var ptown  =$$D("p_town");
    var ipCheck = $$D("p_ip_check");
    var ppostcode = $$D("p_postcode");
    var pregister = $$D("p_policy_enquiry");
    var ppolicy = "";
    var pregister = "";
    var ppolicyChecked = "";
    var pregisterChecked = "Y";
    //var monthStr = dobMonth.options[dobMonth.selectedIndex].innerHTML;
    var dateValid = "";
    var perror_id = "";
    var str;
    var errorflag = $$D("email_error_found").value;

    if (isEmpty(pfirstname.value)) {
        pfirstname.className = "err_wrg";
        blockNone(pfirstname.id + "_err", 'block');
        blockNone(pfirstname.id + "_suc", 'none');
        errorfound = "TRUE"
        if (perror_id == "") {
            perror_id = pfirstname.id;
        }
    }
    if (isEmpty(plastname.value)) {
        plastname.className = "err_wrg";
        blockNone(plastname.id + "_err", 'block');
        blockNone(plastname.id + "_suc", 'none');
        errorfound = "TRUE"
        if (perror_id == "") {
            perror_id = plastname.id;
        }
    }
    if (isEmpty(pemail.value)) {
        pemail.className = "err_wrg";
        $$D('p_email_err').innerHTML = "We need this so we can send you..well emails obviously.";
        blockNone(pemail.id + "_err", 'block');
        blockNone(pemail.id + "_suc", 'none');
        errorfound = "TRUE"
        if (perror_id == "") {
            perror_id = pemail.id;
        }
    } else {
        if (!isValidEmail(trimString(pemail.value))) {
            pemail.className = "err_wrg";
            $$D('p_email_err').innerHTML = "Something seems to be missing from your email. Awkward.";
            blockNone(pemail.id + "_err", 'block');
            blockNone(pemail.id + "_suc", 'none');
            errorfound = "TRUE"
            if (perror_id == "") {
                perror_id = pemail.id;
            }
        } else {
            if (errorflag == 'Y') {
                errorfound = "TRUE";
                if (perror_id == "") {
                    perror_id = pemail.id;
                }
            } else {
                pemail.className = "err_rte";
                blockNone(pemail.id + "_err", 'none');
                blockNone(pemail.id + "_suc", 'block');
            }
        }
    }
    if (isEmpty(ppassword.value)) {
        ppassword.className = "err_wrg";
        blockNone(ppassword.id + "_err", 'block');
        blockNone(ppassword.id + "_suc", 'none');
        errorfound = "TRUE"
        if (perror_id == "") {
            perror_id = ppassword.id;
        }
    }
    if (!isEmpty(trimString(ppassword.value)) && (ppassword.value).length < 6) {

        ppassword.className = "err_wrg";
        $$D('p_password_err').innerHTML = "Your password should be 6 characters or more.";
        blockNone(ppassword.id + "_err", 'block');
        blockNone(ppassword.id + "_suc", 'none');
        errorfound = "TRUE"
        if (perror_id == "") {
            perror_id = ppassword.id;
        }
    }
    if (isEmpty(pconfirmpassword.value)) {
        pconfirmpassword.className = "err_wrg";
        $$D('p_confirm_password_err').innerHTML = "Stop rotters going into your account.";
        blockNone(pconfirmpassword.id + "_err", 'block');
        blockNone(pconfirmpassword.id + "_suc", 'none');
        errorfound = "TRUE"
        if (perror_id == "") {
            perror_id = pconfirmpassword.id;
        }
    }
    if (!isEmpty(trimString(pconfirmpassword.value)) && (pconfirmpassword.value).length < 6) {
        pconfirmpassword.className = "err_wrg";
        $$D('p_confirm_password_err').innerHTML = "Your confirm password should be 6 characters or more";
        blockNone(pconfirmpassword.id + "_err", 'block');
        blockNone(pconfirmpassword.id + "_suc", 'none');
        errorfound = "TRUE"
        if (perror_id == "") {
            perror_id = pconfirmpassword.id;
        }
    }
    if (ppassword.value != pconfirmpassword.value) {
        pconfirmpassword.className = "err_wrg";
        $$D('p_confirm_password_err').innerHTML = "Your passwords do not match, please try again";
        blockNone(pconfirmpassword.id + "_err", 'block');
        blockNone(pconfirmpassword.id + "_suc", 'none');
        errorfound = "TRUE"
        if (perror_id == "") {
            perror_id = pconfirmpassword.id;
        }
    }
    if (dobday.value == "Day" || dobMonth.value == "Month" || dobYear.value == "Year") {
        errorfound = "TRUE";
        $$D("p_dob_err").innerHTML = "When is your birthday? We've forgotten...";
        $$D('day_field').className = "sbx err_wrg";
        $$D('month_field').className = "sbx err_wrg";
        $$D('year_field').className = "sbx err_wrg";
        blockNone('p_dob_suc', 'none');
        blockNone('p_dob_err', 'block');
        if (perror_id == "") {
            perror_id = "p_day";
        }
    } else {
        dateValid = isValidDOBDate(dobday.value, dobMonth, dobYear.value, monthStr);
        if (dateValid != 'valid') {
            errorfound = "TRUE";
            $$D("p_dob_err").innerHTML = dateValid;
            $$D('day_field').className = "sbx err_wrg";
            $$D('month_field').className = "sbx err_wrg";
            $$D('year_field').className = "sbx err_wrg";
            blockNone('p_dob_suc', 'none');
            blockNone('p_dob_err', 'block');
            if (perror_id == "") {
                perror_id = "p_day";
            }
        } else {
            $$D('day_field').className = "sbx err_rte";
            $$D('month_field').className = "sbx err_rte";
            $$D('year_field').className = "sbx err_rte";
            blockNone('p_dob_suc', 'block');
            blockNone('p_dob_err', 'none');
        }
    }
    /*if(isEmpty(pcountry.value) || pcountry.value == "Please Select"){
		text = pcountry.options[pcountry.selectedIndex].value;
		if(isEmpty(text)){
			$$D('country_field').className = "sbx";
			$('#country_field').toggleClass('err_wrg');
			blockNone("p_country_err",'block');
		}
	}*/

    //if ($('#valid_fieldset').is(":hidden") == true && !isEmpty($$D('p_country').value)){		
    if (isEmpty(ppostcode.value)) {
        ppostcode.className = "err_wrg";
        $$D("p_postcode_err").innerHTML = "We've lost your address, remind us?";
        blockNone(ppostcode.id + "_err", 'block');
        blockNone(ppostcode.id + "_suc", 'none');
        errorfound = "TRUE"
        if (perror_id == "") {
            perror_id = ppostcode.id;
        }
    } else {
        //if (pcountry.value== '55' || pcountry.value== '139' || pcountry.value== '256' || pcountry.value== '257'){
        if (ipCheck.value == 'Y') {
            if (!isValidUKpostcode(ppostcode.value)) {
                ppostcode.className = "err_wrg";
                $$D("p_postcode_err").innerHTML = "Please enter valid postcode";
                blockNone(ppostcode.id + "_err", 'block');
                blockNone(ppostcode.id + "_suc", 'none');
                errorfound = "TRUE"
                if (perror_id == "") {
                    perror_id = ppostcode.id;
                }
            } else {
                ppostcode.className = "err_rte";
                blockNone(ppostcode.id + "_err", 'none');
                blockNone(ppostcode.id + "_suc", 'block');
            }
        } else {
            ppostcode.className = "err_rte";
            blockNone(ppostcode.id + "_err", 'none');
            blockNone(ppostcode.id + "_suc", 'block');
        }
    }
    //}		

    if ($$D("p_policy_enquiry")) {
        ppolicy = $$D("p_policy_enquiry");
        blockNone("p_policy_enquiry_err", "none");
        ppolicyChecked = ppolicy.checked;
        if (ppolicy.checked == false) {
            blockNone("p_policy_enquiry_err", "block");
            errorfound = "TRUE";
            if (perror_id == "") {
                perror_id = "p_policy_enquiry";
            }
        }
    }
    if (errorfound == "FALSE") {
        if ($$D("p_rem")) {
            prem = $$D("p_rem");
            premChecked = prem.checked;
        }
        var strSend = "p_first_name=" + trimString($$D("p_first_name").value) +
            "&p_last_name=" + trimString($$D("p_last_name").value) +
            "&p_email=" + trimString($$D("p_email").value) +
            "&p_crsstarttyear=" + getradioValue('p_crsstarttyear') +
            "&p_day=" + $$D("p_day").value +
            "&p_month=" + $$D("p_month").value +
            "&p_year=" + $$D("p_year").value
            //+"&p_country="+$$D("p_country").value
            //+"&p_addr1="+encodeURIComponent(trimString($$D("p_addr1").value))				     
            //+"&p_town="+encodeURIComponent(trimString($$D("p_town").value))					
            +
            "&p_postcode=" + trimString(ppostcode.value) +
            "&p_policy_enquiry=" + $$D("p_policy_enquiry").value +
            "&p_register=" + pregisterChecked +
            "&p_rem=" + $$D("p_rem").value +
            "&p_url=" + url +
            "&p_from=" + from;

        //if(!(isEmpty($$D('p_addr2').value))){strSend = strSend +"&p_addr2="+encodeURIComponent(trimString($$D("p_addr2").value));}
        var password = trimString($$D("p_password").value);
	    var conf_password = trimString($$D("p_confirm_password").value);
    	var ajaxURL = CommonObjects.pgs_context_path + "/pgs_user.do_register_new?" + strSend;
        var ajax = new sack();
        ajax.requestFile = ajaxURL;
        loader(ajax.xmlhttp.readyState);
		ajax.setVar("p_password",password );
        ajax.setVar("p_confirm_password",password );
        ajax.onCompletion = function () {
            registrationComplete(ajax, fromType, colName, courseId, colId);
        }; // function(){document.location.reload(true);};
        ajax.runAJAX();
        return false;
    } else {
        $$D(perror_id).focus();
        $$D('signup_button').className = "nwbtn nwgrn_btn";
    }
    return false;
}


function loader(obj) {
    if (obj != 4) {
        //document.getElementById('load').style.visibility="visible";
        blockNone('load', 'block');
    } else if (obj == 4) {
        //document.getElementById('load').style.visibility="hidden";
        blockNone('load', 'none');
    }
}

function showSrtCrs(assoc_id, page) {
    var clName;
    if (page == "search") {
        clName = "cmp_cnr";
    } else {
        clName = "adsh";
    }
    if ($$D("bskt" + assoc_id).className == clName) {
        $$D("addremId" + assoc_id).innerHTML = "Add to Shortlist";
        $$D("show" + assoc_id).style.display = "block";
    }
}

function hideSrtCrs(assoc_id) {
    $$D("show" + assoc_id).style.display = "none";
}

function pdfRedirect(colId, courseId, colName, from) {
    var pdfType = 'college';
    var pdfurl = "/pgs/get_pdf_prc?";
    pdfurl = pdfurl + "p_college_id=" + colId;
    if (courseId != null && courseId != "") {
        pdfurl = pdfurl + "&p_course_id=" + courseId;
        pdfType = 'course';
    }
    var wish = new sack();
    wish.requestFile = pdfurl;
    wish.onCompletion = function () {
        pdfComplete(wish, colId, courseId, pdfType, from);
        GAInteractionEventTracking('emailsubmit', 'NonAdvertiserPdf', 'Email-Submit', colName, 1);
    };
    wish.runAJAX();
}

function pdfComplete(obj, colId, courseId, pdfType, from) {
    var l_width = screen.width;
    var downloadUrl = '/pgs/pdf_download_prc?p_college_id=' + colId;
    var status;
    if (courseId != null && courseId != "") {
        downloadUrl = downloadUrl + "&p_course_id=" + courseId;
    }
    downloadUrl = downloadUrl + '&p_pdf_type=' + pdfType;
	downloadUrl = downloadUrl + '&p_screen_width=' + l_width;
    if (trimString(obj.response) == 'SUCCESS') {
        window.open(downloadUrl, '_blank');
        status = "complete";
    }
    if (status == 'complete') {
        showPGSLightBox('download_success', 665, 520, 'p_from=' + from);
    }
}

function fillTextBox(obj) {
    var text = obj.id;
	var actualdiv = document.getElementsByClassName("optionDivSelected");
	var divid = (document.getElementsByClassName("optionDivSelected") && actualdiv.length>0) ? actualdiv[0].id:"";
  document.getElementById("result_hidden").value = text;
    if ($("body *").is('#qual_page_hidden_ga'))	{
	var qual = $$D("qual_page_hidden_ga").value +' search';
	if(divid.indexOf("$$C") >= 0){
		GAInteractionEventTracking('topsearch', 'Search', qual + ' | subject' , text.toLowerCase(), "");}
	else if(divid.indexOf("$$U") >= 0){
		GAInteractionEventTracking('topsearch', 'Search', qual + ' | institution', text.toLowerCase(), "");}
	/*else{ GAInteractionEventTracking('topsearch', 'Search', qual, text.toLowerCase(), ""); }*/
	} 
	if ($("body *").is('#home_page_ga')){
	var Ssearch = $$D("home_page_ga").value;
	var  qual_hidden = trimString($$D("qual_hidden").value);
	 bqual = qual_hidden.split("$$Q");
	if (divid.indexOf("$$C") >= 0 && qual_hidden != ""){
	GAInteractionEventTracking('topsearch',  'Search' , captialStr(bqual[0]) + ' search | subject', text.toLowerCase(), "");
	}
	else if (divid.indexOf("$$C") >= 0){
	GAInteractionEventTracking('topsearch',  'Search' , Ssearch + ' | subject', text.toLowerCase(), "");
	}
	else if (divid.indexOf("$$U") >= 0 && qual_hidden != ""){
	GAInteractionEventTracking('topsearch',  'Search' , captialStr(bqual[0]) + ' search | institution', text.toLowerCase(), "");
	}
	else if (divid.indexOf("$$U") >= 0){
	GAInteractionEventTracking('topsearch',  'Search' , Ssearch + ' | institution', text.toLowerCase(), "");
	}
	else if (divid.indexOf("$$A") >= 0 && qual_hidden != ""){
	GAInteractionEventTracking('topsearch',  'Search' , captialStr(bqual[0]) + ' search | Article', text.toLowerCase(), "");
	}
	else if (divid.indexOf("$$A") >= 0){
	GAInteractionEventTracking('topsearch',  'Search' , Ssearch + ' | Article', text.toLowerCase(), "");
	}
	else if (qual_hidden != "" && text !=""){
	GAInteractionEventTracking('topsearch',  'Search' , captialStr(bqual[0]) + ' search', text.toLowerCase(), "");
	}
	/*else {
	GAInteractionEventTracking('topsearch',  'Search' , Ssearch , text.toLowerCase(), "");
	};*/}
	if ($("body *").is('#ga_event'))	{
	var Ssearch = $$D("ga_event").value;
	var subject_value = $("#result_hidden").val();
	if (divid.indexOf("$$C") >= 0){
	divid = divid.replace("$$C", "");
	var spanid = divid + 'list';
	spanid = trimString(spanid);
	var spancontent = document.getElementById(spanid).innerHTML;
	GAInteractionEventTracking('topsearch',  'Search' , Ssearch + ' | subject', spancontent.toLowerCase(), "");
	}
	else if (divid.indexOf("$$U") >= 0){
	divid = divid.replace("$$U", "");
	var spanid = divid + 'list';
	spanid = trimString(spanid);
	var spancontent = document.getElementById(spanid).innerHTML;
	GAInteractionEventTracking('topsearch',  'Search' , Ssearch + ' | institution', spancontent.toLowerCase(), "");
	}
	else if (divid.indexOf("$$A") >= 0){
	divid = divid.replace("$$A", "");
	var spanid = divid + 'list';
	spanid = trimString(spanid);
	var spancontent = document.getElementById(spanid).innerHTML;
	GAInteractionEventTracking('topsearch',  'Search' , Ssearch + ' | Article', spancontent.toLowerCase(), "");
	}
	else {
	var spanid = divid + 'list';
	spanid = trimString(spanid);
	var spancontent = document.getElementById(spanid).innerHTML;
	GAInteractionEventTracking('topsearch',  'Search' , Ssearch , spancontent.toLowerCase(), "");
	};
 }
};

$(document).ready(function () {
    $("#keyword_hidden").change(function () {
        var keyword_hidden_value = $("#keyword_hidden").val();
        if (trimString(keyword_hidden_value) == "title") {
            var search_keyword = $("#search_keyword_hidden").val()
            $$D("keyword").value = search_keyword;
        } else {
            var subject_value = $("#result_hidden").val();
            var actualdiv = document.getElementsByClassName("optionDivSelected");
            var divid = actualdiv[0].id;
            divid = divid.replace("$$C", "");
            divid = divid.replace("$$Q", "");
            divid = divid.replace("$$U", "");
            divid = divid.replace("$$A", "");
            var spanid = divid + 'list';
            spanid = trimString(spanid);
            var spancontent = document.getElementById(spanid).innerHTML;
            spancontent = spancontent.replace("&amp;", "&");
            if (spancontent != "") {
                $$D("keyword").value = spancontent;
            }
        }
    });
});

function HomeSearchPrevalidate(gaqual) {   
   if (uniProfileFlag == "Y" || gaqual == 'funding' ) {
       if (gaqual == 'funding') {
            var flag = validateHomeSearch('Y', 'funding', gaqual);
            if (!flag) {
                return false;
            }
        }
    }  
    else if (uniProfileFlag == "N") {
        if (unsavedMail == false) {		    
			if (gaqual == 'channel_home'){var flag = validateHomeSearch('N', 'channel_home', gaqual); }
			else{var flag = validateHomeSearch('N', 'home', gaqual);}              
            if (!flag) {
                return false;
            }
        } else {
            if ($$D("mail_a_href")) {
                $$D("mail_a_href").value = 'FILTER';
                showPGSLightBox('my_profile_alert', '665', '520', '');
            }
        }
    }
};


function univerprofileurl() {
    $("#keyword_hidden").change(function () {
        var colId = document.getElementById(ajax_list_activeInput.name + '_hidden').value;
        var unicount = colId.indexOf("$$U");
        //if (unicount > 0){}
        if (unsavedMail == false) {
            univerprofileNewUrl()
        } else {
            if ($$D("mail_a_href") && unicount > 0) {
                $$D("mail_a_href").value = 'QUAL';
                showPGSLightBox('my_profile_alert', '665', '520', '');
            }
        }
    });
};

var uniProfileFlag = "N";


function univerprofileNewUrl() {
    var colId = document.getElementById(ajax_list_activeInput.name + '_hidden').value;
    var unicount = colId.indexOf("$$U");
	if ($("body *").is('#home_page_ga'))	{
	var home_ga = $$D("home_page_ga").value + ' | institution';
	}
    if (unicount > 0) {
        uniProfileFlag = "Y";
        var a = colId.split("$$U");
        var ajaxURL = CommonObjects.pgs_context_path + "/pgs_browse.provider_url_prc?p_college_id=" + a[1];
        var unipro = new sack();
        unipro.requestFile = ajaxURL;
        unipro.onCompletion = function () {
            univprofileurlComplete(unipro)
        };
        unipro.runAJAX();
		 if (event.keyCode === 13) {
            if (home_ga != "" && home_ga != null) {
		     GAInteractionEventTracking('', home_ga, 'Search', a[2].toLowerCase(), '');
		   }
        }
    }
};

function univerprofileurlfunding() {
    $("#keyword_hidden").change(function () {
        var colId = document.getElementById(ajax_list_activeInput.name + '_hidden').value;
        var unicount = colId.indexOf("$$U");
        //if (unicount > 0){}
		//alert('sounadriya2333');
        if (unsavedMail == false) {
            univerprofileurlfundingnew()
        } else {
            if ($$D("mail_a_href") && unicount > 0) {
                $$D("mail_a_href").value = 'QUAL';
                showPGSLightBox('my_profile_alert', '665', '520', '');
            }
        }
    });
};

function univerprofileurlfundingnew() {
    var colId = document.getElementById(ajax_list_activeInput.name + '_hidden').value;
    var unicount = colId.indexOf("$$U");
    if (unicount > 0) {
        uniProfileFlag = "Y";
        var a = colId.split("$$U");
		var ajaxURL = CommonObjects.pgs_context_path + "/pgs_browse.sch_provider_url_prc?p_college_id=" + a [1];
        var unipro = new sack();
        unipro.requestFile = ajaxURL;
        unipro.onCompletion = function () {
            univprofileurlComplete(unipro)
        };
		//GAInteractionEventTracking('','Scholarship search', 'Search', a[2].toLowerCase(), '');
        unipro.runAJAX();
    }
};

function univprofileurlComplete(unipro) {
    var response = trimString(unipro.response);
    uniProfileFlag = "N";
    //window.location.href = CommonObjects.pgs_context_path+response;   //commented PGS_20160929
    window.location.href = response; // newly introduced PGS_20160929
    return false;
};

function setBorderTxtBx(obj) {
    var suc_id = obj.id + "_sucmsg";
    var err_id = obj.id + "_errmsg";
    var cpc;
    var ipFlag;
    var dobDate = $$D("p_date");
    var dobMonth = $$D("p_month");
    var dobYear = $$D("p_year");
    var d = new Date();
    var yr = d.getFullYear();
    var startYr = yr - 101;
    var endYr = yr - 17;
	var ppassword = $$D("pass");
	blockNone(err_id, 'none');
    blockNone(suc_id, 'none');
	obj.className = "";

	if (obj.id == "pass") {
            $$D(err_id).innerHTML = "This is awkward, what''s your password?";
			blockNone(err_id, 'block');
        }
    if ($$D("ipflag")) {
        ipFlag = $$D("ipflag");
    }
    if (isEmpty(trimString(obj.value)) && obj.id != "p_enqpc") {
        obj.className = "adiptxt err_wrg";
        if (obj.id == "p_email") {
            $$D(err_id).innerHTML = "We need this so we can send you..well emails obviously.";
        }
        if (obj.id == "p_enqpc") {
            $$D(err_id).innerHTML = "Please enter the postcode";
        }
        blockNone(err_id, 'block');
        //blockNone(suc_id, 'none');
    } else {
        if (obj.id == "p_email" || obj.id == "pm_email") {
										setTimeout(function(){ 
            if (!isValidEmail(trimString(obj.value))) {
                if (obj.id == "p_email") {
                    obj.className = "adiptxt err_wrg";
                    $$D(err_id).innerHTML = "Something seems to be missing from your email. Awkward.";
                } else {
                    obj.className = "adiptxt err_wrg";
                    $$D(err_id).innerHTML = "Please enter a valid email address";
                }
                blockNone(err_id, 'block');
              //  blockNone(suc_id, 'none');
            } else {
                if (obj.id == "p_email") {
                    var wish = new sack();
                    var signin = "javascript:newPgsLbx('signin','');";
                    wish.requestFile = CommonObjects.pgs_context_path + "/pgs_interactive.check_email_exist_prc?p_email=" + obj.value;
                    wish.onCompletion = function () {
                        if (trimString(wish.response) == "Y") {
                            obj.className = "adiptxt err_wrg";
                            $$D(err_id).innerHTML = 'The email address ' + obj.value + ' is already registered with us, please <a href="' + signin + '">sign in</a>. This is to protect your personal data';
                            blockNone(err_id, 'block');
                           // blockNone(suc_id, 'none');
                            $$D("alEmailExists").value = "Y";
                        } else {
                            obj.className = "adiptxt err_rte";
                           // blockNone(err_id, 'none');
                            blockNone(suc_id, 'block');
                            $$D("alEmailExists").value = "N";
                        }
                    };
                    wish.runAJAX();
                } else {
                    obj.className = "adiptxt err_rte";
                   // blockNone(err_id, 'none');
                    blockNone(suc_id, 'block');
                }
                /*check_email_validation(obj,err_id);*/
            }
							}, 30);
        } else if (obj.id == "p_enqpc") {
            if (ipFlag.value == 'Y') {
                cpc = isValidUKpostcode(obj.value);
                blockNone('p_enqpc_errmsg', 'none');
                blockNone("p_enqpc_sucmsg", 'none');
                if (cpc) {
                    obj.className = "adiptxt err_rte";
                    blockNone('p_enqpc_errmsg', 'none');
                    blockNone("p_enqpc_sucmsg", 'block');
                } else {
                    obj.className = "adiptxt err_wrg";
                    $$D("p_enqpc_errmsg").innerHTML = "Please enter valid postcode";
                    blockNone('p_enqpc_errmsg', 'block');
                    blockNone("p_enqpc_sucmsg", 'none');
                }
            }
            //else { obj.className = "adiptxt err_rte";blockNone('p_enqpc_errmsg','none');blockNone("p_enqpc_sucmsg",'block'); } 			
        } else if (obj.id == "p_date" || obj.id == "p_month" || obj.id == "p_year") {
            var dateValid;
            dobDate.className = "adiptxt";
            dobMonth.className = "adiptxt";
            dobYear.className = "adiptxt";
            blockNone('p_dob_errmsg', 'none');
            blockNone('p_dob_sucmsg', 'none');
            if (!isNumeric(dobDate.value) && dobDate.value != "") {
                dateValid = "Please enter your date of birth in numerical value only";
                $$D("p_dob_errmsg").innerHTML = dateValid;
                blockNone('p_dob_errmsg', 'block');
                dobDate.className = "adiptxt err_wrg";
                dobMonth.className = "adiptxt err_wrg";
                dobYear.className = "adiptxt err_wrg";
                return dateValid;
            } else if ((dobDate.value < 1 || dobDate.value > 31) && dobDate.value != "") {
                dateValid = "Day must be between 1 and 31.";
                $$D("p_dob_errmsg").innerHTML = dateValid;
                blockNone('p_dob_errmsg', 'block');
                dobDate.className = "adiptxt err_wrg";
                dobMonth.className = "adiptxt err_wrg";
                dobYear.className = "adiptxt err_wrg";
                return dateValid;
            } else if (!isNumeric(dobMonth.value) && dobMonth.value != "") {
                dateValid = "Please enter your date of birth in numerical value only";
                $$D("p_dob_errmsg").innerHTML = dateValid;
                blockNone('p_dob_errmsg', 'block');
                dobDate.className = "adiptxt err_wrg";
                dobMonth.className = "adiptxt err_wrg";
                dobYear.className = "adiptxt err_wrg";
                return dateValid;
            } else if ((dobMonth.value < 1 || dobMonth.value > 12) && dobMonth.value != "") {
                dateValid = "Month must be between 1 and 12.";
                $$D("p_dob_errmsg").innerHTML = dateValid;
                blockNone('p_dob_errmsg', 'block');
                dobDate.className = "adiptxt err_wrg";
                dobMonth.className = "adiptxt err_wrg";
                dobYear.className = "adiptxt err_wrg";
                return dateValid;
            } else if (!isNumeric(dobYear.value) && dobYear.value != "") {
                dateValid = "Please enter your date of birth in numerical value only";
                $$D("p_dob_errmsg").innerHTML = dateValid;
                blockNone('p_dob_errmsg', 'block');
                dobDate.className = "adiptxt err_wrg";
                dobMonth.className = "adiptxt err_wrg";
                dobYear.className = "adiptxt err_wrg";
                return dateValid;
            } else if ((dobYear.value <= startYr || dobYear.value >= endYr) && dobYear.value != "") {
                if (dobYear.value <= startYr) {
                    dateValid = "Year must be greater than " + startYr;
                }
                if (dobYear.value >= endYr) {
                    dateValid = "You must be at least 17 years old in order to study for a Postgraduate level course";
                }
                $$D("p_dob_errmsg").innerHTML = dateValid;
                blockNone('p_dob_errmsg', 'block');
                dobDate.className = "adiptxt err_wrg";
                dobMonth.className = "adiptxt err_wrg";
                dobYear.className = "adiptxt err_wrg";
                return dateValid;
            } else {
                blockNone('p_dob_errmsg', 'none');
                blockNone("p_dob_sucmsg", 'none');
                dobDate.className = "adiptxt";
                dobMonth.className = "adiptxt";
                dobYear.className = "adiptxt";
            }
            if (dobDate.value != "" && dobMonth.value != "" && dobYear.value != "") {
                dateValid = isValidDOBDate(dobDate.value, dobMonth.value, dobYear.value, '');
                if (dateValid != 'valid') {
                    $$D("p_dob_errmsg").innerHTML = dateValid;
                    blockNone("p_dob_sucmsg", 'none');
                    blockNone('p_dob_errmsg', 'block');
                    dobDate.className = "adiptxt err_wrg";
                    dobMonth.className = "adiptxt err_wrg";
                    dobYear.className = "adiptxt err_wrg";
                    return dateValid;
                } else {
                    blockNone('p_dob_errmsg', 'none');
                    blockNone("p_dob_sucmsg", 'block');
                    dobDate.className = "adiptxt err_rte";
                    dobMonth.className = "adiptxt err_rte";
                    dobYear.className = "adiptxt err_rte";
                    return dateValid;
                }
            }
        } else {
            obj.className = "adiptxt err_rte";
            blockNone(err_id, 'none');
            blockNone(suc_id, 'block');
        }
    }
}

function isNumeric(input) {
    return (input - 0) == input && ('' + input).replace(/^\s+|\s+$/g, "").length > 0;
}

function submitSignin(obj) {
    var errorfound = "FALSE";
    var redirect_url;
    var personal_note = "";
    var w = $$D('w').value;
    var z = $$D('z').value;
    var clgName = $$D('clgName').value;
    var fromType = $$D('p_from_type').value;
    var lbxType = $$D('p_lbx_type').value;
	
    if ($$D("redirect_url")) {
        redirect_url = encodeURIComponent(trimString($$D("redirect_url").value));
    }
    if ($$D("p_from_page")) {
        var page = $$D("p_from_page").value;
    }
    if ($$D("p_bur_subject")) {
        var p_subject = $$D("p_bur_subject").value;
    }
    if ($$D("p_from")) {
        var page1 = $$D("p_from").value;
    } else {
        page = '';
    }
    if ($$D("p_personal_note")) {
        personal_note = encodeURIComponent($$D("p_personal_note").value);
    }
    var pemail = $$D("pm_email");	
	//var yoeAjaxURL = CommonObjects.pgs_context_path + "/get_user_yoe_prc?p_email="+pemail.value;
	//var yoeAjaxURL = new sack();
	//yoeAjaxURL.requestFile = yoeAjaxURL;
	
	//setCookie('PGS_YOE',yoe, '', '/', '', '');
    pemail.className = "adiptxt";
    var prem = $$D("p_rem");
    if (isEmpty(pemail.value)) {
        pemail.className = "adiptxt err_wrg";
        errorfound = "TRUE";
        $$D("pm_email_errmsg").innerHTML = ErrorMessage.error_empty_email;
        blockNone("pm_email_errmsg", "block");
    } else if (!isValidEmail(trimString(pemail.value))) {
        pemail.className = "adiptxt err_wrg";
        errorfound = "TRUE";
        $$D("pm_email_errmsg").innerHTML = "Please enter a valid email address";
        blockNone("pm_email_errmsg", "block");
    }
    var ppassw = $$D("pm_passw");
    var ppassw_hidden = $$D("pm_passw_hidden");
    blockNone("pm_passw_errmsg", "none");
    ppassw.className = "adiptxt";
    if (isEmpty(ppassw.value)) {
        ppassw.className = "adiptxt err_wrg";
        errorfound = "TRUE";
        $$D("pm_passw_errmsg").innerHTML = ErrorMessage.error_empty_passw;
        blockNone("pm_passw_errmsg", "block");
    }
    if (errorfound == "FALSE") {
        var strSend = "pm_email=" + pemail.value + "&pm_passw=" + encodeURIComponent(ppassw.value) + "&z=" + $$D("z").value + "&w=" + $$D("w").value + "&p_order_item=" + $$D("p_order_item_id").value + "&p_from=" + $$D("p_from").value + "&p_from_page=" + page + "&p_url=" + redirect_url + "&p_personal_note=" + personal_note + "&p_bur_subject=" + p_subject + "&p_lbx_type=" + lbxType;

        var ajaxURL = CommonObjects.pgs_context_path + "/pgs_user.do_login_lbx?" ;
        var ajax = new sack();
		ajax.setVar("pm_email", trimString(pemail.value));
		ajax.setVar("pm_passw", encodeURIComponent(ppassw.value));
		ajax.setVar("z", $$D("z").value);
		ajax.setVar("w", $$D("w").value);
		ajax.setVar("p_order_item", $$D("p_order_item_id").value);
		ajax.setVar("p_from", $$D("p_from").value);
		ajax.setVar("p_from_page", page);
		ajax.setVar("p_url", redirect_url);
		ajax.setVar("p_personal_note", personal_note);
		ajax.setVar("p_bur_subject", p_subject);
		ajax.setVar("p_lbx_type", lbxType);
        if (prem.checked) {
		ajax.setVar("p_rem", "Y");
        } else {
		ajax.setVar("p_rem", "N");
        }
        ajax.requestFile = ajaxURL;
        ajax.onCompletion = function () {
            signinResponse(ajax, '');
        };
        ajax.runAJAX();
        return false;
        showPGSLightBox('login-submit', '650', '350', strSend);
    }
    return false;
}

function signinResponse(ajax, page) {
    var response = ajax.response.split(CommonObjects.split_char);
    var redirect_url;
    var screenWidth = jqueryWidth();
	var yoe = response[2];
    if (trimString(response[0]) == 'SUCCESS') {
        if (response[1] != null && response[1] != ' ') {
            eval(response[1]);
        }
        if ((screenWidth > 992 || ($("#ol").is(':visible'))) && page != "" && page == "CP") {
            window.location.assign(pgs_domain);
        } else if (screenWidth > 992 || ($("#ol").is(':visible'))) {
            closeLightbxContinue();
        } else {
            if ($$D("redirect_url")) {
                redirect_url = encodeURIComponent(trimString($$D("redirect_url").value));
                window.location.href = decodeURIComponent(redirect_url);
            }
        }
    } else {
        $$D("ajax-div").style.display = "none";
        if (trimString(response[0]) == "LOCKED") {
            if ($$D("newlbx")) {
                $$D("newlbx").innerHTML = "";
                blockNone('newlbx', 'none');
            }
            if ($$D("mbox")) {
                document.getElementById("mbox").style.top = (window.pageYOffset + 40) + "px";
                $$D("mbd").innerHTML = response[1];
                $$D("mbox").className = "mbox1";
                $$D("mbox").style.display = "block";
            }
        } else {
            $$D("newlbx").innerHTML = ajax.response;
            blockNone('newlbx', 'block');
            $$D("lbxInner").style.top = (window.pageYOffset + 40) + "px";
            eval($$D('txtbxeffect').innerHTML);
            //$$D("newvenueform").style.display = "block";
            var elements = $("script[id^='iterate']");
            if (elements.length > 0) {
                for (var i = 1; i <= elements.length; i++) {
                    eval($$D('iterate' + i).innerHTML);
                }
            }
        }
    }
	if($$D('domnScptId')){ 		
   eval($$D("domnScptId").innerHTML);   
   }
   if (response[2] != null && response[2] != ' ')
   {
	setCookie('PGS_YOE',yoe, '', '/', '', '');
   }
}

function openalertbox() {
    blockNone("alertbox", "block");
    blockNone("screeningdiv", "block");
}

function staypage() {
    blockNone("alertbox", "none");
    blockNone("screeningdiv", "none");
}

function leavepage() {
    blockNone("alertbox", "none");
    blockNone("screeningdiv", "none");
    hm();
};


/**********signup form validation *******/ //PGS_20160628

function signupformvalidation(url, from, fromType, colName, courseId, colId) {
    $$D('signup_button').className += " dis_clk";
    var errorfound = "FALSE";
    var crsStartyear = getradioValue('p_crsstarttyear');
    var pfirstname = $$D("p_name");
    var plastname = $$D("p_surname");
    var pemail = $$D("p_email");
    var ppassword = $$D("p_password");
    var dobday = $$D("p_date");
    var dobMonth = $$D("p_month");
    var dobYear = $$D("p_year");
    var ppostcode = $$D("p_enqpc2");
    var perror_id = "";
    var ipFlag = $$D("ipflag");
    var marketing_flag = $$D("market").value;
	var souls_flag = $$D("solus").value;
	var survey_flag = $$D("survey").value;
	var receive_no_flag = 'N';
	setCookie('PGS_YOE',crsStartyear, '', '/', '', '');
    if (isEmpty(pfirstname.value)) {
        pfirstname.className = "adiptxt err_wrg";
        errorfound = "TRUE";
        blockNone("p_name_errmsg", "block");
        if (perror_id == "") {
            perror_id = pfirstname.id;
        }
    } else {
        pfirstname.className = "adiptxt err_rte";
        blockNone("p_name_sucmsg", "block");
    }

    if (isEmpty(plastname.value)) {
        plastname.className = "adiptxt err_wrg";
        errorfound = "TRUE";
        if (perror_id == "") {
            perror_id = plastname.id;
        }
        blockNone("p_surname_errmsg", "block");
    } else {
        plastname.className = "adiptxt err_rte";
        blockNone("p_surname_errmsg", "none");
    }
    if (isEmpty(pemail.value)) {
        pemail.className = "adiptxt err_wrg";
        errorfound = "TRUE";
        $$D("p_email_errmsg").innerHTML = "We need this so we can send you..well emails obviously.";
        blockNone("p_email_errmsg", "block");
        if (perror_id == "") {
            perror_id = pemail.id;
        }
    } else {
        if (!isValidEmail(trimString(pemail.value))) {
            pemail.className = "adiptxt err_wrg";
            errorfound = "TRUE";
            $$D("p_email_errmsg").innerHTML = "Something seems to be missing from your email. Awkward.";
            blockNone("p_email_errmsg", 'block');
            if (perror_id == "") {
                perror_id = pemail.id;
            }
        } //else if ($$D("alEmailExists").value == "Y") {
          //  pemail.className = "adiptxt err_wrg";
         //   errorfound = "TRUE"
		//	 if (perror_id == "") {
         //       perror_id = pemail.id;
        //   }
       // }
    }
	
	  if (isEmpty(ppassword.value)) {
        ppassword.className = "adiptxt err_wrg";
        $$D("p_password_errmsg").innerHTML = "This is awkward, what's your password?";
        blockNone("p_password_errmsg","block");
        errorfound = "TRUE"
        if (perror_id == "") {
            perror_id = ppassword.id;
        }
    }
	
    if (!isEmpty(trimString(ppassword.value)) && (ppassword.value).length < 6) {
        ppassword.className = "adiptxt err_wrg";
        $$D('p_password_errmsg').innerHTML = "Your password should be 6 characters or more.";
        blockNone(ppassword.id + "_errmsg", 'block');
        blockNone(ppassword.id + "_sucmsg", 'none');
        errorfound = "TRUE"
        if (perror_id == "") {
            perror_id = ppassword.id;
        }
	   else {
        ppassword.className = "adiptxt err_rte";
        blockNone("p_password_sucmsg", "block");
       }
    }
	
    /*if (isEmpty(ppostcode.value)) {
        ppostcode.className = "adiptxt err_wrg";
        errorfound = "TRUE";
        $$D("p_enqpc_errmsg").innerHTML = "Please enter the postcode";
        blockNone("p_enqpc_errmsg", "block");
        blockNone("p_enqpc_sucmsg", "none");
        if (perror_id == "") {
            perror_id = ppostcode.id;
        }
    } else {
        if (ipFlag.value == 'Y') {
            cpc = isValidUKpostcode(ppostcode.value);
            if (cpc) {
                ppostcode.className = "adiptxt err_rte";
            } else {
                errorfound = "TRUE";
                ppostcode.className = "adiptxt err_wrg";
                $$D("p_enqpc_errmsg").innerHTML = "Please enter valid postcode";
                blockNone("p_enqpc_errmsg", "block");
                blockNone("p_enqpc_sucmsg", "none");
                if (perror_id == "") {
                    perror_id = ppostcode.id;
                }
            }
        } else {
            ppostcode.className = "adiptxt err_rte";
            blockNone("p_enqpc_errmsg", "none");
            blockNone("p_enqpc_sucmsg", "block");
        }
    }*/
  if ($$D("p_policy_enquiry")) {
        ppolicy = $$D("p_policy_enquiry");
        blockNone("p_policy_enquiry_err", "none");
        ppolicyChecked = ppolicy.checked;
        if (ppolicy.checked == false) {
            blockNone("p_policy_enquiry_err", "block");
            errorfound = "TRUE";
            if (perror_id == "") {
                perror_id = "p_policy_enquiry";
            }
        }
    }
	
	if (marketing_flag == 'true') {
         marketing_flag = 'Y';
    }
     if (souls_flag == 'true') {
         souls_flag = 'Y';
    }
     if (survey_flag == 'true') {
         survey_flag = 'Y';
    }
    if (errorfound == "FALSE") {
var strSend = "p_first_name=" + trimString($$D("p_name").value) +
            "&p_last_name=" + trimString($$D("p_surname").value) +
            "&p_email=" + trimString($$D("p_email").value) +
            "&p_crsstarttyear=" + getradioValue('p_crsstarttyear') +
            "&p_postcode=" + trimString($$D("p_enqpc2").value) +
			"&p_policy_enquiry=" + $$D("p_policy_enquiry").value +
            "&p_url=" + url +
            "&p_from=" + from +
			"&p_marketing_flag=" + marketing_flag +
			"&p_souls_flag=" + souls_flag +
			"&p_survey_flag=" + survey_flag +
			"&p_receive_flag=" + receive_no_flag;
			
	    var password = trimString($$D("p_password").value);
        var ajaxURL = CommonObjects.pgs_context_path + "/pgs_user.do_register_new?";
        var ajax = new sack();
		ajax.setVar("p_first_name", trimString($$D("p_name").value));
		ajax.setVar("p_last_name", trimString($$D("p_surname").value));
		ajax.setVar("p_email", trimString($$D("p_email").value) );
		ajax.setVar("p_crsstarttyear", getradioValue('p_crsstarttyear'));
		ajax.setVar("p_postcode", trimString($$D("p_enqpc2").value));
		ajax.setVar("p_policy_enquiry", $$D("p_policy_enquiry").value);
		//ajax.setVar("p_from_page", page);
		ajax.setVar("p_url", url);
		ajax.setVar("p_marketing_flag", marketing_flag);
		ajax.setVar("p_souls_flag", souls_flag);
		ajax.setVar("p_survey_flag", survey_flag);
		ajax.setVar("p_receive_flag", receive_no_flag);
        ajax.requestFile = ajaxURL;
        loader(ajax.xmlhttp.readyState);
		ajax.setVar("p_password",encodeURIComponent(password) );		
        ajax.onCompletion = function () {
			//alert(ajax.response);
            if (trimString(ajax.response) != "EMAIL EXISTS TEST")
			{   
				registrationComplete(ajax, fromType, colName, courseId, colId);}
				else{
					setBorderTxtBx1(p_email);
				//	$$D('signup_button').className += " dis_clk";
					 $("#signup_button").removeClass(" dis_clk");
				}
        };
        ajax.runAJAX();
        return false;
    } else {
         $$D(perror_id).focus();
		 $$D('signup_button').className = "nwbtn nwgrn_btn";
    }
   return false;
}


function registrationComplete(obj, fromType, colName, courseId, colId) {
    var type = obj.response;
    var res;
    var url = pgs_domain + '/register';
    setCookie('pgs_usertype', 'returnuser', '', '/', '', '');
    if (fromType == 'pdf') {
        //pdfurl=pdfurl+courseId;
        //window.open(pdfurl,'_blank');				
        pdfRedirect(colId, courseId, colName, 'register');
        GAInteractionEventTracking('register', 'register', 'non-advertiser-pdf', colName, '1');
        GAInsightEventTracking(colId, courseId, 'PDF');
        //return true;
    } else if (fromType == 'amp') {
        GAInteractionEventTracking('sent', 'register', 'amp-page', url);
    } else {
        GAInteractionEventTracking('register', 'register', type, '', '');
    }
    loader(obj.xmlhttp.readyState);
    closeLightbxContinue();
}



/**********signupRegisterComplete*******/ //PGS_20160628

function signupRegisterComplete(obj, fromType, colName, courseId, colId) {
    var type = obj.response;
    var res;
    GAInteractionEventTracking('register', 'register', type, '', '');
    loader(obj.xmlhttp.readyState);
    closeLightbxContinue();
}

/**********setBorderpassword*******/ //PGS_20160628

function setBorderpassword(obj) {
    var ppassword = $$D("p_password");
    var errorfound = "FALSE";
    var perror_id = "";
    if (isEmpty(ppassword.value)) {
        ppassword.className = "adiptxt err_wrg";
        errorfound = "TRUE";
        blockNone("p_password_errmsg", "block");
        if (perror_id == "") {
            perror_id = ppassword.id;
        }
    } else {
        ppassword.className = "adiptxt err_rte";
        errorfound = "FALSE";
        blockNone("p_password_errmsg", "none");
    }
}

/**********toggle_password*******/ //  PGS_20160628

function toggle_password(p_password) {
    var tag = $$D("p_password");
    var tag2 = $$D("showhide");
    if (!isEmpty(tag.value)) {
        if (tag.getAttribute("type") != "password") {
            tag.setAttribute('type', 'password');
        } else {
            tag.setAttribute('type', 'text');

        }


    }
}

/**********setBorderTxtBx1*******/ //PGS_20160628

function setBorderTxtBx1(obj) {
    var suc_id = obj.id + "_sucmsg";
    var err_id = obj.id + "_errmsg";
    var cpc;
    var ipFlag;
    var dobDate = $$D("p_date");
    var dobMonth = $$D("p_month");
    var dobYear = $$D("p_year");
    var d = new Date();
    var yr = d.getFullYear();
    var startYr = yr - 101;
    var endYr = yr - 17;
    if ($$D("ipflag")) {
        ipFlag = $$D("ipflag");
    }
    if (isEmpty(trimString(obj.value)) && (obj.id != "p_date" && obj.id != "p_month" && obj.id != "p_year")) {
        obj.className = "adiptxt err_wrg";
        if (obj.id == "p_email") {
            $$D(err_id).innerHTML = "We need this so we can send you..well emails obviously.";
        }
        if (obj.id == "p_enqpc") {
            $$D(err_id).innerHTML = "Please enter the postcode";
        }
        blockNone(err_id, 'block');
        blockNone(suc_id, 'none');
    } else {
        if (obj.id == "p_email" || obj.id == "pm_email") {
            if (!isValidEmail(trimString(obj.value))) {
                if (obj.id == "p_email") {
                    obj.className = "adiptxt err_wrg";
                    $$D(err_id).innerHTML = "Something seems to be missing from your email. Awkward.";
                } else {
                    obj.className = "adiptxt err_wrg";
                    $$D(err_id).innerHTML = "Please enter a valid email address";
                }
                blockNone(err_id, 'block');
                blockNone(suc_id, 'none');
            } else {
                if (obj.id == "p_email") {
                    var wish = new sack();
                    var signin = "javascript:newPgsLbx('signin','');";
                    wish.requestFile = CommonObjects.pgs_context_path + "/pgs_interactive.check_email_exist_prc?p_email=" + obj.value;
                    wish.onCompletion = function () {
                        if (trimString(wish.response) == "Y") {
                            obj.className = "adiptxt err_wrg";
                            $$D(err_id).innerHTML = 'The email address ' + obj.value + ' is already registered with us, please <a href="' + signin + '">sign in</a>. This is to protect your personal data';
                            blockNone(err_id, 'block');
                            blockNone(suc_id, 'none');
                            $$D("alEmailExists").value = "Y";
                        } else {
                            obj.className = "adiptxt err_rte";
                            blockNone(err_id, 'none');
                            blockNone(suc_id, 'block');
                            $$D("alEmailExists").value = "N";
                        }
                    };
                    wish.runAJAX();
                } else {
                    obj.className = "adiptxt err_rte";
                    blockNone(err_id, 'none');
                    blockNone(suc_id, 'block');
                }
                /*check_email_validation(obj,err_id);*/
            }
        } else if (obj.id == "p_enqpc") {
            if (ipFlag.value == 'Y') {
                cpc = isValidUKpostcode(obj.value);
                if (cpc) {
                    obj.className = "adiptxt err_rte";
                    $$D("p_enqpc_errmsg").innerHTML = "Please enter valid postcode";
                    blockNone('p_enqpc_errmsg', 'block');
                    blockNone("p_enqpc_sucmsg", 'none');
                } else {
                    obj.className = "adiptxt err_wrg";
                    blockNone('p_enqpc_errmsg', 'block');
                    blockNone("p_enqpc_sucmsg", 'none');
                }
            } else {
                obj.className = "adiptxt err_rte";
                blockNone('p_enqpc_errmsg', 'none');
                blockNone("p_enqpc_sucmsg", 'block');
            }
        } else if (obj.id == "p_date" || obj.id == "p_month" || obj.id == "p_year") {
            var dateValid;
            dobDate.className = "adiptxt";
            dobMonth.className = "adiptxt";
            dobYear.className = "adiptxt";
            blockNone('p_dob_errmsg', 'none');
            blockNone('p_dob_sucmsg', 'none');
            if (!isNumeric(dobDate.value) && dobDate.value != "") {
                dateValid = "Please enter your date of birth in numerical value only";
                $$D("p_dob_errmsg").innerHTML = dateValid;
                blockNone('p_dob_errmsg', 'block');
                dobDate.className = "adiptxt err_wrg";
                dobMonth.className = "adiptxt err_wrg";
                dobYear.className = "adiptxt err_wrg";
                return dateValid;
            } else if ((dobDate.value < 1 || dobDate.value > 31) && dobDate.value != "") {
                dateValid = "Day must be between 1 and 31.";
                $$D("p_dob_errmsg").innerHTML = dateValid;
                blockNone('p_dob_errmsg', 'block');
                dobDate.className = "adiptxt err_wrg";
                dobMonth.className = "adiptxt err_wrg";
                dobYear.className = "adiptxt err_wrg";
                return dateValid;
            } else if (!isNumeric(dobMonth.value) && dobMonth.value != "") {
                dateValid = "Please enter your date of birth in numerical value only";
                $$D("p_dob_errmsg").innerHTML = dateValid;
                blockNone('p_dob_errmsg', 'block');
                dobDate.className = "adiptxt err_wrg";
                dobMonth.className = "adiptxt err_wrg";
                dobYear.className = "adiptxt err_wrg";
                return dateValid;
            } else if ((dobMonth.value < 1 || dobMonth.value > 12) && dobMonth.value != "") {
                dateValid = "Month must be between 1 and 12.";
                $$D("p_dob_errmsg").innerHTML = dateValid;
                blockNone('p_dob_errmsg', 'block');
                dobDate.className = "adiptxt err_wrg";
                dobMonth.className = "adiptxt err_wrg";
                dobYear.className = "adiptxt err_wrg";
                return dateValid;
            } else if (!isNumeric(dobYear.value) && dobYear.value != "") {
                dateValid = "Please enter your date of birth in numerical value only";
                $$D("p_dob_errmsg").innerHTML = dateValid;
                blockNone('p_dob_errmsg', 'block');
                dobDate.className = "adiptxt err_wrg";
                dobMonth.className = "adiptxt err_wrg";
                dobYear.className = "adiptxt err_wrg";
                return dateValid;
            } else if ((dobYear.value <= startYr || dobYear.value >= endYr) && dobYear.value != "") {
                if (dobYear.value <= startYr) {
                    dateValid = "Year must be greater than " + startYr;
                }
                if (dobYear.value >= endYr) {
                    dateValid = "You must be at least 17 years old in order to study for a Postgraduate level course";
                }
                $$D("p_dob_errmsg").innerHTML = dateValid;
                blockNone('p_dob_errmsg', 'block');
                dobDate.className = "adiptxt err_wrg";
                dobMonth.className = "adiptxt err_wrg";
                dobYear.className = "adiptxt err_wrg";
                return dateValid;
            } else {
                blockNone('p_dob_errmsg', 'none');
                blockNone("p_dob_sucmsg", 'none');
                dobDate.className = "adiptxt";
                dobMonth.className = "adiptxt";
                dobYear.className = "adiptxt";
            }
            if (dobDate.value != "" && dobMonth.value != "" && dobYear.value != "") {
                dateValid = isValidDOBDate(dobDate.value, dobMonth.value, dobYear.value, '');
                if (dateValid != 'valid') {
                    $$D("p_dob_errmsg").innerHTML = dateValid;
                    blockNone("p_dob_sucmsg", 'none');
                    blockNone('p_dob_errmsg', 'block');
                    dobDate.className = "adiptxt err_wrg";
                    dobMonth.className = "adiptxt err_wrg";
                    dobYear.className = "adiptxt err_wrg";
                    return dateValid;
                } else {
                    blockNone('p_dob_errmsg', 'none');
                    blockNone("p_dob_sucmsg", 'block');
                    dobDate.className = "adiptxt err_rte";
                    dobMonth.className = "adiptxt err_rte";
                    dobYear.className = "adiptxt err_rte";
                    return dateValid;
                }
            }
        } else {
            obj.className = "adiptxt err_rte";
            blockNone(err_id, 'none');
            blockNone(suc_id, 'block');
        }
    }
}


function qual_land(id) {

    $("#view_more_id").slideToggle();
    if ($$D("txtchg").innerHTML == 'View more') {
        $$D("txtchg").innerHTML = 'View less';
    } else {
        $$D("txtchg").innerHTML = 'View more';
    }

    $("#vwlnk_id").toggleClass('cplus');
    //$("#vwlnk_id").toggleClass('fa-minus');
}


$(document).ready(function () {
    setImgHeight();
    mobileSpecificImage();
    $(window).resize(function () {
        setImgHeight();
        mobileSpecificImage();
    });
    $(window).resize(function () {
        var width = document.documentElement.clientWidth;
        if (width >= 1024) {
            $('#qualmn').show();
            $('#lgnmn').show();
            $('.menu').animate({
                "left": '-100%'
            });
        }
    });
    $('#hambt').click(function () {
        $('.menu').animate({
            "left": '0'
        });
        $('#qualmn').show();
        $('#lgnmn').hide();
    });
    $('#usrbtn').click(function () {
        $('.menu').animate({
            "left": '0'
        });
        $('#qualmn').hide();
        $('#lgnmn').show();
    });
    $('#srdiv').click(function (e) {
        $('#ajax_listOfOptions').hide();
        e.stopPropagation();
        $('.menu').animate({
            "left": '-100%'
        });
        $('.srchpod').slideDown();
    });
    $('#srcls').click(function () {
        $('.srchpod').slideUp();
    });
    $('#navcls').click(function () {
        $('.menu').animate({
            "left": '-100%'
        });
    });
    $(document).click(function (e) {
        $(".srchpod").slideUp();
        var container = $(".menu,#usrbtn,#hambt");
        if (!container.is(e.target) && container.has(e.target).length === 0){
			$('.menu').animate({"left": '-100%'});

		}
    });
    $('.srchpod').click(function (e) {
        e.stopPropagation();
    });

    function mobileSpecificImage() {
        var dvwidth = document.documentElement.clientWidth;
		var pgs_img_domain = pgs_scheme + $$D("p_image").value;
        if (dvwidth <= 480) {
            $("#hero").css("background-image", "url(" + pgs_img_domain + "/pgs-cont/img/hero_mob_v1.jpg)");
			//$("#hero").css("background-image", "url(" + pgs_domain + "/pgs-cont/img/hero_mob_v1.jpg)");
        } else if (dvwidth <= 992) {
            $("#hero").css("background-image", "url(" + pgs_img_domain + "/pgs-cont/img/hero_tab_v1.jpg)");
			//$("#hero").css("background-image", "url(" + pgs_domain + "/pgs-cont/img/hero_tab_v1.jpg)");
        } else {
            $("#hero").css("background-image", "url(" + pgs_img_domain + "/pgs-cont/img/hero_v1.jpg)");
			//$("#hero").css("background-image", "url(" + pgs_domain + "/pgs-cont/img/hero_v1.jpg)");
        }
    }

    function setImgHeight() {
        var iwidth = 1500;
        var ihgt = 800;
        var slhgt = $(document).height(); //device height
        var dwidth = $(document).width(); //device width
        var hcalc = (ihgt / iwidth) * dwidth; // img hgt/wdth
        $("#hero").css({
            'height': hcalc + 'px'
        });
    }
    $(window).scroll(function () {
        if ($(this).scrollTop() > 300) {
            $("#topScroll").fadeIn();
        } else {
            $("#topScroll").fadeOut();
        }
    });

    $("#topScroll").click(function () {
        $("html, body").animate({
            scrollTop: 0
        }, "slow");
        return false;
    });

});

function Showhidediv(divid, visibilty) {
    var swidth = document.documentElement.clientWidth;
    if (swidth > 1024) {
        var divobj = document.getElementById(divid);
        if (divobj != null) {
            divobj.style.display = visibilty;
        }
    }
}

function qualificationSelect(id) {
    $$D('search_keyword_hidden').value = "";
    $$D('keyword_hidden').value = "";
    $$D('keyword').value = "";
    Showhidediv('qualpop', 'none');
    $$D('search_keyword_hidden').innerHTML = "";
    var q_class = "<a href=\"javascript:void(0);\" onclick=\"hidequaldiv('qualtxt', 'none');\" ><span>X</span></a>";
    var d = document.getElementById("homesearchform");
    d.className += " padadj";
    $$D('qualtxt').innerHTML = $$D(id).innerHTML + q_class;
    Showhidediv('qualtxt', 'block');
    var qSelect = $$D(id).innerHTML;
    $$D('qual_hidden').value = qSelect.toLowerCase() + "$$Q";
}

function hidequaldiv(divid, visibilty) {
    $$D('qual_hidden').value = null;
    var divobj = document.getElementById(divid);
    if (divobj != null) {
        divobj.style.display = visibilty;
        document.getElementById("homesearchform").className = "nwhme_sr";
    }
}

function topDraw(userId) {
    var ajaxURL = CommonObjects.pgs_context_path + '/get_popular_search_prc'; // PGS_AJAX_PKG.get_popular_search_prc
    var trackId = getCookie('pgs_track_id');
    if (!(trackId == '' || trackId == null) && !(userId == '' || userId == null || (userId === undefined))) {
        ajaxURL = ajaxURL + '?p_track_session_id=' + trackId + '&p_user_id=' + userId;
    } else if (trackId != '' || trackId != null) {
        ajaxURL = ajaxURL + '?p_track_session_id=' + trackId;
    }
    var ajax = new sack();
    ajax.requestFile = ajaxURL;
    ajax.onCompletion = function () {
        $$D("draw_cont1").innerHTML = ajax.response;
        blockNone("load_ajax", "none");
    };
    ajax.runAJAX();
    if ($$D('topkeyword') != null) {
        $$D('topkeyword').value = "";
        blockNone("draw_cont1", "block");
        blockNone("draw_cont2", "none");
    }
}

function keywordtopAutoComplete(obj, paramToExternalFile, e) {
    var urlPrc = 'pgs_ajax_pkg.get_search_top_ajax_prc'; // Procedure name
    var param = "p_text=" + obj.value;
    if (paramToExternalFile == "getQlCategoriesByLetters") {
        param = param + '&p_ajax_type=QL'; // Ajax type Qualification landing page
    } else if (paramToExternalFile == "getCollegesByLetters") {
        if (($$D("searchcollege_hidden").value != "" || $$D("searchcollege_hidden").value != null) && e.keyCode != 13) {
            $$D("searchcollege_hidden").value = "";
            $("#puni_errdiv1").css("display", "none");
        }
        param = param + '&p_ajax_type=UP';
    } else {
        param = param + '&p_ajax_type=C';
    }

    $$D("search_keyword_hidden_top").value = obj.value;

    if (!searchTextValidate(obj.value)) {
        return false;
    }
    topAjaxSearch();
    //ajax_showOptionsTop(obj,paramToExternalFile,e,urlPrc,param,''); 
}

function topAjaxSearch() {
    var ajaxURL = CommonObjects.pgs_context_path + '/pgs_ajax_pkg.get_search_top_ajax_prc';
    var keyword = $$D('topkeyword');
    var param = "p_text=" + keyword.value + '&p_ajax_type=C';
    ajaxURL = ajaxURL + '?' + param;
    var ajax = new sack();
    if (trimString(keyword.value).length >= 3) {
        ajax.requestFile = ajaxURL;
        ajax.onCompletion = function () {
            $$D("draw_cont2").innerHTML = ajax.response;
            blockNone("draw_cont2", "block");
            blockNone("draw_cont1", "none");
        };
        ajax.runAJAX();



    }


}




function KeywordtopOnkeypress(e, whichPage) {
    //blockNone('draw_cont', 'none');
    if (e.keyCode == 13) {
        return validateHomeSearch("N", whichPage);
    }
}

function HomeSearchPrevalidatetop() {
    if (unsavedMail == false) {
        var flag = validateHomeSearch('N', 'topNav');
        if (!flag) {
            return false;
        }
    } else {
        if ($$D("mail_a_href")) {
            $$D("mail_a_href").value = 'FILTER';
            showPGSLightBox('my_profile_alert', '665', '520', '');
        }
    }
}

function showhidePopularSearch() {
    var keyword = $$D('topkeyword');

    if (trimString(keyword.value).length >= 3) {
        blockNone("draw_cont1", "none");
        blockNone("draw_cont2", "block");
    } else {
        blockNone("draw_cont1", "block");
        blockNone("draw_cont2", "none");
    }
}

function qual_sub_land(l_more_sub) {
    var l_more_sub;
    $("#view_more_sub" + l_more_sub).slideToggle();
    if ($$D("txtch" + l_more_sub).innerHTML == 'More') {
        $$D("txtch" + l_more_sub).innerHTML = 'Less';
    } else {
        $$D("txtch" + l_more_sub).innerHTML = 'More';
    }
    $("#vwlnk_ids" + l_more_sub).toggleClass('fa-plus');
    $("#vwlnk_ids" + l_more_sub).toggleClass('fa-minus');
} //PGS_20170321	 

function highLightkey() {
    if ((document.getElementById("topkeyword").value) != "") {
        key = (document.getElementById("topkeyword").value).toLowerCase();
        ul = key.charAt(0).toUpperCase();
        cplt = ul + (key.substring(1)).toLowerCase();
        ukey = key.toUpperCase();
        var ch = document.getElementById("draw_cont2").children;
        for (i = 0; i < ch.length; i++) {
            if (ch[i].getAttribute("class") == "fl") {
                var nexch = ch[i].children;
                for (j = 0; j < nexch.length; j++) {
                    if (nexch[j].tagName == "UL") {
                        var chltrd = nexch[j].children;
                        for (k = 0; k < chltrd.length; k++) {
                            var nexfr = chltrd[k].children;
                            for (l = 0; l < nexfr.length; l++) {
                                inf = nexfr[l].innerHTML;
                                if (inf.includes(key)) {
                                    inf = inf.replace(key, "<span class='bld'>" + key + "</span>");
                                    nexfr[l].innerHTML = inf;
                                }
                                if (inf.includes(cplt)) {
                                    inf = inf.replace(cplt, "<span class='bld'>" + cplt + "</span>");
                                    nexfr[l].innerHTML = inf;
                                }
                                if (inf.includes(ukey)) {
                                    inf = inf.replace(ukey, "<span class='bld'>" + ukey + "</span>");
                                    nexfr[l].innerHTML = inf;
                                }
                            }
                        }

                    }
                }

            }
        }
    }
}

function hideQualPopOnBlur(event) {
    if ($(event.target).closest("#qualpop").length === 0 && $(event.target).closest("#keyword").length === 0) {
        Showhidediv("qualpop", "none");
    }
}
$(document).ready(function () {
    $(document).on("click touchstart", function (event) {
        if ($(event.target).closest("#qualpop").length === 0 && $(event.target).closest("#keyword").length === 0) {
            Showhidediv("qualpop", "none");
        }
    });
//PGS_20171031
//	 var pgs_jsdomain = pgs_scheme + $$D("p_js").value;
 //  $.getScript( pgs_jsdomain + "/pgs-cont/scripts/emailDomain.js", function(){        
 //    var arr = ["pm_email", "clearTextOfCurrentObj(this,'Email');","setTextOfCurrentObj(this,'Email');","clearTextOfCurrentObj(this,'Email');"]; 
   //  $("#pm_email").autoEmail(arr);        
 	// });  
      //jQuery.noConflict();    
 
	if ($(window).width() >= 993) {
                $(".nw_frm .tool_tip").mouseenter(function(e) {
                    $(this).children(".tool_cont").show();
                    e.preventDefault();
                    e.stopPropagation();
                });
                
                 $(".nw_frm .tool_tip").mouseleave(function(e) {
                    
                    $(this).children(".tool_cont").hide();
                    e.preventDefault();
                    e.stopPropagation();
                });

            } else {
                $(".nw_frm .tool_tip").click(function(e) {
                    $(".nw_frm  .tool_tip").children(".tool_cont").hide();
                    $(this).children(".tool_cont").show();
                    e.preventDefault();
                    e.stopPropagation();
                });
            }
	
	getLocation();
	sponsoredStatsLogging();
	
	}
	
	);

function preventEvent(events) {
    events = (events) ? events : event;
    events.stopPropagation();
    return false;
}

//**************************PGS_20170516

function containsSpecialCharacter(p_msg1) {
    if (p_msg1 != null) {
        var inputText = p_msg1;
        for (var i = 0; i < vulnerableKeywords.length; i++) {
            var inputIndex = (inputText.toLowerCase()).indexOf(vulnerableKeywords[i]);
            if (inputIndex != -1) {
                return vulnerableKeywords[i];
            }
        }
        for (var i = 0; i < htmlTags.length; i++) {
            var inputIndex1 = (inputText.toLowerCase()).indexOf(htmlTags[i]);
            if (inputIndex1 != -1) {
                return htmlTags[i];
            }
        }
    }
    return "";
}

//*************************

function lbCmpChknew(bsktId, userId, assocId, assocType, type) {
    addRemoveBasket(bsktId, userId, assocId, assocType, '', 'inner');
    if (type == "ADD") {
        $$D('lbbskt' + assocId).setAttribute("onClick", 'lbCmpChknew("' + bsktId + '","' + userId + '","' + assocId + '","' + assocType + '","REMOVE")');
        $$D("actionLB" + assocId).className = "grntxt";
        $$D("actionLB" + assocId).innerHTML = '<span class="fa fa-check"> </span>ADDED';
        if ($$D('lbbskt' + assocId).className == "adsh") {
            $$D('lbbskt' + assocId).className = "adsh active";
        } else if ($$D('spanID' + assocId).className == "squr") {
            $$D('spanID' + assocId).className = "squr active";
        }
    } else if (type == "REMOVE") {
        $$D('lbbskt' + assocId).setAttribute("onClick", 'lbCmpChknew("' + bsktId + '","' + userId + '","' + assocId + '","' + assocType + '","ADD")');
        $$D("actionLB" + assocId).className = "grytxt";
        $$D("actionLB" + assocId).innerHTML = '<span class="fa fa-times"> </span>REMOVED';
        if ($$D('lbbskt' + assocId).className == "adsh active") {
            $$D('lbbskt' + assocId).className = "adsh";
        } else if ($$D('spanID' + assocId).className == "squr active") {
            $$D('spanID' + assocId).className = "squr";
        }
    }
}

function showSrtlbnew(assoc_id, page) {
    var width = document.documentElement.clientWidth;
    if (width >= 1024) {
        if ($$D("spanID" + assoc_id).className == "squr") {
            $$D("lbaddremId" + assoc_id).innerHTML = "Add to Shortlist";
            $$D("lbshow" + assoc_id).style.display = "block";
        } else {
            $$D("lbaddremId" + assoc_id).innerHTML = "Remove from Shortlist";
            $$D("lbshow" + assoc_id).style.display = "block";
        }
    }
}

function Cleartext() {
    var add_1 = $$D("p_addr_1").value;
    var add_2 = $$D("p_addr_2").value;
    var town = $$D("p_town").value;
    var postcode = $$D("p_enqpc").value;

    if (add_1 != null && add_2 != null && town != null && postcode != null) {
        $$D("p_addr_1").value = "";
        $$D("p_addr_2").value = "";
        $$D("p_town").value = "";
        $$D("p_enqpc").value = "";
        $$D("post_code").value = "";
        blockNone("addressDrop", "none");
    }
}

function submitformartl(pageno, prev, orderBy, author, postType, filterCnt) {
    var page_no;
    if ($$D("order")) {
        $$D("order").value = orderBy;
    }
    if ($$D("author")) {
        $$D("author").value = author;
    }
    if ($$D("ptype")) {
        $$D("ptype").value = postType;
    }
    if ($$D("fcnt")) {
        $$D("fcnt").value = filterCnt;
    }
    if (prev == 'Y') {
        page_no = $$D("pageno").value - 1;
        $$D("pageno").value = page_no;
    } else if (prev == 'N') {
        page_no = ($$D("pageno").value * 1) + 1;
        $$D("pageno").value = page_no;
    } else if ($$D("pageno")) {
        $$D("pageno").value = pageno;
    }
    document.forms["clear_search"].submit();
}

 function changestate(CheckId){ 
	  var check = document.getElementById(CheckId).checked;        
	  document.getElementById(CheckId).value = check;
	  if(CheckId == "allmail"){    
		  if(CheckId == "allmail" && check == true){
			 var val        = true;
			 var chk_state  = true;
			 var class_name = "clr disabl";
			}
			else if(CheckId == "allmail" && check == false){
			 var val        = false;
			 var chk_state  = false;
			 var class_name = "clr";      
			}
		 $$D("market").value   = val;
		 $$D("solus").value    = val;
		 $$D("reminder").value = val;              
		 $$D("survey").value   = val;
		 $$D("market").checked   = chk_state;
		 $$D("solus").checked    = chk_state;
		 $$D("reminder").checked = chk_state;
		 $$D("survey").checked   = chk_state; 
		 $$D("market_field").className = class_name;
		 $$D("solus_field").className  = class_name;
		 $$D("remind_field").className = class_name;
		 $$D("survey_field").className = class_name;
	   }
    }

function clearErremailmsg(divId, msgId){
 $("#" + divId).removeClass("err_wrg");
 $("#" + msgId).hide();
}

/*
function validateScholarshipuni(obj) {
    var psubject_id = trimString($$D("ps_subject_id").value);
    var pcountry_id = trimString($$D("ps_country_id").value);
    var pawardtyp_id = trimString($$D("ps_award_typ_id").value);
    var pawardcov_id = trimString($$D("ps_award_cov_id").value);
    var ppagename = trimString($$D("p_page_name").value);
    var pcollegename = trimString($$D("p_college_name").value);
    //alert (trimString($$D("ps_college_id_hidden").value));
    if (ppagename == "scholarship_homepage") {

        if (trimString($$D("ps_college_id_hidden").value) == 0) {
            var pgsSCHurl = "/postgraduate-funding/fr-" + psubject_id + "-" + pcountry_id + "-0-" + pawardtyp_id + "-" + pawardcov_id + "-1";
        } {
            //pgsSCHurl = pgsSCHurl;
            window.location.href = pgsSCHurl;
        }
		var pcol = trimString($$D("ps_college_id_hidden").value) ? trimString($$D("ps_college_id_hidden").value) : "";
		
		if ((psubject_id == null || psubject_id == 0) &&
		   (pcountry_id == null || pcountry_id == 0) &&
		   (pawardtyp_id == null || pawardtyp_id == 0) && 
		   (pawardcov_id == null || pawardcov_id == 0) &&
		   (pcol == null || pcol == 0)){
			   alert("Enter university");
                return false;
		   }
		
		if (pcol != null && pcol !="" && pcol !=0){
        if (trimString($$D("ps_college_id_hidden").value) != null && trimString($$D("ps_college_id_hidden").value) != 0 && psubject_id == 0 && pcountry_id == 0 && pawardtyp_id == 0 && pawardcov_id == 0) {
            var pscollege_id = trimString($$D("ps_college_id").value);
        }
        var pgsSCHurl = "";
        var pcollege_id = trimString($$D("ps_college_id_hidden").value);
        if (pscollege_id == 'University') {
            pcollege_id = 0;
        }			
		}		
		
        var colId = $$D(ajax_list_activeInput.name + '_hidden') ? $$D(ajax_list_activeInput.name + '_hidden').value : "";
		//$$D(ajax_list_activeInput.name + '_hidden').value;
		if (colId != null && colId !=""){
        var a = colId.split("$$U");		
        var pgsSCHurl = pgs_domain + "/postgraduate-funding-" + a[0] + "/";					
		}
    } else if (ppagename == "scholarship_university_page") {

        var pcollid = $$D("p_coll_id");
        pgsSCHurl = "/postgraduate-funding-" + pcollegename + "/fu-" + psubject_id + "-" + pcountry_id + "-" + pcollid.value + "-" + pawardtyp_id + "-" + pawardcov_id + "-1";
    }
    if ((psubject_id == 0 || psubject_id == "") && (pcountry_id == 0 || pcountry_id == "") && (pcollege_id == 0 || pcollege_id == "") && (pawardtyp_id == 0 || pawardtyp_id == "") && (pawardcov_id == 0 || pawardcov_id == "")) {
        pgsSCHurl = "/funding";
        window.location.href = pgsSCHurl;
    } else {
        //return;
        window.location.href = pgsSCHurl;
    }
}
*/

function validateScholarshipSearch(obj) {
    var ppagename = trimString($$D("p_page_name").value);
    var pcollegename = "";
	var colId = $$D(ajax_list_activeInput.name + '_hidden') ? $$D(ajax_list_activeInput.name + '_hidden').value : "";
		if (colId != null && colId !=""){
        var a = colId.split("$$U");		
        pcollegename = a[0] ;					
		}
     pcollegename = (pcollegename != null && pcollegename != "") ? pcollegename : trimString($$D("p_college_name").value);	
		
	var psubject_name = trimString($$D("ps_subject_name").value);
    var pcountry_name = trimString($$D("ps_country_name").value);
    var pawardtyp_name = trimString($$D("ps_award_typ_name").value);
    var pawardcov_name = trimString($$D("ps_award_cov_name").value);
	var  pkeyword = trimString($$D("keyword").value);
	
	
	var sub_url = "/postgraduate-funding";
	var uni_url = "/uni/";	
	var pcol = trimString($$D("ps_college_id_hidden").value) ? trimString($$D("ps_college_id_hidden").value) : "";		
	var pgsSCHurl = '';
	
    if (ppagename == "scholarship_homepage") {
        if (pcol == "" || pcol == 0) {
			 pgsSCHurl = sub_url;			
			if (psubject_name != null && psubject_name != ""){
				pgsSCHurl += "/" + psubject_name;
			}
			 else if(pkeyword != null && pkeyword != ""){
				pgsSCHurl += "/?keyword=" + pkeyword;
			};			
     }
	  else{
			if (pcol == "" || pcol == 0){
			   alert("Enter university");
                return false;
		   }
		   
		if (psubject_name != null && psubject_name != ""){
				pgsSCHurl = sub_url + "/" + psubject_name;
				pgsSCHurl += "/" + pcollegename;
			}
	    else if(pkeyword != null && pkeyword != ""){
				pgsSCHurl = sub_url + "/?keyword=" + pkeyword;
				pgsSCHurl += "/" + pcollegename;
			}
		 else{
				pgsSCHurl = "/postgraduate-funding" + uni_url;
		        pgsSCHurl += pcollegename;
			};
		}        
    } else if (ppagename == "scholarship_university_page") {

		
		if (pcol == "" || pcol == 0) {
		if (psubject_name != null && psubject_name != ""){
				pgsSCHurl += "/" + psubject_name;
			}
		}else{
		    if (psubject_name != null && psubject_name != ""){
				pgsSCHurl = sub_url + "/" + psubject_name;
				pgsSCHurl += '/' + pcollegename;
			}else{
				pgsSCHurl = "/postgraduate-funding" + uni_url;
		        pgsSCHurl += pcollegename;
			};
		}
    }
	if(pcountry_name != null && pcountry_name != ""){
				pgsSCHurl += (pgsSCHurl.indexOf("?") > -1) ? "&" : "?" ;
				pgsSCHurl += "nationality=" + pcountry_name;
			}
			
			if (pawardtyp_name != null && pawardtyp_name != ""){
				pgsSCHurl += (pgsSCHurl.indexOf("?") > -1) ? "&" : "?" ;
				pgsSCHurl += "award_type=" + pawardtyp_name;
			} 
			if (pawardcov_name != null && pawardcov_name != ""){
				pgsSCHurl += (pgsSCHurl.indexOf("?") > -1) ? "&" : "?" ;
				pgsSCHurl += "award_coverage=" + pawardcov_name;
			}
			if (pgsSCHurl == sub_url){
				pgsSCHurl = "/funding/scholarships";
			}
			 window.location.href = pgsSCHurl;
		  
}

function validateScholarshipuni(obj) {
    var ppagename = trimString($$D("p_page_name").value);
    var pcollegename = "";
		var searchcollege = trimString($$D("ps_college_id").value);

	var colId = $$D(ajax_list_activeInput.name + '_hidden') ? $$D(ajax_list_activeInput.name + '_hidden').value : "";
	   	if(searchcollege == "" || searchcollege == colId){
	  alert("Enter a university name"); 
	  return false;
    }
		if (colId != null && colId !=""){
        var a = colId.split("$$U");		
        pcollegename = a[0] ;					
		}
     pcollegename = (pcollegename != null && pcollegename != "") ? pcollegename : trimString($$D("p_college_name").value);	
		
	var psubject_name = trimString($$D("ps_subject_name").value);
    var pcountry_name = trimString($$D("ps_country_name").value);
    var pawardtyp_name = trimString($$D("ps_award_typ_name").value);
    var pawardcov_name = trimString($$D("ps_award_cov_name").value)
	
	var uni_url = "/postgraduate-funding/uni/";	
	var pcol = trimString($$D("ps_college_id_hidden").value) ? trimString($$D("ps_college_id_hidden").value) : "";		
	if (pcol == "" || pcol == 0){
		alert("Please choose a university from the list");
        return false;
	}
	var pgsSCHurl = '';
	pgsSCHurl = uni_url + pcollegename;	
    window.location.href = pgsSCHurl;
		  
}

function clearcollegeid(){
   var p_college_id = trimString($$D("ps_college_id_hidden").value);
   var p_col_id = trimString($$D("p_coll_id").value);
   if ((p_college_id != null && p_col_id != null) || (p_college_id != "" && p_col_id != "")){
     $('#anchor_tag').attr("disabled", false);
     $$D("p_coll_id").value = "";
     $$D("ps_college_id_hidden").value = "";
   }
}

function vcclose(){
$('.cm_mbox').hide();
chckav();
}

function userCookie() {
 var ajaxURL = CommonObjects.pgs_context_path + '/get_user_cookie_prc';
 var cookieSplash = getCookie('cookie_splash_flag');
 if (!(cookieSplash == '' || cookieSplash == null)) {
        ajaxURL = ajaxURL + '?p_user_cookie=' + cookieSplash;
    } 
    var ajax = new sack();
    ajax.requestFile = ajaxURL;
    ajax.onCompletion = function () {
        blockNone("load_ajax", "none");
    };
	ajax.runAJAX();
}

function Courseprofileurl() {
    $("#keyword_hidden").change(function () {
        var courseId = document.getElementById(ajax_list_activeInput.name + '_hidden').value;
        var coursecount = courseId.indexOf("$$C");
        if (unsavedMail == false) {
            Courseprofilenewurl()
        } else {
            if ($$D("mail_a_href") && coursecount > 0) {
                $$D("mail_a_href").value = 'QUAL';
                showPGSLightBox('my_profile_alert', '665', '520', '');
            }
        }
    });
};

var CourseProfileFlag = "N";


function Courseprofilenewurl() {
    var courseId = document.getElementById(ajax_list_activeInput.name + '_hidden').value;
    var coursecount = courseId.indexOf("$$C");
    if (coursecount > 0) {
        CourseProfileFlag = "Y";
        var a = courseId.split("$$C");
	   if ($("body *").is('#home_page_ga')) {
       var  qual_hidden = trimString($$D("qual_hidden").value);
       if (qual_hidden != "" && qual_hidden.indexOf("$$Q") > -1) {
         bqual = qual_hidden.split("$$Q");	   
		var ajaxURL = CommonObjects.pgs_context_path + "/pgs_browse.course_ajax_url_prc?p_text_key=" + a[0] + "&p_channal_qual=" + bqual[0] ;}
        else {
		var ajaxURL = CommonObjects.pgs_context_path + "/pgs_browse.course_ajax_url_prc?p_text_key=" + a[0];
		}}
		if ($("body *").is('#qual_page_hidden_ga')) {
	    var qual  = $$D("qual_page_hidden").value;
	    var ajaxURL = CommonObjects.pgs_context_path + "/pgs_browse.course_ajax_url_prc?p_text_key=" + a[0] + "&p_channal_qual=" + qual ;     
		}
        var Coursepro = new sack();
        Coursepro.requestFile = ajaxURL;
        Coursepro.onCompletion = function () {
        courseprofileurlComplete(Coursepro)
        };
        Coursepro.runAJAX();
    }
};

function SchCourseprofileurl() {
    $("#keyword_hidden").change(function () {
        var courseId = document.getElementById(ajax_list_activeInput.name + '_hidden').value;
        var coursecount = courseId.indexOf("$$C");
        if (unsavedMail == false) {
            SchCourseprofilenewurl()
        } else {
            if ($$D("mail_a_href") && coursecount > 0) {
                $$D("mail_a_href").value = 'QUAL';
                showPGSLightBox('my_profile_alert', '665', '520', '');
            }
        }
    });
};

var CourseProfileFlag = "N";


function SchCourseprofilenewurl() {
    var courseId = document.getElementById(ajax_list_activeInput.name + '_hidden').value;
    var coursecount = courseId.indexOf("$$C");
    if (coursecount > 0) {
        CourseProfileFlag = "Y";
        var a = courseId.split("$$C");
		var ajaxURL = CommonObjects.pgs_context_path + "/pgs_browse.sch_course_ajax_url_prc?p_text_key=" + a[0] ;
        var Coursepro = new sack();
        Coursepro.requestFile = ajaxURL;
        Coursepro.onCompletion = function () {
        courseprofileurlComplete(Coursepro)
        };
        Coursepro.runAJAX();
    }
};

function courseprofileurlComplete(Coursepro) {
    var response = trimString(Coursepro.response);
    CourseProfileFlag = "N";
    window.location.href = response; //PGS_20180731
    return false;
};

function UserpdfRedirect() {
    var pdfurl = "/pgs/get_user_detail_pdf_prc";
    //pdfurl = pdfurl + "p_user_id=" + UserId;
    var wish = new sack();
    wish.requestFile = pdfurl;
    wish.onCompletion = function () {
        UserpdfComplete(wish);
    };
    wish.runAJAX();
}

function UserpdfComplete(obj) {
    var downloadUrl = '/pgs/user_pdf_download_prc';
    var status;
    if (trimString(obj.response) == 'SUCCESS') {
        window.open(downloadUrl, '_blank');
        status = "complete";
	 $$D('downnow').style.display = 'none';
     $$D('down').style.display = 'block';
		$$D('download_error').style.display = 'none';
    }
	else if (trimString(obj.response) == 'ERROR') {
        $$D('download_error').style.display = 'block';
    }
	 if (status == 'complete') {
        showPGSLightBox('download_success', 665, 520, 'p_from=pdf');
		 //$('#lightbox').hide();
	 }
}

function articleredirect() {
    $("#keyword_hidden").change(function () {
        var ArlcleId = document.getElementById(ajax_list_activeInput.name + '_hidden').value;
        var Articlecount = ArlcleId.indexOf("$$A");
        //if (unicount > 0){}
		//alert('sounadriya2333');
        if (unsavedMail == false) {
            articleredirectnew()
        } 
    });
};

function articleredirectnew() {
    var ArticleId = document.getElementById(ajax_list_activeInput.name + '_hidden').value;
    var Articlecount = ArticleId.indexOf("$$A");
    if (Articlecount > 0) {
        ArticleFlag = "Y";
        var a = ArticleId.split("$$A");
		var ajaxURL = CommonObjects.pgs_context_path + "/pgs_browse.article_ajax_url_prc?p_post_id="+ a[2];
        var Articlepro = new sack();
        Articlepro.requestFile = ajaxURL;
        Articlepro.onCompletion = function () {
            ArticleurlComplete(Articlepro)
        };
		//GAInteractionEventTracking('','Scholarship search', 'Search', a[2].toLowerCase(), '');
        Articlepro.runAJAX();
    }
};

function ArticleurlComplete(Articlepro) {
    var response = trimString(Articlepro.response);
    ArticleFlag = "N";
    //window.location.href = CommonObjects.pgs_context_path+response;   //commented PGS_20160929
    window.location.href = response; // newly introduced PGS_20160929
    return false;
};

 function getScreenwidth(){
	  var sw = screen.width;	  	 
	  setCookie('cookie_screen_width', sw, '', '/', '', '');
	  var p_screenwidth = getCookie('cookie_screen_width');
	 // var randnum = Math.floor((Math.random() * 10000000) + 1); 
	  //var trackId = getCookie('pgs_track_id');
	  //var var_na = "screenwidth"+trackId;
	  //alert(sw);
	 // var ajaxURL = CommonObjects.pgs_context_path + "/pgs_screenwidth_pkg.log_screenwidth_prc?p_screenwidth="+sw +'&rndval='+randnum;
	  //"/PKG_COMMON.prc_set_context_value?var_name="+var_na+'&var_value='+sw+'&rndval='+randnum;
	  //var ajax = new sack();
	  //ajax.requestFile = ajaxURL;
	  //ajax.onCompletion = function () {};
	  //ajax.runAJAX();
};

function getLocation() {
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(showPosition);
			} else {
				x.innerHTML = "Geolocation is not supported by this browser.";
			}
		};

function showPosition(position) {
	setCookie('LAT_LONG', position.coords.latitude +"_"+ position.coords.longitude, '', '/', '', '');
	// post messaging to the review widget iframe added by sangeeth.S for the release 310320
	if(document.getElementById('iframePGSRW')){
	 var latitude = position.coords.latitude;
     var longitude = position.coords.longitude; 
     var latlongvalue = {lat:latitude,lon:longitude};
	 var targetOrigin = $$D('wurwIframeDomain') ? $$D('wurwIframeDomain').value : '';
	 //get reference to window inside the iframe
	 var wn = document.getElementById('iframePGSRW').contentWindow;
	  // postMessage arguments: data to send, target origin
	  if(targetOrigin!= ''){
	    wn.postMessage(latlongvalue, targetOrigin); 
	  }
	}
	//
};

$(window).scroll(function() {
	sponsoredStatsLogging();
});
function getDeviceWidth() { return (window.innerWidth > 0) ? window.innerWidth : screen.width; }

function sponsoredStatsLogging(){
	var ajax=new sack();
	var deviceWidth =  null;
    deviceWidth =  getDeviceWidth();
	var sponsoredId = $('#SPONSORED_LISTING');
    var dataId = "data-id";
    var statsNotLogged = "sponsored_stats_not_logged";
    var statsLogged = "sponsored_stats_logged";
    var collegeId = $('#p_spons_college_id').val();
    var collegeName = $('#collegeNameSponsored').val();
	var orderItemId = $('#p_order_item_id').val();
    var orderItemIdSponsored = $('#p_source_order_item_id').val();
    var browseCatCode = $('#p_spons_category_code').val();;
    var subject = $("#featuredSubject").val();	
    var courseId = $("#p_spons_course_id").val();
    var networkId = $("#networkId").val();
	var p_type = "SPONSORED_PAGE_VIEW"
	
	   if (sponsoredId.length && sponsoredId != undefined && sponsoredId !=null) {
         if (isScrollIntoView(sponsoredId, false) && sponsoredId.attr(dataId) == statsNotLogged) {
            searchResultSponsoredViewLogging(collegeId, p_type,deviceWidth, orderItemIdSponsored, orderItemIdSponsored,browseCatCode);
            sponsoredId.attr(dataId, statsLogged);
        }
    }

	
	//var url = '/pgs/pgs_interactive.web_click_db_log?z='+collegeId+"&p_type="+p_type+"&p_screen_width="+deviceWidth+"&p_order_item_id="+orderItemIdSponsored;
   //ajax.requestFile = url;
   //ajax.onCompletion = function(){ responseDataSponsored(ajax); };	
 //  ajax.runAJAX();
	
}
//function responseDataSponsored(ajax){
  //return false;
//}

function isScrollIntoView(element, fullyInView) {
    var pageTop = $(window).scrollTop();
    var pageBottom = pageTop + $(window).height();
    var elementTop = $(element).offset().top;
    var elementBottom = elementTop + $(element).height();
    if (fullyInView === true) {
        return ((pageTop < elementTop) && (pageBottom > elementBottom));
    } else {
        return ((elementTop <= pageBottom) && (elementBottom >= pageTop));
    }	
}	

function sponsoredGaLogging(w,colId,SponsColFlag){
	
	var sponscourseId        = $('#p_spons_course_id').val();	
	var orderItemIdSponsored = $('#p_source_order_item_id').val();
	var sponsPagename        = $('#p_spons_page_name').val();
	var sponsCollegeId       = $('#p_spons_college_id').val(); 
    var sponsCookieCollegeId = $('#spons_col_id_cookie').val();	
	//if (sponsPagename == "search_results")
	//{
	if (((sponscourseId != null && w != null) && (sponscourseId != undefined && w != undefined) && (orderItemIdSponsored != null && orderItemIdSponsored != undefined )
		 && (sponscourseId == w ) ) || ((sponsCollegeId == colId )&& ((sponsCollegeId != null && colId != null) && (sponsCollegeId != undefined && colId != undefined)))|| SponsColFlag == 'Y'||((sponsCookieCollegeId != undefined && sponsCookieCollegeId != null) &&(sponsCookieCollegeId == colId) ))
	{
       ga('set', 'dimension8', 'Sponsored');
	} 
   else
   {
	   ga('set', 'dimension8', 'None');
   }	   

//}
}	





